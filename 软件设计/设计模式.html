<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 8.0.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/7.0.0/css/all.min.css" integrity="sha256-VHqXKFhhMxcpubYf9xiWdCiojEbY9NexQ4jh8AxbvcM=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"cmder.github.io","root":"/","images":"/images","scheme":"Mist","darkmode":false,"version":"8.25.0","exturl":false,"sidebar":{"position":"right","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12},"hljswrap":true,"codeblock":{"theme":{"light":"atom-one-light","dark":"atom-one-dark"},"prism":{"light":"prism","dark":"prism-dark"},"copy_button":{"enable":true,"style":null},"fold":{"enable":false,"height":500},"language":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"duration":200,"transition":{"menu_item":"fadeInDown","post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js" defer></script>

    <meta name="description" content="分类">
<meta property="og:type" content="article">
<meta property="og:title" content="设计模式">
<meta property="og:url" content="https://cmder.github.io/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html">
<meta property="og:site_name" content="说码解字">
<meta property="og:description" content="分类">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2024-12-12T03:20:14.000Z">
<meta property="article:modified_time" content="2025-10-14T14:00:23.770Z">
<meta property="article:author" content="Bruce Yao">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="https://cmder.github.io/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html">


<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://cmder.github.io/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html","path":"软件设计/设计模式.html","title":"设计模式"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>设计模式 | 说码解字</title>
  








  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous" defer></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous" defer></script>
<script src="/js/utils.js" defer></script><script src="/js/motion.js" defer></script><script src="/js/sidebar.js" defer></script><script src="/js/next-boot.js" defer></script><script src="/js/pjax.js" defer></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.5.0/search.js" integrity="sha256-xFC6PJ82SL9b3WkGjFavNiA9gm5z6UBxWPiu4CYjptg=" crossorigin="anonymous" defer></script>
<script src="/js/third-party/search/local-search.js" defer></script>


  <script class="next-config" data-name="mermaid" type="application/json">{"enable":true,"theme":{"light":"forest","dark":"dark"},"js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mermaid/11.10.1/mermaid.min.js","integrity":"sha256-BmQmdWDS8X2OTbrwELWK366LV6escyWhHHe0XCTU/Hk="}}</script>
  <script src="/js/third-party/tags/mermaid.js" defer></script>





  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"none","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js" defer></script>



  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<style>.darkmode--activated{--body-bg-color:#282828;--content-bg-color:#333;--card-bg-color:#555;--text-color:#ccc;--blockquote-color:#bbb;--link-color:#ccc;--link-hover-color:#eee;--brand-color:#ddd;--brand-hover-color:#ddd;--table-row-odd-bg-color:#282828;--table-row-hover-bg-color:#363636;--menu-item-bg-color:#555;--btn-default-bg:#222;--btn-default-color:#ccc;--btn-default-border-color:#555;--btn-default-hover-bg:#666;--btn-default-hover-color:#ccc;--btn-default-hover-border-color:#666;--highlight-background:#282b2e;--highlight-foreground:#a9b7c6;--highlight-gutter-background:#34393d;--highlight-gutter-foreground:#9ca9b6}.darkmode--activated img{opacity:.75}.darkmode--activated img:hover{opacity:.9}.darkmode--activated code{color:#69dbdc;background:0 0}button.darkmode-toggle{z-index:9999}.darkmode-ignore,img{display:flex!important}.beian img{display:inline-block!important}</style></head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">说码解字</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="搜索" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
      <div class="search-header">
        <span class="search-icon">
          <i class="fa fa-search"></i>
        </span>
        <div class="search-input-container">
          <input autocomplete="off" autocapitalize="off" maxlength="80"
                placeholder="搜索..." spellcheck="false"
                type="search" class="search-input">
        </div>
        <span class="popup-btn-close" role="button">
          <i class="fa fa-times-circle"></i>
        </span>
      </div>
      <div class="search-result-container">
        <div class="search-result-icon">
          <i class="fa fa-spinner fa-pulse fa-5x"></i>
        </div>
      </div>
    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%88%86%E7%B1%BB"><span class="nav-number">1.</span> <span class="nav-text">分类</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E5%9B%BE%E7%A4%BA"><span class="nav-number">2.</span> <span class="nav-text">图示</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E8%AF%A6%E8%A7%A3"><span class="nav-number">3.</span> <span class="nav-text">详解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%88%9B%E5%BB%BA%E5%9E%8B%E6%A8%A1%E5%BC%8Fcreational-patterns"><span class="nav-number">3.1.</span> <span class="nav-text">创建型模式（Creational
Patterns）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8Fsingleton"><span class="nav-number">3.1.1.</span> <span class="nav-text">单例模式（Singleton）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%A5%BF%E6%B1%89%E5%BC%8Feager-initialization"><span class="nav-number">3.1.1.1.</span> <span class="nav-text">1. 饿汉式（Eager
Initialization）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%87%92%E6%B1%89%E5%BC%8Flazy-initialization%E9%9D%9E%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8"><span class="nav-number">3.1.1.2.</span> <span class="nav-text">2. 懒汉式（Lazy
Initialization，非线程安全）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84%E6%87%92%E6%B1%89%E5%BC%8Fsynchronized-%E6%96%B9%E6%B3%95"><span class="nav-number">3.1.1.3.</span> <span class="nav-text">3.
线程安全的懒汉式（Synchronized 方法）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%8C%E9%87%8D%E6%A3%80%E6%9F%A5%E9%94%81double-checked-locking-dcl"><span class="nav-number">3.1.1.4.</span> <span class="nav-text">4.
双重检查锁（Double-Checked Locking, DCL）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E5%86%85%E9%83%A8%E7%B1%BBstatic-inner-class"><span class="nav-number">3.1.1.5.</span> <span class="nav-text">5. 静态内部类（Static Inner
Class）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9E%9A%E4%B8%BE%E5%8D%95%E4%BE%8Benum-singleton"><span class="nav-number">3.1.1.6.</span> <span class="nav-text">6. 枚举单例（Enum Singleton）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#threadlocal-%E5%8D%95%E4%BE%8B%E7%BA%BF%E7%A8%8B%E5%B1%80%E9%83%A8%E5%8D%95%E4%BE%8B"><span class="nav-number">3.1.1.7.</span> <span class="nav-text">7. ThreadLocal
单例（线程局部单例）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E4%BB%A3%E7%A0%81"><span class="nav-number">3.1.1.8.</span> <span class="nav-text">测试代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%B4%E6%98%8E"><span class="nav-number">3.1.1.9.</span> <span class="nav-text">说明</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93%E8%A1%A8"><span class="nav-number">3.1.1.10.</span> <span class="nav-text">总结表</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A6%82%E4%BD%95%E9%98%B2%E6%AD%A2%E5%BA%8F%E5%88%97%E5%8C%96%E7%A0%B4%E5%9D%8F"><span class="nav-number">3.1.1.11.</span> <span class="nav-text">如何防止序列化破坏</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95factory-method"><span class="nav-number">3.1.2.</span> <span class="nav-text">工厂方法（Factory
Method）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.1.2.1.</span> <span class="nav-text">1. 工厂方法模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.1.2.2.</span> <span class="nav-text">2. 工厂方法模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#uml-%E5%9B%BE"><span class="nav-number">3.1.2.2.1.</span> <span class="nav-text">UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B"><span class="nav-number">3.1.2.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E4%BA%A7%E5%93%81%E6%8E%A5%E5%8F%A3"><span class="nav-number">3.1.2.3.1.</span> <span class="nav-text">3.1 抽象产品接口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E4%BA%A7%E5%93%81%E7%B1%BB"><span class="nav-number">3.1.2.3.2.</span> <span class="nav-text">3.2 具体产品类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E7%B1%BB"><span class="nav-number">3.1.2.3.3.</span> <span class="nav-text">3.3 抽象工厂类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E5%B7%A5%E5%8E%82%E7%B1%BB"><span class="nav-number">3.1.2.3.4.</span> <span class="nav-text">3.4 具体工厂类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81"><span class="nav-number">3.1.2.3.5.</span> <span class="nav-text">3.5 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86"><span class="nav-number">3.1.2.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9"><span class="nav-number">3.1.2.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9"><span class="nav-number">3.1.2.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="nav-number">3.1.2.7.</span> <span class="nav-text">7. 与简单工厂的对比</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%AE%80%E5%8D%95%E5%B7%A5%E5%8E%82%E9%9D%9E%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.1.2.7.1.</span> <span class="nav-text">简单工厂（非工厂方法模式）</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E7%A4%BA%E4%BE%8B%E5%B8%A6%E5%8F%82%E6%95%B0%E7%9A%84%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95"><span class="nav-number">3.1.2.8.</span> <span class="nav-text">8. 扩展示例：带参数的工厂方法</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82"><span class="nav-number">3.1.2.8.1.</span> <span class="nav-text">修改抽象工厂</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%85%B7%E4%BD%93%E5%B7%A5%E5%8E%82"><span class="nav-number">3.1.2.8.2.</span> <span class="nav-text">修改具体工厂</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-number">3.1.2.8.3.</span> <span class="nav-text">客户端</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="nav-number">3.1.2.9.</span> <span class="nav-text">9. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90"><span class="nav-number">3.1.2.10.</span> <span class="nav-text">10. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93"><span class="nav-number">3.1.2.11.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82abstract-factory"><span class="nav-number">3.1.3.</span> <span class="nav-text">抽象工厂（Abstract
Factory）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.1.3.1.</span> <span class="nav-text">1. 抽象工厂模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.1.3.2.</span> <span class="nav-text">2. 抽象工厂模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#uml-%E5%9B%BE-1"><span class="nav-number">3.1.3.2.1.</span> <span class="nav-text">UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-1"><span class="nav-number">3.1.3.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E4%BA%A7%E5%93%81%E6%8E%A5%E5%8F%A3-1"><span class="nav-number">3.1.3.3.1.</span> <span class="nav-text">3.1 抽象产品接口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E4%BA%A7%E5%93%81%E7%B1%BB-1"><span class="nav-number">3.1.3.3.2.</span> <span class="nav-text">3.2 具体产品类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82%E6%8E%A5%E5%8F%A3"><span class="nav-number">3.1.3.3.3.</span> <span class="nav-text">3.3 抽象工厂接口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E5%B7%A5%E5%8E%82%E7%B1%BB-1"><span class="nav-number">3.1.3.3.4.</span> <span class="nav-text">3.4 具体工厂类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-1"><span class="nav-number">3.1.3.3.5.</span> <span class="nav-text">3.5 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-1"><span class="nav-number">3.1.3.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-1"><span class="nav-number">3.1.3.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-1"><span class="nav-number">3.1.3.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E5%B7%A5%E5%8E%82%E6%96%B9%E6%B3%95%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="nav-number">3.1.3.7.</span> <span class="nav-text">7. 与工厂方法的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E7%A4%BA%E4%BE%8B%E5%B8%A6%E5%8F%82%E6%95%B0"><span class="nav-number">3.1.3.8.</span> <span class="nav-text">8. 扩展示例：带参数</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E6%8A%BD%E8%B1%A1%E5%B7%A5%E5%8E%82-1"><span class="nav-number">3.1.3.8.1.</span> <span class="nav-text">修改抽象工厂</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BF%AE%E6%94%B9%E5%85%B7%E4%BD%93%E5%B7%A5%E5%8E%82-1"><span class="nav-number">3.1.3.8.2.</span> <span class="nav-text">修改具体工厂</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF-1"><span class="nav-number">3.1.3.8.3.</span> <span class="nav-text">客户端</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-1"><span class="nav-number">3.1.3.9.</span> <span class="nav-text">9. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-1"><span class="nav-number">3.1.3.10.</span> <span class="nav-text">10. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-1"><span class="nav-number">3.1.3.11.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BB%BA%E9%80%A0%E8%80%85builder"><span class="nav-number">3.1.4.</span> <span class="nav-text">建造者（Builder）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.1.4.1.</span> <span class="nav-text">1. 建造者模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%BB%BA%E9%80%A0%E8%80%85%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.1.4.2.</span> <span class="nav-text">2. 建造者模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#uml-%E5%9B%BE-2"><span class="nav-number">3.1.4.2.1.</span> <span class="nav-text">UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-2"><span class="nav-number">3.1.4.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BA%A7%E5%93%81%E7%B1%BB"><span class="nav-number">3.1.4.3.1.</span> <span class="nav-text">3.1 产品类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E5%BB%BA%E9%80%A0%E8%80%85%E6%8E%A5%E5%8F%A3"><span class="nav-number">3.1.4.3.2.</span> <span class="nav-text">3.2 抽象建造者接口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E5%BB%BA%E9%80%A0%E8%80%85%E7%B1%BB"><span class="nav-number">3.1.4.3.3.</span> <span class="nav-text">3.3 具体建造者类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8C%87%E6%8C%A5%E8%80%85%E7%B1%BB%E5%8F%AF%E9%80%89"><span class="nav-number">3.1.4.3.4.</span> <span class="nav-text">3.4 指挥者类（可选）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-2"><span class="nav-number">3.1.4.3.5.</span> <span class="nav-text">3.5 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-2"><span class="nav-number">3.1.4.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-2"><span class="nav-number">3.1.4.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-2"><span class="nav-number">3.1.4.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="nav-number">3.1.4.7.</span> <span class="nav-text">7. 与工厂模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-2"><span class="nav-number">3.1.4.8.</span> <span class="nav-text">9. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-2"><span class="nav-number">3.1.4.9.</span> <span class="nav-text">10. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-2"><span class="nav-number">3.1.4.10.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8Fprototype"><span class="nav-number">3.1.5.</span> <span class="nav-text">原型模式（Prototype）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.1.5.1.</span> <span class="nav-text">1. 原型模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8E%9F%E5%9E%8B%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.1.5.2.</span> <span class="nav-text">2. 原型模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#uml-%E5%9B%BE-3"><span class="nav-number">3.1.5.2.1.</span> <span class="nav-text">UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-3"><span class="nav-number">3.1.5.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E5%8E%9F%E5%9E%8B%E6%8E%A5%E5%8F%A3"><span class="nav-number">3.1.5.3.1.</span> <span class="nav-text">3.1 抽象原型接口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E5%8E%9F%E5%9E%8B%E7%B1%BB"><span class="nav-number">3.1.5.3.2.</span> <span class="nav-text">3.2 具体原型类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-3"><span class="nav-number">3.1.5.3.3.</span> <span class="nav-text">3.3 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-3"><span class="nav-number">3.1.5.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%B7%B1%E6%8B%B7%E8%B4%9D-vs-%E6%B5%85%E6%8B%B7%E8%B4%9D"><span class="nav-number">3.1.5.5.</span> <span class="nav-text">5. 深拷贝 vs 浅拷贝</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B7%B1%E6%8B%B7%E8%B4%9D%E7%A4%BA%E4%BE%8B"><span class="nav-number">3.1.5.5.1.</span> <span class="nav-text">深拷贝示例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-3"><span class="nav-number">3.1.5.6.</span> <span class="nav-text">6. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-3"><span class="nav-number">3.1.5.7.</span> <span class="nav-text">7. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94-1"><span class="nav-number">3.1.5.8.</span> <span class="nav-text">8. 与工厂模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-3"><span class="nav-number">3.1.5.9.</span> <span class="nav-text">10. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-3"><span class="nav-number">3.1.5.10.</span> <span class="nav-text">11. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-3"><span class="nav-number">3.1.5.11.</span> <span class="nav-text">总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E7%BB%93%E6%9E%84%E5%9E%8B%E6%A8%A1%E5%BC%8Fstructural-patterns"><span class="nav-number">3.2.</span> <span class="nav-text">结构型模式（Structural
Patterns）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E9%80%82%E9%85%8D%E5%99%A8adapter"><span class="nav-number">3.2.1.</span> <span class="nav-text">适配器（Adapter）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.2.1.1.</span> <span class="nav-text">1. 适配器模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.2.1.2.</span> <span class="nav-text">2. 适配器模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#uml-%E5%9B%BE-4"><span class="nav-number">3.2.1.2.1.</span> <span class="nav-text">UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-4"><span class="nav-number">3.2.1.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%9B%AE%E6%A0%87%E6%8E%A5%E5%8F%A3"><span class="nav-number">3.2.1.3.1.</span> <span class="nav-text">3.1 目标接口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%80%82%E9%85%8D%E8%80%85%E7%B1%BB"><span class="nav-number">3.2.1.3.2.</span> <span class="nav-text">3.2 适配者类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1%E9%80%82%E9%85%8D%E5%99%A8"><span class="nav-number">3.2.1.3.3.</span> <span class="nav-text">3.3 对象适配器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%B1%BB%E9%80%82%E9%85%8D%E5%99%A8%E6%9B%BF%E4%BB%A3%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.2.1.3.4.</span> <span class="nav-text">3.4 类适配器（替代实现）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-4"><span class="nav-number">3.2.1.3.5.</span> <span class="nav-text">3.5 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-4"><span class="nav-number">3.2.1.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-4"><span class="nav-number">3.2.1.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-4"><span class="nav-number">3.2.1.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E5%85%B6%E4%BB%96%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="nav-number">3.2.1.7.</span> <span class="nav-text">7. 与其他模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-4"><span class="nav-number">3.2.1.8.</span> <span class="nav-text">8. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-4"><span class="nav-number">3.2.1.9.</span> <span class="nav-text">9. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-4"><span class="nav-number">3.2.1.10.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A1%A5%E6%8E%A5bridge"><span class="nav-number">3.2.2.</span> <span class="nav-text">桥接（Bridge）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.2.2.1.</span> <span class="nav-text">1. 桥接模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A1%A5%E6%8E%A5%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.2.2.2.</span> <span class="nav-text">2. 桥接模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE"><span class="nav-number">3.2.2.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-5"><span class="nav-number">3.2.2.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%9E%E7%8E%B0%E6%8E%A5%E5%8F%A3"><span class="nav-number">3.2.2.3.1.</span> <span class="nav-text">3.1 实现接口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="nav-number">3.2.2.3.2.</span> <span class="nav-text">3.2 具体实现类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E9%83%A8%E5%88%86"><span class="nav-number">3.2.2.3.3.</span> <span class="nav-text">3.3 抽象部分</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BF%AE%E6%AD%A3%E6%8A%BD%E8%B1%A1%E7%B1%BB"><span class="nav-number">3.2.2.3.4.</span> <span class="nav-text">3.4 修正抽象类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-5"><span class="nav-number">3.2.2.3.5.</span> <span class="nav-text">3.5 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-5"><span class="nav-number">3.2.2.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-5"><span class="nav-number">3.2.2.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-5"><span class="nav-number">3.2.2.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="nav-number">3.2.2.7.</span> <span class="nav-text">7. 与适配器模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-5"><span class="nav-number">3.2.2.8.</span> <span class="nav-text">8. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-5"><span class="nav-number">3.2.2.9.</span> <span class="nav-text">9. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-5"><span class="nav-number">3.2.2.10.</span> <span class="nav-text">10. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%BB%84%E5%90%88composite"><span class="nav-number">3.2.3.</span> <span class="nav-text">组合（Composite）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.2.3.1.</span> <span class="nav-text">1. 组合模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BB%84%E5%90%88%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.2.3.2.</span> <span class="nav-text">2. 组合模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-1"><span class="nav-number">3.2.3.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-6"><span class="nav-number">3.2.3.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E7%BB%84%E4%BB%B6"><span class="nav-number">3.2.3.3.1.</span> <span class="nav-text">3.1 抽象组件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%B6%E5%AD%90%E7%B1%BB"><span class="nav-number">3.2.3.3.2.</span> <span class="nav-text">3.2 叶子类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%B9%E5%99%A8%E7%B1%BB"><span class="nav-number">3.2.3.3.3.</span> <span class="nav-text">3.3 容器类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-6"><span class="nav-number">3.2.3.3.4.</span> <span class="nav-text">3.4 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-6"><span class="nav-number">3.2.3.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-6"><span class="nav-number">3.2.3.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-6"><span class="nav-number">3.2.3.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="nav-number">3.2.3.7.</span> <span class="nav-text">7. 与装饰者模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-6"><span class="nav-number">3.2.3.8.</span> <span class="nav-text">8. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-6"><span class="nav-number">3.2.3.9.</span> <span class="nav-text">9. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-6"><span class="nav-number">3.2.3.10.</span> <span class="nav-text">10. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A3%85%E9%A5%B0%E8%80%85decorator"><span class="nav-number">3.2.4.</span> <span class="nav-text">装饰者（Decorator）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.2.4.1.</span> <span class="nav-text">1. 装饰者模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.2.4.2.</span> <span class="nav-text">2. 装饰者模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-2"><span class="nav-number">3.2.4.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-7"><span class="nav-number">3.2.4.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E7%BB%84%E4%BB%B6-1"><span class="nav-number">3.2.4.3.1.</span> <span class="nav-text">3.1 抽象组件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E7%BB%84%E4%BB%B6"><span class="nav-number">3.2.4.3.2.</span> <span class="nav-text">3.2 具体组件</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E8%A3%85%E9%A5%B0%E8%80%85"><span class="nav-number">3.2.4.3.3.</span> <span class="nav-text">3.3 抽象装饰者</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E8%A3%85%E9%A5%B0%E8%80%85"><span class="nav-number">3.2.4.3.4.</span> <span class="nav-text">3.4 具体装饰者</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-7"><span class="nav-number">3.2.4.3.5.</span> <span class="nav-text">3.5 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-7"><span class="nav-number">3.2.4.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-7"><span class="nav-number">3.2.4.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-7"><span class="nav-number">3.2.4.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94-1"><span class="nav-number">3.2.4.7.</span> <span class="nav-text">7. 与适配器模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-7"><span class="nav-number">3.2.4.8.</span> <span class="nav-text">8. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-7"><span class="nav-number">3.2.4.9.</span> <span class="nav-text">9. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-7"><span class="nav-number">3.2.4.10.</span> <span class="nav-text">10. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%96%E8%A7%82facade"><span class="nav-number">3.2.5.</span> <span class="nav-text">外观（Facade）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.2.5.1.</span> <span class="nav-text">1. 外观模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%96%E8%A7%82%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.2.5.2.</span> <span class="nav-text">2. 外观模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-3"><span class="nav-number">3.2.5.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-8"><span class="nav-number">3.2.5.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AD%90%E7%B3%BB%E7%BB%9F%E7%B1%BB"><span class="nav-number">3.2.5.3.1.</span> <span class="nav-text">3.1 子系统类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A4%96%E8%A7%82%E7%B1%BB"><span class="nav-number">3.2.5.3.2.</span> <span class="nav-text">3.2 外观类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-8"><span class="nav-number">3.2.5.3.3.</span> <span class="nav-text">3.3 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-8"><span class="nav-number">3.2.5.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-8"><span class="nav-number">3.2.5.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-8"><span class="nav-number">3.2.5.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94-2"><span class="nav-number">3.2.5.7.</span> <span class="nav-text">7. 与适配器模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-8"><span class="nav-number">3.2.5.8.</span> <span class="nav-text">8. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-8"><span class="nav-number">3.2.5.9.</span> <span class="nav-text">9. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-8"><span class="nav-number">3.2.5.10.</span> <span class="nav-text">10. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%AB%E5%85%83flyweight"><span class="nav-number">3.2.6.</span> <span class="nav-text">享元（Flyweight）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.2.6.1.</span> <span class="nav-text">1. 享元模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%AB%E5%85%83%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.2.6.2.</span> <span class="nav-text">2. 享元模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-4"><span class="nav-number">3.2.6.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-9"><span class="nav-number">3.2.6.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E4%BA%AB%E5%85%83%E6%8E%A5%E5%8F%A3"><span class="nav-number">3.2.6.3.1.</span> <span class="nav-text">3.1 抽象享元接口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E4%BA%AB%E5%85%83%E7%B1%BB"><span class="nav-number">3.2.6.3.2.</span> <span class="nav-text">3.2 具体享元类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BA%AB%E5%85%83%E5%B7%A5%E5%8E%82"><span class="nav-number">3.2.6.3.3.</span> <span class="nav-text">3.3 享元工厂</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-9"><span class="nav-number">3.2.6.3.4.</span> <span class="nav-text">3.4 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-9"><span class="nav-number">3.2.6.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%86%85%E5%9C%A8%E7%8A%B6%E6%80%81-vs-%E5%A4%96%E5%9C%A8%E7%8A%B6%E6%80%81"><span class="nav-number">3.2.6.5.</span> <span class="nav-text">5. 内在状态 vs 外在状态</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-9"><span class="nav-number">3.2.6.6.</span> <span class="nav-text">6. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-9"><span class="nav-number">3.2.6.7.</span> <span class="nav-text">7. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="nav-number">3.2.6.8.</span> <span class="nav-text">8. 与单例模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-9"><span class="nav-number">3.2.6.9.</span> <span class="nav-text">9. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-9"><span class="nav-number">3.2.6.10.</span> <span class="nav-text">10. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-9"><span class="nav-number">3.2.6.11.</span> <span class="nav-text">11. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%A3%E7%90%86proxy"><span class="nav-number">3.2.7.</span> <span class="nav-text">代理（Proxy）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.2.7.1.</span> <span class="nav-text">1. 代理模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.2.7.2.</span> <span class="nav-text">2. 代理模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-5"><span class="nav-number">3.2.7.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%A3%E7%90%86%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="nav-number">3.2.7.3.</span> <span class="nav-text">3. 代理模式的类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-10"><span class="nav-number">3.2.7.4.</span> <span class="nav-text">4. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E4%B8%BB%E9%A2%98"><span class="nav-number">3.2.7.4.1.</span> <span class="nav-text">4.1 抽象主题</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%9C%9F%E5%AE%9E%E4%B8%BB%E9%A2%98"><span class="nav-number">3.2.7.4.2.</span> <span class="nav-text">4.2 真实主题</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%9D%99%E6%80%81%E4%BB%A3%E7%90%86"><span class="nav-number">3.2.7.4.3.</span> <span class="nav-text">4.3 静态代理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="nav-number">3.2.7.4.4.</span> <span class="nav-text">4.4 动态代理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-10"><span class="nav-number">3.2.7.4.5.</span> <span class="nav-text">4.5 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-10"><span class="nav-number">3.2.7.5.</span> <span class="nav-text">5. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-10"><span class="nav-number">3.2.7.6.</span> <span class="nav-text">6. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-10"><span class="nav-number">3.2.7.7.</span> <span class="nav-text">7. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94-1"><span class="nav-number">3.2.7.8.</span> <span class="nav-text">8. 与装饰者模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-10"><span class="nav-number">3.2.7.9.</span> <span class="nav-text">9. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-10"><span class="nav-number">3.2.7.10.</span> <span class="nav-text">10. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-10"><span class="nav-number">3.2.7.11.</span> <span class="nav-text">11. 总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%A1%8C%E4%B8%BA%E5%9E%8B%E6%A8%A1%E5%BC%8Fbehavioral-patterns"><span class="nav-number">3.3.</span> <span class="nav-text">行为型模式（Behavioral
Patterns）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%B4%A3%E4%BB%BB%E9%93%BEchain-of-responsibility"><span class="nav-number">3.3.1.</span> <span class="nav-text">责任链（Chain of
Responsibility）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.3.1.1.</span> <span class="nav-text">1. 责任链模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%B4%A3%E4%BB%BB%E9%93%BE%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.3.1.2.</span> <span class="nav-text">2. 责任链模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-6"><span class="nav-number">3.3.1.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-11"><span class="nav-number">3.3.1.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E5%A4%84%E7%90%86%E8%80%85"><span class="nav-number">3.3.1.3.1.</span> <span class="nav-text">3.1 抽象处理者</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E5%A4%84%E7%90%86%E8%80%85"><span class="nav-number">3.3.1.3.2.</span> <span class="nav-text">3.2 具体处理者</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-11"><span class="nav-number">3.3.1.3.3.</span> <span class="nav-text">3.3 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-11"><span class="nav-number">3.3.1.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-11"><span class="nav-number">3.3.1.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-11"><span class="nav-number">3.3.1.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E8%A3%85%E9%A5%B0%E8%80%85%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94-2"><span class="nav-number">3.3.1.7.</span> <span class="nav-text">7. 与装饰者模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-11"><span class="nav-number">3.3.1.8.</span> <span class="nav-text">8. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-11"><span class="nav-number">3.3.1.9.</span> <span class="nav-text">9. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-11"><span class="nav-number">3.3.1.10.</span> <span class="nav-text">10. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4command"><span class="nav-number">3.3.2.</span> <span class="nav-text">命令（Command）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.3.2.1.</span> <span class="nav-text">1. 命令模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.3.2.2.</span> <span class="nav-text">2. 命令模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-7"><span class="nav-number">3.3.2.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-12"><span class="nav-number">3.3.2.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8E%A5%E6%94%B6%E8%80%85"><span class="nav-number">3.3.2.3.1.</span> <span class="nav-text">3.1 接收者</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E5%91%BD%E4%BB%A4"><span class="nav-number">3.3.2.3.2.</span> <span class="nav-text">3.2 抽象命令</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E5%91%BD%E4%BB%A4"><span class="nav-number">3.3.2.3.3.</span> <span class="nav-text">3.3 具体命令</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%B0%83%E7%94%A8%E8%80%85"><span class="nav-number">3.3.2.3.4.</span> <span class="nav-text">3.4 调用者</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-12"><span class="nav-number">3.3.2.3.5.</span> <span class="nav-text">3.5 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-12"><span class="nav-number">3.3.2.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-12"><span class="nav-number">3.3.2.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-12"><span class="nav-number">3.3.2.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%94%AF%E6%8C%81%E6%92%A4%E9%94%80%E7%9A%84%E6%89%A9%E5%B1%95"><span class="nav-number">3.3.2.7.</span> <span class="nav-text">7. 支持撤销的扩展</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="nav-number">3.3.2.8.</span> <span class="nav-text">8. 与策略模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-12"><span class="nav-number">3.3.2.9.</span> <span class="nav-text">9. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-12"><span class="nav-number">3.3.2.10.</span> <span class="nav-text">10. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-12"><span class="nav-number">3.3.2.11.</span> <span class="nav-text">11. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%A3%E9%87%8A%E5%99%A8interpreter"><span class="nav-number">3.3.3.</span> <span class="nav-text">解释器（Interpreter）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.3.3.1.</span> <span class="nav-text">1. 解释器模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%A3%E9%87%8A%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.3.3.2.</span> <span class="nav-text">2. 解释器模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-8"><span class="nav-number">3.3.3.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-13"><span class="nav-number">3.3.3.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%8A%E4%B8%8B%E6%96%87%E7%B1%BB"><span class="nav-number">3.3.3.3.1.</span> <span class="nav-text">3.1 上下文类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">3.3.3.3.2.</span> <span class="nav-text">3.2 抽象表达式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%BB%88%E7%BB%93%E7%AC%A6%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">3.3.3.3.3.</span> <span class="nav-text">3.3 终结符表达式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%9D%9E%E7%BB%88%E7%BB%93%E7%AC%A6%E8%A1%A8%E8%BE%BE%E5%BC%8F"><span class="nav-number">3.3.3.3.4.</span> <span class="nav-text">3.4 非终结符表达式</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-13"><span class="nav-number">3.3.3.3.5.</span> <span class="nav-text">3.5 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-13"><span class="nav-number">3.3.3.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-13"><span class="nav-number">3.3.3.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-13"><span class="nav-number">3.3.3.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E5%85%B6%E4%BB%96%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94-1"><span class="nav-number">3.3.3.7.</span> <span class="nav-text">7. 与其他模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-13"><span class="nav-number">3.3.3.8.</span> <span class="nav-text">8. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-13"><span class="nav-number">3.3.3.9.</span> <span class="nav-text">9. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-13"><span class="nav-number">3.3.3.10.</span> <span class="nav-text">10. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8iterator"><span class="nav-number">3.3.4.</span> <span class="nav-text">迭代器（Iterator）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.3.4.1.</span> <span class="nav-text">1. 迭代器模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.3.4.2.</span> <span class="nav-text">2. 迭代器模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-9"><span class="nav-number">3.3.4.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-14"><span class="nav-number">3.3.4.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="nav-number">3.3.4.3.1.</span> <span class="nav-text">3.1 抽象迭代器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E8%81%9A%E5%90%88"><span class="nav-number">3.3.4.3.2.</span> <span class="nav-text">3.2 抽象聚合</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E8%81%9A%E5%90%88"><span class="nav-number">3.3.4.3.3.</span> <span class="nav-text">3.3 具体聚合</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E8%BF%AD%E4%BB%A3%E5%99%A8"><span class="nav-number">3.3.4.3.4.</span> <span class="nav-text">3.4 具体迭代器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-14"><span class="nav-number">3.3.4.3.5.</span> <span class="nav-text">3.5 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-14"><span class="nav-number">3.3.4.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-14"><span class="nav-number">3.3.4.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-14"><span class="nav-number">3.3.4.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E5%85%B6%E4%BB%96%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94-2"><span class="nav-number">3.3.4.7.</span> <span class="nav-text">7. 与其他模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-14"><span class="nav-number">3.3.4.8.</span> <span class="nav-text">8. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-14"><span class="nav-number">3.3.4.9.</span> <span class="nav-text">9. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-14"><span class="nav-number">3.3.4.10.</span> <span class="nav-text">10. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%AD%E4%BB%8B%E8%80%85mediator"><span class="nav-number">3.3.5.</span> <span class="nav-text">中介者（Mediator）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.3.5.1.</span> <span class="nav-text">1. 中介者模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.3.5.2.</span> <span class="nav-text">2. 中介者模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-10"><span class="nav-number">3.3.5.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-15"><span class="nav-number">3.3.5.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E4%B8%AD%E4%BB%8B%E8%80%85"><span class="nav-number">3.3.5.3.1.</span> <span class="nav-text">3.1 抽象中介者</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E4%B8%AD%E4%BB%8B%E8%80%85"><span class="nav-number">3.3.5.3.2.</span> <span class="nav-text">3.2 具体中介者</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E5%90%8C%E4%BA%8B"><span class="nav-number">3.3.5.3.3.</span> <span class="nav-text">3.3 抽象同事</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E5%90%8C%E4%BA%8B"><span class="nav-number">3.3.5.3.4.</span> <span class="nav-text">3.4 具体同事</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-15"><span class="nav-number">3.3.5.3.5.</span> <span class="nav-text">3.5 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-15"><span class="nav-number">3.3.5.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-15"><span class="nav-number">3.3.5.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-15"><span class="nav-number">3.3.5.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="nav-number">3.3.5.7.</span> <span class="nav-text">7. 与观察者模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-15"><span class="nav-number">3.3.5.8.</span> <span class="nav-text">8. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-15"><span class="nav-number">3.3.5.9.</span> <span class="nav-text">9. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-15"><span class="nav-number">3.3.5.10.</span> <span class="nav-text">10. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%87%E5%BF%98%E5%BD%95memento"><span class="nav-number">3.3.6.</span> <span class="nav-text">备忘录（Memento）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.3.6.1.</span> <span class="nav-text">1. 备忘录模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%87%E5%BF%98%E5%BD%95%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.3.6.2.</span> <span class="nav-text">2. 备忘录模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-11"><span class="nav-number">3.3.6.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-16"><span class="nav-number">3.3.6.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%A4%87%E5%BF%98%E5%BD%95%E7%B1%BB"><span class="nav-number">3.3.6.3.1.</span> <span class="nav-text">3.1 备忘录类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8E%9F%E5%8F%91%E5%99%A8%E7%B1%BB"><span class="nav-number">3.3.6.3.2.</span> <span class="nav-text">3.2 原发器类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E7%AE%A1%E7%90%86%E8%80%85%E7%B1%BB"><span class="nav-number">3.3.6.3.3.</span> <span class="nav-text">3.3 管理者类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-16"><span class="nav-number">3.3.6.3.4.</span> <span class="nav-text">3.4 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-16"><span class="nav-number">3.3.6.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-16"><span class="nav-number">3.3.6.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-16"><span class="nav-number">3.3.6.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E5%91%BD%E4%BB%A4%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="nav-number">3.3.6.7.</span> <span class="nav-text">7. 与命令模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-16"><span class="nav-number">3.3.6.8.</span> <span class="nav-text">8. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-16"><span class="nav-number">3.3.6.9.</span> <span class="nav-text">9. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-16"><span class="nav-number">3.3.6.10.</span> <span class="nav-text">10. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85observer"><span class="nav-number">3.3.7.</span> <span class="nav-text">观察者（Observer）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.3.7.1.</span> <span class="nav-text">1. 观察者模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.3.7.2.</span> <span class="nav-text">2. 观察者模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-12"><span class="nav-number">3.3.7.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-17"><span class="nav-number">3.3.7.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E8%A7%82%E5%AF%9F%E8%80%85"><span class="nav-number">3.3.7.3.1.</span> <span class="nav-text">3.1 抽象观察者</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E4%B8%BB%E9%A2%98-1"><span class="nav-number">3.3.7.3.2.</span> <span class="nav-text">3.2 抽象主题</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E4%B8%BB%E9%A2%98"><span class="nav-number">3.3.7.3.3.</span> <span class="nav-text">3.3 具体主题</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E8%A7%82%E5%AF%9F%E8%80%85"><span class="nav-number">3.3.7.3.4.</span> <span class="nav-text">3.4 具体观察者</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-17"><span class="nav-number">3.3.7.3.5.</span> <span class="nav-text">3.5 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-17"><span class="nav-number">3.3.7.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-17"><span class="nav-number">3.3.7.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-17"><span class="nav-number">3.3.7.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E4%B8%AD%E4%BB%8B%E8%80%85%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="nav-number">3.3.7.7.</span> <span class="nav-text">7. 与中介者模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-17"><span class="nav-number">3.3.7.8.</span> <span class="nav-text">8. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-17"><span class="nav-number">3.3.7.9.</span> <span class="nav-text">9. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-17"><span class="nav-number">3.3.7.10.</span> <span class="nav-text">10. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%8A%B6%E6%80%81state"><span class="nav-number">3.3.8.</span> <span class="nav-text">状态（State）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.3.8.1.</span> <span class="nav-text">1. 状态模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.3.8.2.</span> <span class="nav-text">2. 状态模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-13"><span class="nav-number">3.3.8.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-18"><span class="nav-number">3.3.8.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E7%8A%B6%E6%80%81"><span class="nav-number">3.3.8.3.1.</span> <span class="nav-text">3.1 抽象状态</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E7%8A%B6%E6%80%81"><span class="nav-number">3.3.8.3.2.</span> <span class="nav-text">3.2 具体状态</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="nav-number">3.3.8.3.3.</span> <span class="nav-text">3.3 上下文</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-18"><span class="nav-number">3.3.8.3.4.</span> <span class="nav-text">3.4 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-18"><span class="nav-number">3.3.8.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-18"><span class="nav-number">3.3.8.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-18"><span class="nav-number">3.3.8.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94-1"><span class="nav-number">3.3.8.7.</span> <span class="nav-text">7. 与策略模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-18"><span class="nav-number">3.3.8.8.</span> <span class="nav-text">8. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-18"><span class="nav-number">3.3.8.9.</span> <span class="nav-text">9. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-18"><span class="nav-number">3.3.8.10.</span> <span class="nav-text">10. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%AD%96%E7%95%A5strategy"><span class="nav-number">3.3.9.</span> <span class="nav-text">策略（Strategy）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.3.9.1.</span> <span class="nav-text">1. 策略模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.3.9.2.</span> <span class="nav-text">2. 策略模式的结构</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-14"><span class="nav-number">3.3.9.3.</span> <span class="nav-text"># Mermaid UML 图</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-19"><span class="nav-number">3.3.9.4.</span> <span class="nav-text">3. Java 实现示例</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E7%AD%96%E7%95%A5"><span class="nav-number">3.3.9.5.</span> <span class="nav-text"># 3.1 抽象策略</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E7%AD%96%E7%95%A5"><span class="nav-number">3.3.9.6.</span> <span class="nav-text"># 3.2 具体策略</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8A%E4%B8%8B%E6%96%87-1"><span class="nav-number">3.3.9.7.</span> <span class="nav-text"># 3.3 上下文</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-19"><span class="nav-number">3.3.9.8.</span> <span class="nav-text"># 3.4 客户端代码</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-19"><span class="nav-number">3.3.9.9.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-19"><span class="nav-number">3.3.9.10.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-19"><span class="nav-number">3.3.9.11.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E7%8A%B6%E6%80%81%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="nav-number">3.3.9.12.</span> <span class="nav-text">7. 与状态模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-19"><span class="nav-number">3.3.9.13.</span> <span class="nav-text">8. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-19"><span class="nav-number">3.3.9.14.</span> <span class="nav-text">9. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-19"><span class="nav-number">3.3.9.15.</span> <span class="nav-text">10. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95template-method"><span class="nav-number">3.3.10.</span> <span class="nav-text">模板方法（Template
Method）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.3.10.1.</span> <span class="nav-text">1. 模板方法模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A8%A1%E6%9D%BF%E6%96%B9%E6%B3%95%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.3.10.2.</span> <span class="nav-text">2. 模板方法模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-15"><span class="nav-number">3.3.10.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-20"><span class="nav-number">3.3.10.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E7%B1%BB"><span class="nav-number">3.3.10.3.1.</span> <span class="nav-text">3.1 抽象类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E7%B1%BB"><span class="nav-number">3.3.10.3.2.</span> <span class="nav-text">3.2 具体类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-20"><span class="nav-number">3.3.10.3.3.</span> <span class="nav-text">3.3 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-20"><span class="nav-number">3.3.10.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-20"><span class="nav-number">3.3.10.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-20"><span class="nav-number">3.3.10.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94-2"><span class="nav-number">3.3.10.7.</span> <span class="nav-text">7. 与策略模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-20"><span class="nav-number">3.3.10.8.</span> <span class="nav-text">8. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-20"><span class="nav-number">3.3.10.9.</span> <span class="nav-text">9. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-20"><span class="nav-number">3.3.10.10.</span> <span class="nav-text">10. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E8%80%85visitor"><span class="nav-number">3.3.11.</span> <span class="nav-text">访问者（Visitor）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.3.11.1.</span> <span class="nav-text">1. 访问者模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AE%BF%E9%97%AE%E8%80%85%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.3.11.2.</span> <span class="nav-text">2. 访问者模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-16"><span class="nav-number">3.3.11.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-21"><span class="nav-number">3.3.11.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E5%85%83%E7%B4%A0"><span class="nav-number">3.3.11.3.1.</span> <span class="nav-text">3.1 抽象元素</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E5%85%83%E7%B4%A0"><span class="nav-number">3.3.11.3.2.</span> <span class="nav-text">3.2 具体元素</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8A%BD%E8%B1%A1%E8%AE%BF%E9%97%AE%E8%80%85"><span class="nav-number">3.3.11.3.3.</span> <span class="nav-text">3.3 抽象访问者</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E8%AE%BF%E9%97%AE%E8%80%85"><span class="nav-number">3.3.11.3.4.</span> <span class="nav-text">3.4 具体访问者</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AF%B9%E8%B1%A1%E7%BB%93%E6%9E%84%E5%8F%AF%E9%80%89"><span class="nav-number">3.3.11.3.5.</span> <span class="nav-text">3.5 对象结构（可选）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-21"><span class="nav-number">3.3.11.3.6.</span> <span class="nav-text">3.6 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-21"><span class="nav-number">3.3.11.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-21"><span class="nav-number">3.3.11.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-21"><span class="nav-number">3.3.11.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E8%BF%AD%E4%BB%A3%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="nav-number">3.3.11.7.</span> <span class="nav-text">7. 与迭代器模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-21"><span class="nav-number">3.3.11.8.</span> <span class="nav-text">8. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-21"><span class="nav-number">3.3.11.9.</span> <span class="nav-text">9. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-21"><span class="nav-number">3.3.11.10.</span> <span class="nav-text">10. 总结</span></a></li></ol></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E6%A8%A1%E5%BC%8Fextended-patterns"><span class="nav-number">3.4.</span> <span class="nav-text">扩展模式（Extended Patterns）</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5dependency-injection"><span class="nav-number">3.4.1.</span> <span class="nav-text">依赖注入（Dependency
Injection）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.4.1.1.</span> <span class="nav-text">1. 依赖注入模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.4.1.2.</span> <span class="nav-text">2. 依赖注入模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-17"><span class="nav-number">3.4.1.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E7%9A%84%E7%B1%BB%E5%9E%8B"><span class="nav-number">3.4.1.3.</span> <span class="nav-text">3. 依赖注入的类型</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-22"><span class="nav-number">3.4.1.4.</span> <span class="nav-text">4. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3"><span class="nav-number">3.4.1.4.1.</span> <span class="nav-text">4.1 服务接口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E6%9C%8D%E5%8A%A1"><span class="nav-number">3.4.1.4.2.</span> <span class="nav-text">4.2 具体服务</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%9E%84%E9%80%A0%E5%87%BD%E6%95%B0%E6%B3%A8%E5%85%A5"><span class="nav-number">3.4.1.4.3.</span> <span class="nav-text">4.3 客户端（构造函数注入）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AFsetter-%E6%B3%A8%E5%85%A5"><span class="nav-number">3.4.1.4.4.</span> <span class="nav-text">4.4 客户端（Setter 注入）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B3%A8%E5%85%A5%E5%99%A8%E6%89%8B%E5%8A%A8%E5%AE%9E%E7%8E%B0"><span class="nav-number">3.4.1.4.5.</span> <span class="nav-text">4.5 注入器（手动实现）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-22"><span class="nav-number">3.4.1.4.6.</span> <span class="nav-text">4.6 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-22"><span class="nav-number">3.4.1.5.</span> <span class="nav-text">5. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-22"><span class="nav-number">3.4.1.6.</span> <span class="nav-text">6. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-22"><span class="nav-number">3.4.1.7.</span> <span class="nav-text">7. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94-2"><span class="nav-number">3.4.1.8.</span> <span class="nav-text">8. 与工厂模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-22"><span class="nav-number">3.4.1.9.</span> <span class="nav-text">9. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90spring-%E7%A4%BA%E4%BE%8B"><span class="nav-number">3.4.1.10.</span> <span class="nav-text">10. 源码中的例子（Spring 示例）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-22"><span class="nav-number">3.4.1.11.</span> <span class="nav-text">11. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8F%91%E5%B8%83-%E8%AE%A2%E9%98%85publish-subscribe"><span class="nav-number">3.4.2.</span> <span class="nav-text">发布-订阅（Publish-Subscribe）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.4.2.1.</span> <span class="nav-text">1. 发布订阅模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%8F%91%E5%B8%83%E8%AE%A2%E9%98%85%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.4.2.2.</span> <span class="nav-text">2. 发布订阅模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-18"><span class="nav-number">3.4.2.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-23"><span class="nav-number">3.4.2.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B6%88%E6%81%AF%E4%BB%A3%E7%90%86"><span class="nav-number">3.4.2.3.1.</span> <span class="nav-text">3.1 消息代理</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%AE%A2%E9%98%85%E8%80%85%E6%8E%A5%E5%8F%A3"><span class="nav-number">3.4.2.3.2.</span> <span class="nav-text">3.2 订阅者接口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E8%AE%A2%E9%98%85%E8%80%85"><span class="nav-number">3.4.2.3.3.</span> <span class="nav-text">3.3 具体订阅者</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%8F%91%E5%B8%83%E8%80%85"><span class="nav-number">3.4.2.3.4.</span> <span class="nav-text">3.4 发布者</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-23"><span class="nav-number">3.4.2.3.5.</span> <span class="nav-text">3.5 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-23"><span class="nav-number">3.4.2.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-23"><span class="nav-number">3.4.2.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-23"><span class="nav-number">3.4.2.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E8%A7%82%E5%AF%9F%E8%80%85%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94-1"><span class="nav-number">3.4.2.7.</span> <span class="nav-text">7. 与观察者模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-23"><span class="nav-number">3.4.2.8.</span> <span class="nav-text">8. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-22"><span class="nav-number">3.4.2.9.</span> <span class="nav-text">9. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-23"><span class="nav-number">3.4.2.10.</span> <span class="nav-text">10. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E6%A8%A1%E5%BC%8Fmodule-pattern"><span class="nav-number">3.4.3.</span> <span class="nav-text">模块模式（Module
Pattern）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.4.3.1.</span> <span class="nav-text">1. 模块模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84javascript-%E8%A7%86%E8%A7%92"><span class="nav-number">3.4.3.2.</span> <span class="nav-text">2. 模块模式的结构（JavaScript
视角）</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#javascript-%E7%A4%BA%E4%BE%8B"><span class="nav-number">3.4.3.2.1.</span> <span class="nav-text">JavaScript 示例</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E4%B8%AD%E7%9A%84%E6%A8%A1%E5%9D%97%E6%A8%A1%E5%BC%8F%E9%80%82%E9%85%8D"><span class="nav-number">3.4.3.3.</span> <span class="nav-text">3. Java 中的模块模式适配</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E7%B1%BB%E5%B0%81%E8%A3%85%E7%B1%BB%E4%BC%BC-javascript-%E6%A8%A1%E5%9D%97%E6%A8%A1%E5%BC%8F"><span class="nav-number">3.4.3.3.1.</span> <span class="nav-text">3.1 使用类封装（类似
JavaScript 模块模式）</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E7%B1%BB"><span class="nav-number">3.4.3.3.1.1.</span> <span class="nav-text">模块类</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-24"><span class="nav-number">3.4.3.3.1.2.</span> <span class="nav-text">客户端代码</span></a></li></ol></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8-java-9-%E6%A8%A1%E5%9D%97%E7%B3%BB%E7%BB%9Fjpms"><span class="nav-number">3.4.3.3.2.</span> <span class="nav-text">3.2 使用 Java 9+ 模块系统（JPMS）</span></a><ol class="nav-child"><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E5%AE%9A%E4%B9%89module-info.java"><span class="nav-number">3.4.3.3.2.1.</span> <span class="nav-text">模块定义（module-info.java）</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E6%A8%A1%E5%9D%97%E5%AE%9E%E7%8E%B0com.example.counter.countermodule"><span class="nav-number">3.4.3.3.2.2.</span> <span class="nav-text">模块实现（com.example.counter.CounterModule）</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E6%A8%A1%E5%9D%97module-info.java"><span class="nav-number">3.4.3.3.2.3.</span> <span class="nav-text">客户端模块（module-info.java）</span></a></li><li class="nav-item nav-level-6"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81com.example.client.main"><span class="nav-number">3.4.3.3.2.4.</span> <span class="nav-text">客户端代码（com.example.client.Main）</span></a></li></ol></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-24"><span class="nav-number">3.4.3.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-24"><span class="nav-number">3.4.3.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-24"><span class="nav-number">3.4.3.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E5%B7%A5%E5%8E%82%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94-3"><span class="nav-number">3.4.3.7.</span> <span class="nav-text">7. 与工厂模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-24"><span class="nav-number">3.4.3.8.</span> <span class="nav-text">8. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-23"><span class="nav-number">3.4.3.9.</span> <span class="nav-text">9. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-24"><span class="nav-number">3.4.3.10.</span> <span class="nav-text">10. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mvcmodel-view-controller"><span class="nav-number">3.4.4.</span> <span class="nav-text">MVC（Model-View-Controller）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#mvc-%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.4.4.1.</span> <span class="nav-text">1. MVC 模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mvc-%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.4.4.2.</span> <span class="nav-text">2. MVC 模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-19"><span class="nav-number">3.4.4.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-24"><span class="nav-number">3.4.4.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A8%A1%E5%9E%8Bmodel"><span class="nav-number">3.4.4.3.1.</span> <span class="nav-text">3.1 模型（Model）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%86%E5%9B%BEview"><span class="nav-number">3.4.4.3.2.</span> <span class="nav-text">3.2 视图（View）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%8E%A7%E5%88%B6%E5%99%A8controller"><span class="nav-number">3.4.4.3.3.</span> <span class="nav-text">3.3 控制器（Controller）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-25"><span class="nav-number">3.4.4.3.4.</span> <span class="nav-text">3.4 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-25"><span class="nav-number">3.4.4.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-25"><span class="nav-number">3.4.4.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-25"><span class="nav-number">3.4.4.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E-mvpmvvm-%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="nav-number">3.4.4.7.</span> <span class="nav-text">7. 与 MVP&#x2F;MVVM 的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-25"><span class="nav-number">3.4.4.8.</span> <span class="nav-text">8. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-24"><span class="nav-number">3.4.4.9.</span> <span class="nav-text">9. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-25"><span class="nav-number">3.4.4.10.</span> <span class="nav-text">10. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mvpmodel-view-presenter"><span class="nav-number">3.4.5.</span> <span class="nav-text">MVP（Model-View-Presenter）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#mvp-%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.4.5.1.</span> <span class="nav-text">1. MVP 模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mvp-%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.4.5.2.</span> <span class="nav-text">2. MVP 模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-20"><span class="nav-number">3.4.5.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-25"><span class="nav-number">3.4.5.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A8%A1%E5%9E%8Bmodel-1"><span class="nav-number">3.4.5.3.1.</span> <span class="nav-text">3.1 模型（Model）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE%E6%8E%A5%E5%8F%A3view"><span class="nav-number">3.4.5.3.2.</span> <span class="nav-text">3.2 视图接口（View）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E8%A7%86%E5%9B%BEconcrete-view"><span class="nav-number">3.4.5.3.3.</span> <span class="nav-text">3.3 具体视图（Concrete View）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%B1%95%E7%A4%BA%E8%80%85presenter"><span class="nav-number">3.4.5.3.4.</span> <span class="nav-text">3.4 展示者（Presenter）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-26"><span class="nav-number">3.4.5.3.5.</span> <span class="nav-text">3.5 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-26"><span class="nav-number">3.4.5.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-26"><span class="nav-number">3.4.5.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-26"><span class="nav-number">3.4.5.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E-mvc-%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="nav-number">3.4.5.7.</span> <span class="nav-text">7. 与 MVC 的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-26"><span class="nav-number">3.4.5.8.</span> <span class="nav-text">8. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-25"><span class="nav-number">3.4.5.9.</span> <span class="nav-text">9. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-26"><span class="nav-number">3.4.5.10.</span> <span class="nav-text">10. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mvvmmodel-view-viewmodel"><span class="nav-number">3.4.6.</span> <span class="nav-text">MVVM（Model-View-ViewModel）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#mvvm-%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.4.6.1.</span> <span class="nav-text">1. MVVM 模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#mvvm-%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.4.6.2.</span> <span class="nav-text">2. MVVM 模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-21"><span class="nav-number">3.4.6.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-26"><span class="nav-number">3.4.6.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%A8%A1%E5%9E%8Bmodel-2"><span class="nav-number">3.4.6.3.1.</span> <span class="nav-text">3.1 模型（Model）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%86%E5%9B%BEview-1"><span class="nav-number">3.4.6.3.2.</span> <span class="nav-text">3.2 视图（View）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE%E6%A8%A1%E5%9E%8Bviewmodel"><span class="nav-number">3.4.6.3.3.</span> <span class="nav-text">3.3 视图模型（ViewModel）</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-27"><span class="nav-number">3.4.6.3.4.</span> <span class="nav-text">3.4 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-27"><span class="nav-number">3.4.6.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-27"><span class="nav-number">3.4.6.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-27"><span class="nav-number">3.4.6.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E-mvcmvp-%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="nav-number">3.4.6.7.</span> <span class="nav-text">7. 与 MVC&#x2F;MVP 的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-27"><span class="nav-number">3.4.6.8.</span> <span class="nav-text">8. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90javafx"><span class="nav-number">3.4.6.9.</span> <span class="nav-text">9. 源码中的例子（JavaFX）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-27"><span class="nav-number">3.4.6.10.</span> <span class="nav-text">10. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mvc-mvp-mvvm-%E6%AF%94%E8%BE%83"><span class="nav-number">3.4.7.</span> <span class="nav-text">MVC, MVP, MVVM 比较</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%A6%E7%BB%86%E8%AF%B4%E6%98%8E"><span class="nav-number">3.4.7.1.</span> <span class="nav-text">详细说明</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%95%B0%E6%8D%AE%E6%B5%81"><span class="nav-number">3.4.7.1.1.</span> <span class="nav-text">数据流</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%A7%86%E5%9B%BE%E4%B8%8E%E6%A8%A1%E5%9E%8B%E5%85%B3%E7%B3%BB"><span class="nav-number">3.4.7.1.2.</span> <span class="nav-text">视图与模型关系</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%B5%8B%E8%AF%95%E6%80%A7"><span class="nav-number">3.4.7.1.3.</span> <span class="nav-text">测试性</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#java-%E7%A4%BA%E4%BE%8B%E4%BB%A3%E7%A0%81%E7%89%87%E6%AE%B5"><span class="nav-number">3.4.7.1.4.</span> <span class="nav-text">Java 示例代码片段</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-28"><span class="nav-number">3.4.7.2.</span> <span class="nav-text">总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BB%93%E5%82%A8%E6%A8%A1%E5%BC%8Frepository-pattern"><span class="nav-number">3.4.8.</span> <span class="nav-text">仓储模式（Repository
Pattern）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%93%E5%82%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.4.8.1.</span> <span class="nav-text">1. 仓储模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BB%93%E5%82%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.4.8.2.</span> <span class="nav-text">2. 仓储模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-22"><span class="nav-number">3.4.8.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-27"><span class="nav-number">3.4.8.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E9%A2%86%E5%9F%9F%E6%A8%A1%E5%9E%8B"><span class="nav-number">3.4.8.3.1.</span> <span class="nav-text">3.1 领域模型</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BB%93%E5%82%A8%E6%8E%A5%E5%8F%A3"><span class="nav-number">3.4.8.3.2.</span> <span class="nav-text">3.2 仓储接口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E4%BB%93%E5%82%A8"><span class="nav-number">3.4.8.3.3.</span> <span class="nav-text">3.3 具体仓储</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-28"><span class="nav-number">3.4.8.3.4.</span> <span class="nav-text">3.4 客户端代码</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%89%A9%E5%B1%95%E6%95%B0%E6%8D%AE%E5%BA%93%E4%BB%93%E5%82%A8"><span class="nav-number">3.4.8.3.5.</span> <span class="nav-text">3.5 扩展：数据库仓储</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-28"><span class="nav-number">3.4.8.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-28"><span class="nav-number">3.4.8.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-28"><span class="nav-number">3.4.8.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E-dao-%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="nav-number">3.4.8.7.</span> <span class="nav-text">7. 与 DAO 模式的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-28"><span class="nav-number">3.4.8.8.</span> <span class="nav-text">8. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90spring-data"><span class="nav-number">3.4.8.9.</span> <span class="nav-text">9. 源码中的例子（Spring Data）</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-29"><span class="nav-number">3.4.8.10.</span> <span class="nav-text">10. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%AE%9A%E4%BD%8D%E5%99%A8service-locator"><span class="nav-number">3.4.9.</span> <span class="nav-text">服务定位器（Service
Locator）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%AE%9A%E4%BD%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.4.9.1.</span> <span class="nav-text">1. 服务定位器模式的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%AE%9A%E4%BD%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.4.9.2.</span> <span class="nav-text">2. 服务定位器模式的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-23"><span class="nav-number">3.4.9.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-28"><span class="nav-number">3.4.9.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E6%8E%A5%E5%8F%A3-1"><span class="nav-number">3.4.9.3.1.</span> <span class="nav-text">3.1 服务接口</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%85%B7%E4%BD%93%E6%9C%8D%E5%8A%A1-1"><span class="nav-number">3.4.9.3.2.</span> <span class="nav-text">3.2 具体服务</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E6%9C%8D%E5%8A%A1%E5%AE%9A%E4%BD%8D%E5%99%A8"><span class="nav-number">3.4.9.3.3.</span> <span class="nav-text">3.3 服务定位器</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-29"><span class="nav-number">3.4.9.3.4.</span> <span class="nav-text">3.4 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-29"><span class="nav-number">3.4.9.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-29"><span class="nav-number">3.4.9.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-29"><span class="nav-number">3.4.9.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E7%9A%84%E5%AF%B9%E6%AF%94"><span class="nav-number">3.4.9.7.</span> <span class="nav-text">7. 与依赖注入的对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-29"><span class="nav-number">3.4.9.8.</span> <span class="nav-text">8. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-26"><span class="nav-number">3.4.9.9.</span> <span class="nav-text">9. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-30"><span class="nav-number">3.4.9.10.</span> <span class="nav-text">10. 总结</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E6%BA%AF%E6%BA%90event-sourcing"><span class="nav-number">3.4.10.</span> <span class="nav-text">事件溯源（Event
Sourcing）</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E6%BA%AF%E6%BA%90%E7%9A%84%E5%AE%9A%E4%B9%89"><span class="nav-number">3.4.10.1.</span> <span class="nav-text">1. 事件溯源的定义</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E6%BA%AF%E6%BA%90%E7%9A%84%E7%BB%93%E6%9E%84"><span class="nav-number">3.4.10.2.</span> <span class="nav-text">2. 事件溯源的结构</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#mermaid-uml-%E5%9B%BE-24"><span class="nav-number">3.4.10.2.1.</span> <span class="nav-text">Mermaid UML 图</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#java-%E5%AE%9E%E7%8E%B0%E7%A4%BA%E4%BE%8B-29"><span class="nav-number">3.4.10.3.</span> <span class="nav-text">3. Java 实现示例</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E7%B1%BB"><span class="nav-number">3.4.10.3.1.</span> <span class="nav-text">3.1 事件类</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E4%BA%8B%E4%BB%B6%E5%AD%98%E5%82%A8"><span class="nav-number">3.4.10.3.2.</span> <span class="nav-text">3.2 事件存储</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E8%81%9A%E5%90%88"><span class="nav-number">3.4.10.3.3.</span> <span class="nav-text">3.3 聚合</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#%E5%AE%A2%E6%88%B7%E7%AB%AF%E4%BB%A3%E7%A0%81-30"><span class="nav-number">3.4.10.3.4.</span> <span class="nav-text">3.4 客户端代码</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86-30"><span class="nav-number">3.4.10.4.</span> <span class="nav-text">4. 工作原理</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BC%98%E7%82%B9-30"><span class="nav-number">3.4.10.5.</span> <span class="nav-text">5. 优点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%BC%BA%E7%82%B9-30"><span class="nav-number">3.4.10.6.</span> <span class="nav-text">6. 缺点</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%B8%8E%E4%BC%A0%E7%BB%9F%E7%8A%B6%E6%80%81%E5%AD%98%E5%82%A8%E5%AF%B9%E6%AF%94"><span class="nav-number">3.4.10.7.</span> <span class="nav-text">7. 与传统状态存储对比</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%AE%9E%E9%99%85%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF-30"><span class="nav-number">3.4.10.8.</span> <span class="nav-text">8. 实际应用场景</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%BA%90%E7%A0%81%E4%B8%AD%E7%9A%84%E4%BE%8B%E5%AD%90-27"><span class="nav-number">3.4.10.9.</span> <span class="nav-text">9. 源码中的例子</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%80%BB%E7%BB%93-31"><span class="nav-number">3.4.10.10.</span> <span class="nav-text">10. 总结</span></a></li></ol></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Bruce Yao"
      src="/uploads/avatar.jpg">
  <p class="site-author-name" itemprop="name">Bruce Yao</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">66</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">23</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="https://github.com/cmder" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;cmder" rel="noopener me" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="mailto:cmd100000@gmail.com" title="E-Mail → mailto:cmd100000@gmail.com" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://cmder.github.io/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/uploads/avatar.jpg">
      <meta itemprop="name" content="Bruce Yao">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="说码解字">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="设计模式 | 说码解字">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          设计模式
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>

      <time title="创建时间：2024-12-12 11:20:14" itemprop="dateCreated datePublished" datetime="2024-12-12T11:20:14+08:00">2024-12-12</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">更新于</span>
      <time title="修改时间：2025-10-14 22:00:23" itemprop="dateModified" datetime="2025-10-14T22:00:23+08:00">2025-10-14</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1/" itemprop="url" rel="index"><span itemprop="name">软件设计</span></a>
        </span>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><h1 id="分类">分类</h1>
<table>
<colgroup>
<col style="width: 30%" />
<col style="width: 26%" />
<col style="width: 43%" />
</colgroup>
<thead>
<tr class="header">
<th style="text-align: left;"><strong>分类</strong></th>
<th style="text-align: left;"><strong>设计模式</strong></th>
<th style="text-align: left;"><strong>简单说明</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><strong>创建型模式<br>Creational
Patterns</strong></td>
<td style="text-align: left;">单例模式（Singleton）</td>
<td
style="text-align: left;">确保类只有一个实例，并提供全局访问点。</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">工厂方法（Factory Method）</td>
<td
style="text-align: left;">定义创建对象的接口，由子类决定实例化。</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">抽象工厂（Abstract Factory）</td>
<td style="text-align: left;">创建一系列相关对象的工厂。</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">建造者（Builder）</td>
<td style="text-align: left;">分步构造复杂对象。</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">原型模式（Prototype）</td>
<td style="text-align: left;">通过克隆创建新对象。</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>结构型模式<br>Structural
Patterns</strong></td>
<td style="text-align: left;">适配器（Adapter）</td>
<td style="text-align: left;">将不兼容的接口转换为兼容接口。</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">桥接（Bridge）</td>
<td style="text-align: left;">将抽象与实现分离。</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">组合（Composite）</td>
<td style="text-align: left;">将对象组织成树形结构。</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">装饰者（Decorator）</td>
<td style="text-align: left;">动态扩展对象功能。</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">外观（Facade）</td>
<td style="text-align: left;">为复杂子系统提供简单接口。</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">享元（Flyweight）</td>
<td style="text-align: left;">共享细粒度对象以节省资源。</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">代理（Proxy）</td>
<td style="text-align: left;">控制对对象的访问。</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><strong>行为型模式<br>Behavioral
Patterns</strong></td>
<td style="text-align: left;">责任链（Chain of Responsibility）</td>
<td style="text-align: left;">将请求沿处理链传递。</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">命令（Command）</td>
<td style="text-align: left;">将请求封装为对象。</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">解释器（Interpreter）</td>
<td style="text-align: left;">定义语言的解释规则。</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">迭代器（Iterator）</td>
<td style="text-align: left;">顺序访问集合元素。</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">中介者（Mediator）</td>
<td style="text-align: left;">通过中介协调对象交互。</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">备忘录（Memento）</td>
<td style="text-align: left;">保存和恢复对象状态。</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">观察者（Observer）</td>
<td style="text-align: left;">对象状态变化时通知依赖者。</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">状态（State）</td>
<td style="text-align: left;">根据状态改变对象行为。</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">策略（Strategy）</td>
<td style="text-align: left;">定义可互换的算法家族。</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">模板方法（Template Method）</td>
<td style="text-align: left;">定义算法骨架，子类实现细节。</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">访问者（Visitor）</td>
<td style="text-align: left;">在不修改类的情况下增加新操作。</td>
</tr>
<tr class="even">
<td style="text-align: left;"><strong>扩展模式<br>Extended
Patterns</strong></td>
<td style="text-align: left;">依赖注入（Dependency Injection）</td>
<td style="text-align: left;">通过外部注入依赖，解耦组件。</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">发布-订阅（Publish-Subscribe）</td>
<td style="text-align: left;">事件驱动的观察者变种。</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">模块模式（Module Pattern）</td>
<td style="text-align: left;">封装代码，管理私有/公有成员。</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">MVC（Model-View-Controller）</td>
<td
style="text-align: left;">分离数据（Model）、界面（View）和逻辑（Controller）。</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">MVP（Model-View-Presenter）</td>
<td style="text-align: left;">View 和 Presenter 交互，Model
隔离数据。</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">MVVM（Model-View-ViewModel）</td>
<td style="text-align: left;">通过 ViewModel 绑定 Model 和 View。</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">仓储模式（Repository Pattern）</td>
<td style="text-align: left;">封装数据访问逻辑。</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">服务定位器（Service Locator）</td>
<td style="text-align: left;">集中管理服务实例的获取。</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">事件溯源（Event Sourcing）</td>
<td style="text-align: left;">通过事件记录对象状态。</td>
</tr>
</tbody>
</table>
<h1 id="图示">图示</h1>
<pre><code class="highlight mermaid">graph LR
    A[设计模式&lt;br&gt;Design Patterns]
    
    A --&gt; B[创建型模式&lt;br&gt;Creational Patterns]
    B --&gt; B1[单例模式&lt;br&gt;Singleton]
    B --&gt; B2[工厂方法&lt;br&gt;Factory Method]
    B --&gt; B3[抽象工厂&lt;br&gt;Abstract Factory]
    B --&gt; B4[建造者&lt;br&gt;Builder]
    B --&gt; B5[原型模式&lt;br&gt;Prototype]
    
    A --&gt; C[结构型模式&lt;br&gt;Structural Patterns]
    C --&gt; C1[适配器&lt;br&gt;Adapter]
    C --&gt; C2[桥接&lt;br&gt;Bridge]
    C --&gt; C3[组合&lt;br&gt;Composite]
    C --&gt; C4[装饰者&lt;br&gt;Decorator]
    C --&gt; C5[外观&lt;br&gt;Facade]
    C --&gt; C6[享元&lt;br&gt;Flyweight]
    C --&gt; C7[代理&lt;br&gt;Proxy]
    
    A --&gt; D[行为型模式&lt;br&gt;Behavioral Patterns]
    D --&gt; D1[责任链&lt;br&gt;Chain of Responsibility]
    D --&gt; D2[命令&lt;br&gt;Command]
    D --&gt; D3[解释器&lt;br&gt;Interpreter]
    D --&gt; D4[迭代器&lt;br&gt;Iterator]
    D --&gt; D5[中介者&lt;br&gt;Mediator]
    D --&gt; D6[备忘录&lt;br&gt;Memento]
    D --&gt; D7[观察者&lt;br&gt;Observer]
    D --&gt; D8[状态&lt;br&gt;State]
    D --&gt; D9[策略&lt;br&gt;Strategy]
    D --&gt; D10[模板方法&lt;br&gt;Template Method]
    D --&gt; D11[访问者&lt;br&gt;Visitor]
    
    A --&gt; E[扩展模式&lt;br&gt;Extended Patterns]
    E --&gt; E1[依赖注入&lt;br&gt;Dependency Injection]
    E --&gt; E2[发布-订阅&lt;br&gt;Publish-Subscribe]
    E --&gt; E3[模块模式&lt;br&gt;Module Pattern]
    E --&gt; E4[MVC&lt;br&gt;Model-View-Controller]
    E --&gt; E5[MVP&lt;br&gt;Model-View-Presenter]
    E --&gt; E6[MVVM&lt;br&gt;Model-View-ViewModel]
    E --&gt; E7[仓储模式&lt;br&gt;Repository Pattern]
    E --&gt; E8[服务定位器&lt;br&gt;Service Locator]
    E --&gt; E9[事件溯源&lt;br&gt;Event Sourcing]</code></pre>
<h1 id="详解">详解</h1>
<h2 id="创建型模式creational-patterns">创建型模式（Creational
Patterns）</h2>
<h3 id="单例模式singleton"><strong>单例模式（Singleton）</strong></h3>
<p>单例模式（Singleton
Pattern）是一种创建型设计模式，确保一个类只有一个实例，并提供全局访问点。以下是单例模式的各种实现方式，包括线程安全的版本，用
Java 编写。每种实现都会标注其特点、优缺点及适用场景。</p>
<hr />
<h4 id="饿汉式eager-initialization">1. 饿汉式（Eager
Initialization）</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingletonEager</span> &#123;</span><br><span class="line">    <span class="comment">// 类加载时就创建实例</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">SingletonEager</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingletonEager</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 私有构造方法，防止外部实例化</span></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SingletonEager</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 防止反射创建实例</span></span><br><span class="line">        <span class="keyword">if</span> (INSTANCE != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Singleton instance already exists&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 全局访问点</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SingletonEager <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>特点</strong>：类加载时即创建实例，线程安全。</li>
<li><strong>优点</strong>：简单，无需同步，天然线程安全。</li>
<li><strong>缺点</strong>：无论是否使用，都会创建实例，可能浪费资源。</li>
<li><strong>适用场景</strong>：实例开销小，且肯定会被使用。</li>
</ul>
<hr />
<h4 id="懒汉式lazy-initialization非线程安全">2. 懒汉式（Lazy
Initialization，非线程安全）</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingletonLazy</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingletonLazy instance;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SingletonLazy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// 防止反射创建实例，这并不能真正防止反射，用饿汉式、枚举或者使用标志位</span></span><br><span class="line">        <span class="keyword">if</span> (instance != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Singleton instance already exists&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SingletonLazy <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">SingletonLazy</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>特点</strong>：延迟加载，第一次调用时创建实例。</li>
<li><strong>优点</strong>：节省资源，懒加载。</li>
<li><strong>缺点</strong>：非线程安全，多线程下可能创建多个实例。</li>
<li><strong>适用场景</strong>：单线程环境，或不在意线程安全。</li>
</ul>
<p>添加标志位：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingletonLazyWithFlag</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingletonLazyWithFlag instance;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">initialized</span> <span class="operator">=</span> <span class="literal">false</span>;  <span class="comment">// 标志位</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SingletonLazyWithFlag</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (SingletonLazyWithFlag.class) &#123;</span><br><span class="line">            <span class="keyword">if</span> (initialized) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Singleton instance already exists&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            initialized = <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SingletonLazyWithFlag <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (SingletonLazyWithFlag.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">SingletonLazyWithFlag</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="线程安全的懒汉式synchronized-方法">3.
线程安全的懒汉式（Synchronized 方法）</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingletonSyncMethod</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> SingletonSyncMethod instance;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SingletonSyncMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Singleton instance already exists&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 使用 synchronized 同步方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> SingletonSyncMethod <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            instance = <span class="keyword">new</span> <span class="title class_">SingletonSyncMethod</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>特点</strong>：通过同步方法实现线程安全。</li>
<li><strong>优点</strong>：简单，保证线程安全。</li>
<li><strong>缺点</strong>：每次调用 <code>getInstance</code>
都要加锁，性能开销大。</li>
<li><strong>适用场景</strong>：多线程环境，但调用频率不高。</li>
</ul>
<hr />
<h4 id="双重检查锁double-checked-locking-dcl">4.
双重检查锁（Double-Checked Locking, DCL）</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingletonDCL</span> &#123;</span><br><span class="line">    <span class="comment">// 使用 volatile 防止指令重排</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> SingletonDCL instance;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SingletonDCL</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Singleton instance already exists&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SingletonDCL <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;  <span class="comment">// 第一次检查（无锁）</span></span><br><span class="line">            <span class="keyword">synchronized</span> (SingletonDCL.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;  <span class="comment">// 第二次检查（加锁）</span></span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">SingletonDCL</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>特点</strong>：结合懒加载和线程安全，双重检查减少同步开销。</li>
<li><strong>优点</strong>：高效，只有在实例未创建时加锁。</li>
<li><strong>缺点</strong>：实现复杂，需使用 <code>volatile</code>（Java
5+）防止指令重排。</li>
<li><strong>适用场景</strong>：多线程环境，追求性能优化。</li>
</ul>
<hr />
<h4 id="静态内部类static-inner-class">5. 静态内部类（Static Inner
Class）</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingletonStaticInner</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SingletonStaticInner</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (SingletonHolder.INSTANCE != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;Singleton instance already exists&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 静态内部类持有实例, 静态内部类只有在第一次被使用的时候才会加载，所以是懒加载。</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">SingletonHolder</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">SingletonStaticInner</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SingletonStaticInner</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SingletonStaticInner <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> SingletonHolder.INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>特点</strong>：利用类加载机制实现懒加载和线程安全。</li>
<li><strong>优点</strong>：简单、高效，JVM
保证线程安全，无需显式同步。</li>
<li><strong>缺点</strong>：无法传递构造参数。</li>
<li><strong>适用场景</strong>：多线程环境，推荐的懒加载方式。</li>
</ul>
<hr />
<h4 id="枚举单例enum-singleton">6. 枚举单例（Enum Singleton）</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">enum</span> <span class="title class_">SingletonEnum</span> &#123;</span><br><span class="line">    INSTANCE;  <span class="comment">// 唯一实例</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 可以添加方法</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doSomething</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;SingletonEnum is working&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>用法</strong>： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SingletonEnum</span> <span class="variable">singleton</span> <span class="operator">=</span> SingletonEnum.INSTANCE;</span><br><span class="line">singleton.doSomething();</span><br></pre></td></tr></table></figure></li>
<li><strong>特点</strong>：使用枚举实现单例，JVM 保证唯一性。</li>
<li><strong>优点</strong>：最简单，天然线程安全，防止反射和序列化破坏。</li>
<li><strong>缺点</strong>：无法懒加载，枚举类加载时即创建。</li>
<li><strong>适用场景</strong>：需要绝对安全（如防止反射攻击）的场景。</li>
</ul>
<hr />
<h4 id="threadlocal-单例线程局部单例">7. ThreadLocal
单例（线程局部单例）</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingletonThreadLocal</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> ThreadLocal&lt;SingletonThreadLocal&gt; THREAD_LOCAL = </span><br><span class="line">        ThreadLocal.withInitial(SingletonThreadLocal::<span class="keyword">new</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SingletonThreadLocal</span><span class="params">()</span> &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> SingletonThreadLocal <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> THREAD_LOCAL.get();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 清理 ThreadLocal，防止内存泄漏</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">()</span> &#123;</span><br><span class="line">        THREAD_LOCAL.remove();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>特点</strong>：每个线程拥有独立的单例实例。</li>
<li><strong>优点</strong>：线程隔离，适合线程特定的单例需求。</li>
<li><strong>缺点</strong>：不是全局单例，需注意 ThreadLocal
的内存管理。</li>
<li><strong>适用场景</strong>：线程私有单例，如线程上下文管理。</li>
</ul>
<hr />
<h4 id="测试代码">测试代码</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 测试饿汉式</span></span><br><span class="line">        <span class="type">SingletonEager</span> <span class="variable">s1</span> <span class="operator">=</span> SingletonEager.getInstance();</span><br><span class="line">        <span class="type">SingletonEager</span> <span class="variable">s2</span> <span class="operator">=</span> SingletonEager.getInstance();</span><br><span class="line">        System.out.println(<span class="string">&quot;Eager: &quot;</span> + (s1 == s2));  <span class="comment">// true</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 测试双重检查锁（多线程）</span></span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">task</span> <span class="operator">=</span> () -&gt; System.out.println(<span class="string">&quot;DCL: &quot;</span> + SingletonDCL.getInstance());</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(task);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">t2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(task);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 测试枚举</span></span><br><span class="line">        <span class="type">SingletonEnum</span> <span class="variable">e1</span> <span class="operator">=</span> SingletonEnum.INSTANCE;</span><br><span class="line">        <span class="type">SingletonEnum</span> <span class="variable">e2</span> <span class="operator">=</span> SingletonEnum.INSTANCE;</span><br><span class="line">        System.out.println(<span class="string">&quot;Enum: &quot;</span> + (e1 == e2));  <span class="comment">// true</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 测试 ThreadLocal</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="type">SingletonThreadLocal</span> <span class="variable">stl1</span> <span class="operator">=</span> SingletonThreadLocal.getInstance();</span><br><span class="line">            System.out.println(<span class="string">&quot;ThreadLocal Thread1: &quot;</span> + stl1);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="type">SingletonThreadLocal</span> <span class="variable">stl2</span> <span class="operator">=</span> SingletonThreadLocal.getInstance();</span><br><span class="line">            System.out.println(<span class="string">&quot;ThreadLocal Thread2: &quot;</span> + stl2);</span><br><span class="line">        &#125;);</span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="说明">说明</h4>
<ul>
<li><strong>线程安全</strong>：
<ul>
<li>饿汉式、静态内部类、枚举天然线程安全。</li>
<li>懒汉式需加锁（同步方法或 DCL）实现线程安全。</li>
<li>ThreadLocal 为每个线程提供独立实例。</li>
</ul></li>
<li><strong>反射和序列化防护</strong>：
<ul>
<li>枚举单例天然防止反射和序列化破坏。</li>
<li>其他实现通过检查实例是否存在（构造方法抛异常）防御反射。</li>
<li>序列化需实现 <code>readResolve</code> 方法： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> getInstance();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul></li>
<li><strong>性能</strong>：
<ul>
<li>饿汉式和枚举无延迟，静态内部类和 DCL 高效懒加载。</li>
<li>同步方法性能较低。</li>
</ul></li>
<li><strong>复杂度</strong>：
<ul>
<li>枚举最简单，DCL 最复杂。</li>
</ul></li>
</ul>
<hr />
<h4 id="总结表">总结表</h4>
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 8%" />
<col style="width: 11%" />
<col style="width: 8%" />
<col style="width: 11%" />
<col style="width: 14%" />
<col style="width: 26%" />
</colgroup>
<thead>
<tr class="header">
<th>实现方式</th>
<th>懒加载</th>
<th>线程安全</th>
<th>复杂度</th>
<th>防止反射</th>
<th>防止序列化</th>
<th>适用场景</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>饿汉式</td>
<td>否</td>
<td>是</td>
<td>低</td>
<td>是</td>
<td>需额外实现</td>
<td>简单实例</td>
</tr>
<tr class="even">
<td>懒汉式</td>
<td>是</td>
<td>否</td>
<td>低</td>
<td>是</td>
<td>需额外实现</td>
<td>单线程</td>
</tr>
<tr class="odd">
<td>同步方法</td>
<td>是</td>
<td>是</td>
<td>中</td>
<td>是</td>
<td>需额外实现</td>
<td>调用不频繁</td>
</tr>
<tr class="even">
<td>双重检查锁</td>
<td>是</td>
<td>是</td>
<td>高</td>
<td>是</td>
<td>需额外实现</td>
<td>高性能多线程</td>
</tr>
<tr class="odd">
<td>静态内部类</td>
<td>是</td>
<td>是</td>
<td>中</td>
<td>是</td>
<td>需额外实现</td>
<td>推荐的多线程懒加载</td>
</tr>
<tr class="even">
<td>枚举</td>
<td>否</td>
<td>是</td>
<td>低</td>
<td>是</td>
<td>是</td>
<td>最高安全性</td>
</tr>
<tr class="odd">
<td>ThreadLocal</td>
<td>是</td>
<td>线程内</td>
<td>中</td>
<td>是</td>
<td>需额外实现</td>
<td>线程私有单例</td>
</tr>
</tbody>
</table>
<h4 id="如何防止序列化破坏">如何防止序列化破坏</h4>
<p>为什么会发生序列化破坏：如果一个单例类实现了 Serializable
接口，反序列化时会通过反射创建一个新实例，而不是返回现有的单例实例。这会导致系统中存在多个实例，破坏单例的唯一性。</p>
<p>在单例类中添加 readResolve 方法，反序列化时 JVM
会调用此方法，返回指定的对象，而不是新建的实例。或者使用枚举。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Singleton</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 添加 readResolve 方法</span></span><br><span class="line">    <span class="keyword">private</span> Object <span class="title function_">readResolve</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;  <span class="comment">// 返回单例实例</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Test</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">Singleton</span> <span class="variable">s1</span> <span class="operator">=</span> Singleton.getInstance();</span><br><span class="line">        </span><br><span class="line">        <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(<span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;singleton.ser&quot;</span>));</span><br><span class="line">        oos.writeObject(s1);</span><br><span class="line">        oos.close();</span><br><span class="line">        </span><br><span class="line">        <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(<span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;singleton.ser&quot;</span>));</span><br><span class="line">        <span class="type">Singleton</span> <span class="variable">s2</span> <span class="operator">=</span> (Singleton) ois.readObject();</span><br><span class="line">        ois.close();</span><br><span class="line">        </span><br><span class="line">        System.out.println(<span class="string">&quot;s1 == s2: &quot;</span> + (s1 == s2));  <span class="comment">// 输出: true</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="工厂方法factory-method"><strong>工厂方法（Factory
Method）</strong></h3>
<p>工厂方法模式（Factory Method
Pattern）是一种创建型设计模式，它定义了一个用于创建对象的接口，但将具体的对象实例化推迟到子类中实现。相比简单工厂模式，工厂方法模式通过将对象的创建交给具体的工厂类，提升了灵活性和扩展性，遵循了“开闭原则”（对扩展开放，对修改关闭）。</p>
<p>以下是用 Java
实现工厂方法模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="工厂方法模式的定义">1. 工厂方法模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：定义一个创建对象的接口（工厂方法），由子类决定具体实例化哪种产品。</li>
<li><strong>目的</strong>：
<ul>
<li>解耦客户端与具体产品类。</li>
<li>让子类决定创建哪种对象，增加系统的可扩展性。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>需要生成的产品种类较多，且可能新增类型。</li>
<li>客户端不关心对象的具体创建过程，只关心接口。</li>
</ul></li>
</ul>
<hr />
<h4 id="工厂方法模式的结构">2. 工厂方法模式的结构</h4>
<ul>
<li><strong>抽象产品（Product）</strong>：定义产品的接口，所有具体产品实现此接口。</li>
<li><strong>具体产品（Concrete
Product）</strong>：实现抽象产品接口的具体类。</li>
<li><strong>抽象工厂（Creator）</strong>：声明工厂方法，返回抽象产品类型。</li>
<li><strong>具体工厂（Concrete
Creator）</strong>：实现工厂方法，创建具体产品实例。</li>
</ul>
<h5 id="uml-图">UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Product &#123;
        &lt;&lt;interface&gt;&gt;
        +operation() void
    &#125;
    
    class ConcreteProduct &#123;
        +operation() void
    &#125;
    
    class Creator &#123;
        &lt;&lt;abstract&gt;&gt;
        +factoryMethod() Product
    &#125;
    
    class ConcreteCreator &#123;
        +factoryMethod() Product
    &#125;
    
    ConcreteProduct ..|&gt; Product : implements
    ConcreteCreator --|&gt; Creator : extends
    ConcreteCreator o--&gt; &quot;1&quot; ConcreteProduct : creates</code></pre>
<hr />
<h4 id="java-实现示例">3. Java 实现示例</h4>
<p>以下是一个生产不同类型车辆的工厂方法模式示例：</p>
<h5 id="抽象产品接口">3.1 抽象产品接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象产品：车辆</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">drive</span><span class="params">()</span>;  <span class="comment">// 定义车辆的通用行为</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体产品类">3.2 具体产品类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体产品：汽车</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> <span class="keyword">implements</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drive</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Driving a car&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品：摩托车</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Motorcycle</span> <span class="keyword">implements</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drive</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Riding a motorcycle&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="抽象工厂类">3.3 抽象工厂类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象工厂：车辆工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">VehicleFactory</span> &#123;</span><br><span class="line">    <span class="comment">// 工厂方法，子类实现</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Vehicle <span class="title function_">createVehicle</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 可选：提供默认行为</span></span><br><span class="line">    <span class="keyword">public</span> Vehicle <span class="title function_">getVehicle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">Vehicle</span> <span class="variable">vehicle</span> <span class="operator">=</span> createVehicle();</span><br><span class="line">        vehicle.drive();</span><br><span class="line">        <span class="keyword">return</span> vehicle;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体工厂类">3.4 具体工厂类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体工厂：汽车工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarFactory</span> <span class="keyword">extends</span> <span class="title class_">VehicleFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Vehicle <span class="title function_">createVehicle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Car</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体工厂：摩托车工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MotorcycleFactory</span> <span class="keyword">extends</span> <span class="title class_">VehicleFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Vehicle <span class="title function_">createVehicle</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Motorcycle</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码">3.5 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用汽车工厂</span></span><br><span class="line">        <span class="type">VehicleFactory</span> <span class="variable">carFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CarFactory</span>();</span><br><span class="line">        <span class="type">Vehicle</span> <span class="variable">car</span> <span class="operator">=</span> carFactory.getVehicle();  <span class="comment">// 输出: Driving a car</span></span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 使用摩托车工厂</span></span><br><span class="line">        <span class="type">VehicleFactory</span> <span class="variable">motorcycleFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MotorcycleFactory</span>();</span><br><span class="line">        <span class="type">Vehicle</span> <span class="variable">motorcycle</span> <span class="operator">=</span> motorcycleFactory.getVehicle();  <span class="comment">// 输出: Riding a motorcycle</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>选择具体的工厂类（<code>CarFactory</code> 或
<code>MotorcycleFactory</code>）。</li>
<li>调用工厂的 <code>createVehicle()</code>
方法，创建具体产品（<code>Car</code> 或 <code>Motorcycle</code>）。</li>
<li>返回的 <code>Vehicle</code>
对象由客户端使用，客户端无需知道具体产品类。</li>
</ol>
<hr />
<h4 id="优点">5. 优点</h4>
<ul>
<li><strong>灵活性</strong>：新增产品只需添加新产品类和对应的工厂类，无需修改现有代码。</li>
<li><strong>解耦</strong>：客户端只依赖抽象接口（<code>Vehicle</code> 和
<code>VehicleFactory</code>），不关心具体实现。</li>
<li><strong>单一职责</strong>：每个工厂负责创建一种产品，职责清晰。</li>
</ul>
<hr />
<h4 id="缺点">6. 缺点</h4>
<ul>
<li><strong>类数量增加</strong>：每增加一种产品，就需要新增一个具体产品类和一个具体工厂类，导致类数量增多。</li>
<li><strong>复杂度提升</strong>：相比简单工厂模式，代码结构更复杂。</li>
</ul>
<hr />
<h4 id="与简单工厂的对比">7. 与简单工厂的对比</h4>
<h5 id="简单工厂非工厂方法模式">简单工厂（非工厂方法模式）</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleVehicleFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Vehicle <span class="title function_">createVehicle</span><span class="params">(String type)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;car&quot;</span>.equals(type)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Car</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="string">&quot;motorcycle&quot;</span>.equals(type)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Motorcycle</span>();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Vehicle</span> <span class="variable">car</span> <span class="operator">=</span> SimpleVehicleFactory.createVehicle(<span class="string">&quot;car&quot;</span>);</span><br><span class="line">        car.drive();  <span class="comment">// 输出: Driving a car</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>区别</strong>：
<ul>
<li>简单工厂将创建逻辑集中在一个类中，违反“开闭原则”（新增类型需修改工厂类）。</li>
<li>工厂方法将创建逻辑分散到子类中，符合“开闭原则”。</li>
</ul></li>
</ul>
<hr />
<h4 id="扩展示例带参数的工厂方法">8. 扩展示例：带参数的工厂方法</h4>
<p>如果需要根据参数创建不同配置的产品，可以这样扩展：</p>
<h5 id="修改抽象工厂">修改抽象工厂</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">VehicleFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> Vehicle <span class="title function_">createVehicle</span><span class="params">(String color)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="修改具体工厂">修改具体工厂</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CarFactory</span> <span class="keyword">extends</span> <span class="title class_">VehicleFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Vehicle <span class="title function_">createVehicle</span><span class="params">(String color)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Car</span>(color);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Car</span> <span class="keyword">implements</span> <span class="title class_">Vehicle</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Car</span><span class="params">(String color)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drive</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Driving a &quot;</span> + color + <span class="string">&quot; car&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端">客户端</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">VehicleFactory</span> <span class="variable">carFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CarFactory</span>();</span><br><span class="line">        <span class="type">Vehicle</span> <span class="variable">redCar</span> <span class="operator">=</span> carFactory.createVehicle(<span class="string">&quot;red&quot;</span>);</span><br><span class="line">        redCar.drive();  <span class="comment">// 输出: Driving a red car</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="实际应用场景">9. 实际应用场景</h4>
<ul>
<li><strong>日志框架</strong>：如 SLF4J 的
<code>LoggerFactory</code>，根据配置创建不同类型的日志记录器。</li>
<li><strong>数据库连接</strong>：根据驱动类型创建不同的
<code>Connection</code> 对象。</li>
<li><strong>UI 组件</strong>：根据主题创建不同样式的按钮或窗口。</li>
</ul>
<hr />
<h4 id="源码中的例子">10. 源码中的例子</h4>
<p>Java 中的 <code>java.util.Calendar</code> 使用了类似工厂方法模式：
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Calendar</span> <span class="variable">calendar</span> <span class="operator">=</span> Calendar.getInstance();  <span class="comment">// getInstance 是工厂方法</span></span><br></pre></td></tr></table></figure> - <code>Calendar</code>
是抽象类，<code>getInstance()</code> 根据区域和时区返回具体子类（如
<code>GregorianCalendar</code>）。</p>
<hr />
<h4 id="总结">总结</h4>
<ul>
<li><strong>工厂方法模式</strong>通过抽象工厂接口和具体工厂类实现对象的创建，提供了扩展性和解耦性。</li>
<li><strong>Java
实现</strong>的关键是定义抽象产品和工厂接口，然后由具体子类实现。</li>
<li><strong>核心优势</strong>是支持新增产品而无需修改现有代码。</li>
</ul>
<h3 id="抽象工厂abstract-factory"><strong>抽象工厂（Abstract
Factory）</strong></h3>
<p>抽象工厂模式（Abstract Factory
Pattern）是一种创建型设计模式，它提供了一个接口，用于创建一系列相关或相互依赖的对象，而无需指定具体类。与工厂方法模式不同，抽象工厂模式关注于创建一组相关的产品（产品族），适用于需要统一风格或兼容性对象的场景。</p>
<p>以下是用 Java
实现抽象工厂模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="抽象工厂模式的定义">1. 抽象工厂模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：定义一个抽象工厂接口，创建一组相关产品的对象，具体工厂类实现该接口，生成具体产品。</li>
<li><strong>目的</strong>：
<ul>
<li>将一组相关产品的创建封装起来，确保产品之间的兼容性。</li>
<li>解耦客户端与具体产品类，客户端只依赖抽象接口。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>需要创建多个相关对象（如 UI 组件、数据库访问对象）。</li>
<li>系统需要支持多种产品族（如不同风格的主题或配置）。</li>
</ul></li>
</ul>
<hr />
<h4 id="抽象工厂模式的结构">2. 抽象工厂模式的结构</h4>
<ul>
<li><strong>抽象产品接口（Abstract
Product）</strong>：定义每个产品类型的接口。</li>
<li><strong>具体产品（Concrete
Product）</strong>：实现抽象产品接口的具体类。</li>
<li><strong>抽象工厂（Abstract
Factory）</strong>：声明一组创建产品的方法。</li>
<li><strong>具体工厂（Concrete
Factory）</strong>：实现抽象工厂接口，创建一组具体产品。</li>
</ul>
<h5 id="uml-图-1">UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class AbstractProductA &#123;
        +operationA()
    &#125;
    class ConcreteProductA &#123;
        +operationA()
    &#125;
    class AbstractProductB &#123;
        +operationB()
    &#125;
    class ConcreteProductB &#123;
        +operationB()
    &#125;
    class AbstractFactory &#123;
        +createProductA() AbstractProductA
        +createProductB() AbstractProductB
    &#125;
    class ConcreteFactory &#123;
        +createProductA() AbstractProductA
        +createProductB() AbstractProductB
    &#125;
    
    ConcreteProductA --|&gt; AbstractProductA
    ConcreteProductB --|&gt; AbstractProductB
    ConcreteFactory --|&gt; AbstractFactory
    ConcreteFactory --&gt; ConcreteProductA
    ConcreteFactory --&gt; ConcreteProductB</code></pre>
<hr />
<h4 id="java-实现示例-1">3. Java 实现示例</h4>
<p>以下是一个生产 UI
组件（按钮和文本框）的抽象工厂模式示例，支持不同风格（如 Windows 和
Mac）。</p>
<h5 id="抽象产品接口-1">3.1 抽象产品接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象产品：按钮</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">render</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 抽象产品：文本框</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">TextField</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">input</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体产品类-1">3.2 具体产品类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体产品：Windows 按钮</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WindowsButton</span> <span class="keyword">implements</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">render</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Rendering a Windows button&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品：Windows 文本框</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WindowsTextField</span> <span class="keyword">implements</span> <span class="title class_">TextField</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">input</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Input in a Windows text field&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品：Mac 按钮</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MacButton</span> <span class="keyword">implements</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">render</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Rendering a Mac button&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体产品：Mac 文本框</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MacTextField</span> <span class="keyword">implements</span> <span class="title class_">TextField</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">input</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Input in a Mac text field&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="抽象工厂接口">3.3 抽象工厂接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象工厂：UI 工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UIFactory</span> &#123;</span><br><span class="line">    Button <span class="title function_">createButton</span><span class="params">()</span>;</span><br><span class="line">    TextField <span class="title function_">createTextField</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体工厂类-1">3.4 具体工厂类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体工厂：Windows UI 工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WindowsUIFactory</span> <span class="keyword">implements</span> <span class="title class_">UIFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Button <span class="title function_">createButton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WindowsButton</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> TextField <span class="title function_">createTextField</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WindowsTextField</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体工厂：Mac UI 工厂</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MacUIFactory</span> <span class="keyword">implements</span> <span class="title class_">UIFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Button <span class="title function_">createButton</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MacButton</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> TextField <span class="title function_">createTextField</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MacTextField</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-1">3.5 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用 Windows UI 工厂</span></span><br><span class="line">        <span class="type">UIFactory</span> <span class="variable">windowsFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WindowsUIFactory</span>();</span><br><span class="line">        <span class="type">Button</span> <span class="variable">windowsButton</span> <span class="operator">=</span> windowsFactory.createButton();</span><br><span class="line">        <span class="type">TextField</span> <span class="variable">windowsText</span> <span class="operator">=</span> windowsFactory.createTextField();</span><br><span class="line">        windowsButton.render();  <span class="comment">// 输出: Rendering a Windows button</span></span><br><span class="line">        windowsText.input();     <span class="comment">// 输出: Input in a Windows text field</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用 Mac UI 工厂</span></span><br><span class="line">        <span class="type">UIFactory</span> <span class="variable">macFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MacUIFactory</span>();</span><br><span class="line">        <span class="type">Button</span> <span class="variable">macButton</span> <span class="operator">=</span> macFactory.createButton();</span><br><span class="line">        <span class="type">TextField</span> <span class="variable">macText</span> <span class="operator">=</span> macFactory.createTextField();</span><br><span class="line">        macButton.render();  <span class="comment">// 输出: Rendering a Mac button</span></span><br><span class="line">        macText.input();     <span class="comment">// 输出: Input in a Mac text field</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-1">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>选择一个具体工厂（如
<code>WindowsUIFactory</code> 或 <code>MacUIFactory</code>）。</li>
<li>调用工厂的创建方法（<code>createButton()</code> 和
<code>createTextField()</code>），生成一组相关产品。</li>
<li>客户端使用这些产品，保持风格一致性（如 Windows
风格的按钮和文本框）。</li>
</ol>
<hr />
<h4 id="优点-1">5. 优点</h4>
<ul>
<li><strong>一致性</strong>：保证创建的产品属于同一产品族，兼容性强。</li>
<li><strong>扩展性</strong>：新增产品族只需增加新的具体工厂和产品类，符合“开闭原则”。</li>
<li><strong>解耦</strong>：客户端只依赖抽象工厂和产品接口，不关心具体实现。</li>
</ul>
<hr />
<h4 id="缺点-1">6. 缺点</h4>
<ul>
<li><strong>复杂度高</strong>：需要定义多个抽象产品和具体工厂，类数量较多。</li>
<li><strong>不易扩展产品</strong>：如果产品族中的产品种类增加（如新增
Checkbox），需要修改抽象工厂接口及其所有实现类，违反“开闭原则”。</li>
</ul>
<hr />
<h4 id="与工厂方法的对比">7. 与工厂方法的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>工厂方法模式</th>
<th>抽象工厂模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>创建对象</strong></td>
<td>单个产品</td>
<td>一组相关产品（产品族）</td>
</tr>
<tr class="even">
<td><strong>扩展性</strong></td>
<td>易扩展新产品种类</td>
<td>易扩展新产品族</td>
</tr>
<tr class="odd">
<td><strong>复杂度</strong></td>
<td>较低</td>
<td>较高</td>
</tr>
<tr class="even">
<td><strong>抽象层级</strong></td>
<td>一个工厂方法</td>
<td>多个创建方法</td>
</tr>
</tbody>
</table>
<ul>
<li><strong>工厂方法</strong>：关注单一产品的创建（如只创建按钮）。</li>
<li><strong>抽象工厂</strong>：关注一组相关产品的创建（如按钮和文本框的组合）。</li>
</ul>
<hr />
<h4 id="扩展示例带参数">8. 扩展示例：带参数</h4>
<p>如果需要根据参数创建产品，可以这样扩展：</p>
<h5 id="修改抽象工厂-1">修改抽象工厂</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UIFactory</span> &#123;</span><br><span class="line">    Button <span class="title function_">createButton</span><span class="params">(String style)</span>;</span><br><span class="line">    TextField <span class="title function_">createTextField</span><span class="params">(String style)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="修改具体工厂-1">修改具体工厂</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WindowsUIFactory</span> <span class="keyword">implements</span> <span class="title class_">UIFactory</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Button <span class="title function_">createButton</span><span class="params">(String style)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WindowsButton</span>(style);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> TextField <span class="title function_">createTextField</span><span class="params">(String style)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">WindowsTextField</span>(style);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WindowsButton</span> <span class="keyword">implements</span> <span class="title class_">Button</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String style;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WindowsButton</span><span class="params">(String style)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.style = style;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">render</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Rendering a Windows button with style: &quot;</span> + style);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端-1">客户端</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UIFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WindowsUIFactory</span>();</span><br><span class="line">        <span class="type">Button</span> <span class="variable">button</span> <span class="operator">=</span> factory.createButton(<span class="string">&quot;modern&quot;</span>);</span><br><span class="line">        button.render();  <span class="comment">// 输出: Rendering a Windows button with style: modern</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="实际应用场景-1">9. 实际应用场景</h4>
<ul>
<li><strong>GUI 框架</strong>：如 Swing 或
JavaFX，创建不同平台的组件（如 Windows 和 Mac 风格的按钮、窗口）。</li>
<li><strong>数据库访问</strong>：创建一组数据库操作对象（如连接、语句、结果集），支持
MySQL、Oracle 等。</li>
<li><strong>游戏开发</strong>：创建不同主题的资源（如森林主题的树木和动物）。</li>
</ul>
<hr />
<h4 id="源码中的例子-1">10. 源码中的例子</h4>
<p>Java 中的 <code>java.sql.DriverManager</code> 和 JDBC
驱动有一些抽象工厂的影子： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url);  <span class="comment">// 工厂方法创建连接</span></span><br></pre></td></tr></table></figure> - 根据驱动类型，创建对应的
<code>Connection</code>、<code>Statement</code> 等对象。</p>
<hr />
<h4 id="总结-1">总结</h4>
<ul>
<li><strong>抽象工厂模式</strong>通过抽象工厂接口创建一组相关产品，适用于产品族场景。</li>
<li><strong>Java
实现</strong>的关键是定义抽象产品和工厂接口，由具体工厂实现产品创建。</li>
<li><strong>核心优势</strong>是保证产品一致性和支持产品族的扩展。</li>
</ul>
<p>如果你需要更复杂的例子（如多产品族）或 UML 图，请告诉我！</p>
<h3 id="建造者builder"><strong>建造者（Builder）</strong></h3>
<p>建造者模式（Builder
Pattern）是一种创建型设计模式，用于分步构建复杂对象。它将对象的构造过程与其表示分离，使得同样的构建过程可以创建不同的表示。建造者模式特别适合需要多个步骤配置的对象，例如对象有多个可选属性或复杂的初始化逻辑。</p>
<p>以下是用 Java 实现建造者模式的详细讲解，并附上用 Mermaid 绘制的 UML
类图。</p>
<hr />
<h4 id="建造者模式的定义">1. 建造者模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：通过一个建造者（Builder）逐步构造复杂对象，最终由指挥者（Director）或直接调用建造者生成产品。</li>
<li><strong>目的</strong>：
<ul>
<li>分离对象的构造和表示，便于灵活配置。</li>
<li>避免构造函数参数过多（“望远镜构造函数”问题）。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>对象有多个可选属性或复杂初始化步骤。</li>
<li>需要创建不可变对象。</li>
<li>构造过程需要复用。</li>
</ul></li>
</ul>
<hr />
<h4 id="建造者模式的结构">2. 建造者模式的结构</h4>
<ul>
<li><strong>产品（Product）</strong>：最终要构建的复杂对象。</li>
<li><strong>抽象建造者（Builder）</strong>：定义构建产品各部分的抽象方法。</li>
<li><strong>具体建造者（Concrete
Builder）</strong>：实现抽象建造者，逐步构造产品并提供获取结果的方法。</li>
<li><strong>指挥者（Director）</strong>：可选，负责控制建造过程，调用建造者的方法。</li>
</ul>
<h5 id="uml-图-2">UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Product &#123;
        -field1
        -field2
    &#125;
    class Builder &#123;
        +buildPart1()
        +buildPart2()
        +getResult() Product
    &#125;
    class ConcreteBuilder &#123;
        -product: Product
        +buildPart1()
        +buildPart2()
        +getResult() Product
    &#125;
    class Director &#123;
        -builder: Builder
        +construct()
    &#125;
    
    ConcreteBuilder --&gt; Product : builds
    ConcreteBuilder ..|&gt; Builder : implements
    Director --&gt; Builder : uses</code></pre>
<hr />
<h4 id="java-实现示例-2">3. Java 实现示例</h4>
<p>以下是一个构建房屋（House）的建造者模式示例。</p>
<h5 id="产品类">3.1 产品类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 产品：房屋</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">House</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String foundation;  <span class="comment">// 地基</span></span><br><span class="line">    <span class="keyword">private</span> String structure;   <span class="comment">// 结构</span></span><br><span class="line">    <span class="keyword">private</span> String roof;        <span class="comment">// 屋顶</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setFoundation</span><span class="params">(String foundation)</span> &#123; <span class="built_in">this</span>.foundation = foundation; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setStructure</span><span class="params">(String structure)</span> &#123; <span class="built_in">this</span>.structure = structure; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRoof</span><span class="params">(String roof)</span> &#123; <span class="built_in">this</span>.roof = roof; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;House [foundation=&quot;</span> + foundation + <span class="string">&quot;, structure=&quot;</span> + structure + <span class="string">&quot;, roof=&quot;</span> + roof + <span class="string">&quot;]&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="抽象建造者接口">3.2 抽象建造者接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象建造者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">HouseBuilder</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">buildFoundation</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">buildStructure</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">buildRoof</span><span class="params">()</span>;</span><br><span class="line">    House <span class="title function_">getResult</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体建造者类">3.3 具体建造者类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体建造者：木屋建造者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WoodenHouseBuilder</span> <span class="keyword">implements</span> <span class="title class_">HouseBuilder</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> House house;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WoodenHouseBuilder</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.house = <span class="keyword">new</span> <span class="title class_">House</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buildFoundation</span><span class="params">()</span> &#123;</span><br><span class="line">        house.setFoundation(<span class="string">&quot;Wooden foundation&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buildStructure</span><span class="params">()</span> &#123;</span><br><span class="line">        house.setStructure(<span class="string">&quot;Wooden walls&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">buildRoof</span><span class="params">()</span> &#123;</span><br><span class="line">        house.setRoof(<span class="string">&quot;Wooden roof&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> House <span class="title function_">getResult</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> house;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="指挥者类可选">3.4 指挥者类（可选）</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 指挥者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HouseDirector</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> HouseBuilder builder;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HouseDirector</span><span class="params">(HouseBuilder builder)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.builder = builder;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> House <span class="title function_">construct</span><span class="params">()</span> &#123;</span><br><span class="line">        builder.buildFoundation();</span><br><span class="line">        builder.buildStructure();</span><br><span class="line">        builder.buildRoof();</span><br><span class="line">        <span class="keyword">return</span> builder.getResult();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-2">3.5 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用指挥者</span></span><br><span class="line">        <span class="type">HouseBuilder</span> <span class="variable">woodenBuilder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WoodenHouseBuilder</span>();</span><br><span class="line">        <span class="type">HouseDirector</span> <span class="variable">director</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HouseDirector</span>(woodenBuilder);</span><br><span class="line">        <span class="type">House</span> <span class="variable">house</span> <span class="operator">=</span> director.construct();</span><br><span class="line">        System.out.println(house);  <span class="comment">// 输出: House [foundation=Wooden foundation, structure=Wooden walls, roof=Wooden roof]</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 直接使用建造者</span></span><br><span class="line">        <span class="type">HouseBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">WoodenHouseBuilder</span>();</span><br><span class="line">        builder.buildFoundation();</span><br><span class="line">        builder.buildStructure();</span><br><span class="line">        builder.buildRoof();</span><br><span class="line">        <span class="type">House</span> <span class="variable">house2</span> <span class="operator">=</span> builder.getResult();</span><br><span class="line">        System.out.println(house2);  <span class="comment">// 同上</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-2">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>选择一个具体建造者（如
<code>WoodenHouseBuilder</code>）。</li>
<li>通过指挥者（可选）或直接调用建造者的方法，逐步构建产品（设置地基、结构、屋顶）。</li>
<li>调用 <code>getResult()</code> 获取最终产品。</li>
</ol>
<hr />
<h4 id="优点-2">5. 优点</h4>
<ul>
<li><strong>分步构造</strong>：将复杂对象的创建分解为多个步骤，清晰可控。</li>
<li><strong>灵活性</strong>：支持不同的构造过程和产品表示。</li>
<li><strong>封装性</strong>：隐藏产品的内部构造细节。</li>
</ul>
<hr />
<h4 id="缺点-2">6. 缺点</h4>
<ul>
<li><strong>类数量增加</strong>：需要为每种产品定义建造者，增加代码量。</li>
<li><strong>适用范围有限</strong>：适合复杂对象，不适合简单对象。</li>
</ul>
<hr />
<h4 id="与工厂模式的对比">7. 与工厂模式的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>工厂模式</th>
<th>建造者模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>关注点</strong></td>
<td>创建单一对象</td>
<td>分步构建复杂对象</td>
</tr>
<tr class="even">
<td><strong>过程</strong></td>
<td>一步完成</td>
<td>多步配置</td>
</tr>
<tr class="odd">
<td><strong>结果</strong></td>
<td>直接返回产品</td>
<td>构建完成后返回产品</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-2">9. 实际应用场景</h4>
<ul>
<li><strong>字符串构建</strong>：<code>StringBuilder</code>
是建造者模式的典型例子。</li>
<li><strong>对象配置</strong>：如 <code>OkHttpClient.Builder</code> 或
<code>AlertDialog.Builder</code>。</li>
<li><strong>文档生成</strong>：如生成复杂的 PDF 或 HTML 文档。</li>
</ul>
<hr />
<h4 id="源码中的例子-2">10. 源码中的例子</h4>
<p>Java 中的 <code>StringBuilder</code>： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">StringBuilder</span> <span class="variable">builder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">builder.append(<span class="string">&quot;Hello&quot;</span>).append(<span class="string">&quot; &quot;</span>).append(<span class="string">&quot;World&quot;</span>);</span><br><span class="line"><span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> builder.toString();  <span class="comment">// 输出: Hello World</span></span><br></pre></td></tr></table></figure></p>
<hr />
<h4 id="总结-2">总结</h4>
<ul>
<li><strong>建造者模式</strong>通过分步构建复杂对象，提供灵活性和封装性。</li>
<li><strong>Java
实现</strong>的关键是定义建造者接口和产品类，指挥者可选。</li>
<li><strong>Mermaid UML</strong>展示了核心结构，清晰表达模式关系。</li>
</ul>
<p>如果需要更复杂的例子（如多个建造者）或调整 UML 图，请告诉我！</p>
<h3 id="原型模式prototype"><strong>原型模式（Prototype）</strong></h3>
<p>原型模式（Prototype
Pattern）是一种创建型设计模式，通过复制现有对象（原型）来创建新对象，而不是通过构造函数从头构建。它适用于创建对象成本较高（如需要大量计算或资源）或需要基于现有对象快速生成类似对象的场景。</p>
<p>以下是用 Java 实现原型模式的详细讲解，并附上用 Mermaid 绘制的 UML
类图。</p>
<hr />
<h4 id="原型模式的定义">1. 原型模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：通过克隆已有对象（原型）创建新对象，而不是通过
<code>new</code> 实例化。</li>
<li><strong>目的</strong>：
<ul>
<li>提高创建效率，避免重复的初始化工作。</li>
<li>支持动态生成对象副本。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>对象创建复杂或耗时。</li>
<li>需要创建大量相似对象。</li>
<li>需要对象深拷贝或浅拷贝。</li>
</ul></li>
</ul>
<hr />
<h4 id="原型模式的结构">2. 原型模式的结构</h4>
<ul>
<li><strong>抽象原型（Prototype）</strong>：定义克隆方法的接口。</li>
<li><strong>具体原型（Concrete
Prototype）</strong>：实现克隆方法，复制自身。</li>
<li><strong>客户端（Client）</strong>：使用原型创建新对象。</li>
</ul>
<h5 id="uml-图-3">UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Prototype &#123;
        +clone() Prototype
    &#125;
    class ConcretePrototype &#123;
        -field1
        -field2
        +clone() Prototype
    &#125;
    class Client &#123;
        -prototype: Prototype
    &#125;
    
    ConcretePrototype ..|&gt; Prototype : implements
	Client --&gt; Prototype : uses
	ConcretePrototype --&gt; ConcretePrototype : clones</code></pre>
<hr />
<h4 id="java-实现示例-3">3. Java 实现示例</h4>
<p>以下是一个形状（Shape）的原型模式示例，支持克隆圆形对象。</p>
<h5 id="抽象原型接口">3.1 抽象原型接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象原型：实现 Cloneable 接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Shape</span> <span class="keyword">extends</span> <span class="title class_">Cloneable</span> &#123;</span><br><span class="line">    Shape <span class="title function_">clone</span><span class="params">()</span>;  <span class="comment">// 克隆方法</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span>;    <span class="comment">// 示例方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体原型类">3.2 具体原型类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体原型：圆形</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> radius;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Circle</span><span class="params">(<span class="type">int</span> radius, String color)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.radius = radius;</span><br><span class="line">        <span class="built_in">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setRadius</span><span class="params">(<span class="type">int</span> radius)</span> &#123; <span class="built_in">this</span>.radius = radius; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setColor</span><span class="params">(String color)</span> &#123; <span class="built_in">this</span>.color = color; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Shape <span class="title function_">clone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> (Shape) <span class="built_in">super</span>.clone();  <span class="comment">// 浅拷贝</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;  <span class="comment">// 异常处理</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Drawing a &quot;</span> + color + <span class="string">&quot; circle with radius &quot;</span> + radius);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-3">3.3 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建原型</span></span><br><span class="line">        <span class="type">Circle</span> <span class="variable">original</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Circle</span>(<span class="number">10</span>, <span class="string">&quot;red&quot;</span>);</span><br><span class="line">        original.draw();  <span class="comment">// 输出: Drawing a red circle with radius 10</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 克隆对象</span></span><br><span class="line">        <span class="type">Circle</span> <span class="variable">cloned</span> <span class="operator">=</span> (Circle) original.clone();</span><br><span class="line">        cloned.setColor(<span class="string">&quot;blue&quot;</span>);</span><br><span class="line">        cloned.draw();  <span class="comment">// 输出: Drawing a blue circle with radius 10</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 原对象保持不变</span></span><br><span class="line">        original.draw();  <span class="comment">// 输出: Drawing a red circle with radius 10</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-3">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>创建初始原型对象（如
<code>Circle</code>）。</li>
<li>调用 <code>clone()</code> 方法生成副本。</li>
<li>修改副本的属性，保持原对象不变。</li>
</ol>
<hr />
<h4 id="深拷贝-vs-浅拷贝">5. 深拷贝 vs 浅拷贝</h4>
<ul>
<li><strong>浅拷贝</strong>（如上例）：
<ul>
<li>使用
<code>Object.clone()</code>，只复制对象本身，引用类型字段仍指向原对象。</li>
<li>如果原型包含复杂对象（如列表），副本修改会影响原对象。</li>
</ul></li>
<li><strong>深拷贝</strong>：
<ul>
<li>手动实现 <code>clone()</code>，递归复制所有引用字段。</li>
</ul></li>
</ul>
<h5 id="深拷贝示例">深拷贝示例</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> radius;</span><br><span class="line">    <span class="keyword">private</span> String color;</span><br><span class="line">    <span class="keyword">private</span> List&lt;String&gt; tags;  <span class="comment">// 复杂字段</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Circle</span><span class="params">(<span class="type">int</span> radius, String color, List&lt;String&gt; tags)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.radius = radius;</span><br><span class="line">        <span class="built_in">this</span>.color = color;</span><br><span class="line">        <span class="built_in">this</span>.tags = tags;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Shape <span class="title function_">clone</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Circle</span> <span class="variable">cloned</span> <span class="operator">=</span> (Circle) <span class="built_in">super</span>.clone();</span><br><span class="line">            cloned.tags = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(<span class="built_in">this</span>.tags);  <span class="comment">// 深拷贝列表</span></span><br><span class="line">            <span class="keyword">return</span> cloned;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (CloneNotSupportedException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Drawing a &quot;</span> + color + <span class="string">&quot; circle with radius &quot;</span> + radius + <span class="string">&quot;, tags: &quot;</span> + tags);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTags</span><span class="params">(List&lt;String&gt; tags)</span> &#123; <span class="built_in">this</span>.tags = tags; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="优点-3">6. 优点</h4>
<ul>
<li><strong>性能提升</strong>：避免重复初始化，适合复杂对象。</li>
<li><strong>灵活性</strong>：动态创建对象副本，可修改副本而不影响原型。</li>
<li><strong>简化创建</strong>：无需复杂构造函数。</li>
</ul>
<hr />
<h4 id="缺点-3">7. 缺点</h4>
<ul>
<li><strong>实现复杂性</strong>：深拷贝需要手动实现，浅拷贝可能导致意外副作用。</li>
<li><strong>依赖 <code>Cloneable</code></strong>：Java
的克隆机制不够灵活，异常处理麻烦。</li>
</ul>
<hr />
<h4 id="与工厂模式的对比-1">8. 与工厂模式的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>工厂模式</th>
<th>原型模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>创建方式</strong></td>
<td>通过类实例化</td>
<td>通过复制现有对象</td>
</tr>
<tr class="even">
<td><strong>初始化</strong></td>
<td>从头构建</td>
<td>基于原型克隆</td>
</tr>
<tr class="odd">
<td><strong>适用性</strong></td>
<td>创建新对象</td>
<td>复制已有对象</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-3">10. 实际应用场景</h4>
<ul>
<li><strong>对象缓存</strong>：缓存复杂对象，通过克隆提供副本。</li>
<li><strong>图形编辑器</strong>：复制图形元素（如矩形、圆形）。</li>
<li><strong>游戏开发</strong>：克隆敌人或道具对象。</li>
</ul>
<hr />
<h4 id="源码中的例子-3">11. 源码中的例子</h4>
<p>Java 中的 <code>Object.clone()</code>： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ArrayList&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(Arrays.asList(<span class="string">&quot;a&quot;</span>, <span class="string">&quot;b&quot;</span>));</span><br><span class="line">ArrayList&lt;String&gt; cloned = (ArrayList&lt;String&gt;) list.clone();</span><br></pre></td></tr></table></figure></p>
<hr />
<h4 id="总结-3">总结</h4>
<ul>
<li><strong>原型模式</strong>通过克隆原型创建对象，提高效率和灵活性。</li>
<li><strong>Java 实现</strong>依赖 <code>Cloneable</code> 和
<code>clone()</code>，可实现浅拷贝或深拷贝。</li>
<li><strong>Mermaid UML</strong>展示了原型模式的核心结构。</li>
</ul>
<h2 id="结构型模式structural-patterns">结构型模式（Structural
Patterns）</h2>
<h3 id="适配器adapter"><strong>适配器（Adapter）</strong></h3>
<p>适配器模式（Adapter
Pattern）是一种结构型设计模式，用于将一个类的接口转换为客户端期望的另一个接口。它解决接口不兼容的问题，使原本不匹配的类能够协同工作。适配器模式有两种形式：<strong>类适配器</strong>（通过继承）和<strong>对象适配器</strong>（通过组合）。</p>
<p>以下是用 Java 实现适配器模式的讲解，并直接用 Mermaid 绘制 UML
类图。</p>
<hr />
<h4 id="适配器模式的定义">1. 适配器模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：通过一个适配器，将不兼容的接口转换为目标接口。</li>
<li><strong>目的</strong>：
<ul>
<li>让现有类适配新接口，无需修改原有代码。</li>
<li>提高代码复用性。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>集成遗留系统或第三方库。</li>
<li>接口不匹配但功能类似的情况。</li>
</ul></li>
</ul>
<hr />
<h4 id="适配器模式的结构">2. 适配器模式的结构</h4>
<ul>
<li><strong>目标接口（Target）</strong>：客户端期望的接口。</li>
<li><strong>适配者（Adaptee）</strong>：需要适配的现有类，接口不兼容。</li>
<li><strong>适配器（Adapter）</strong>：实现目标接口，调用适配者的方法。</li>
</ul>
<h5 id="uml-图-4">UML 图</h5>
<p>对象适配器版本：</p>
<pre><code class="highlight mermaid">classDiagram
    class Target &#123;
        +request()
    &#125;
    class Adaptee &#123;
        +specificRequest()
    &#125;
    class Adapter &#123;
        -adaptee: Adaptee
        +request()
    &#125;
    
    Adapter ..|&gt; Target : implements
    Adapter --&gt; Adaptee : uses</code></pre>
<p>类适配器版本：</p>
<pre><code class="highlight mermaid">classDiagram
    class Target &#123;
        +request()
    &#125;
    class Adaptee &#123;
        +specificRequest()
    &#125;
    class Adapter &#123;
        +request()
    &#125;
    
    Target &lt;|.. Adapter : implements
    Adaptee &lt;|-- Adapter : extends</code></pre>
<p>说明</p>
<ul>
<li><strong><code>Target</code></strong>：目标接口，定义客户端期望的方法。</li>
<li><strong><code>Adaptee</code></strong>：适配者，提供不兼容的功能。</li>
<li><strong><code>Adapter</code></strong>：
<ul>
<li>对象适配器：通过组合（<code>--&gt;</code>）持有
<code>Adaptee</code>。</li>
<li>类适配器：通过继承（<code>&lt;|--</code>）扩展
<code>Adaptee</code>。</li>
</ul></li>
<li><strong>关系</strong>：
<ul>
<li><code>Target &lt;|.. Adapter</code>：适配器实现目标接口。</li>
<li>对象适配器：<code>Adapter --&gt; Adaptee</code>（组合）。</li>
<li>类适配器：<code>Adaptee &lt;|-- Adapter</code>（继承）。</li>
</ul></li>
</ul>
<hr />
<h4 id="java-实现示例-4">3. Java 实现示例</h4>
<p>以下是一个将旧电源接口适配为新接口的例子。</p>
<h5 id="目标接口">3.1 目标接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 目标接口：新电源</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">NewPower</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">providePower</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="适配者类">3.2 适配者类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 适配者：旧电源</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OldPower</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">outputPower</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Outputting power from old system&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="对象适配器">3.3 对象适配器</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对象适配器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PowerAdapter</span> <span class="keyword">implements</span> <span class="title class_">NewPower</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> OldPower oldPower;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PowerAdapter</span><span class="params">(OldPower oldPower)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.oldPower = oldPower;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">providePower</span><span class="params">()</span> &#123;</span><br><span class="line">        oldPower.outputPower();  <span class="comment">// 调用适配者的方法</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="类适配器替代实现">3.4 类适配器（替代实现）</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类适配器（通过继承）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PowerAdapterClass</span> <span class="keyword">extends</span> <span class="title class_">OldPower</span> <span class="keyword">implements</span> <span class="title class_">NewPower</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">providePower</span><span class="params">()</span> &#123;</span><br><span class="line">        outputPower();  <span class="comment">// 继承并调用父类方法</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-4">3.5 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 对象适配器</span></span><br><span class="line">        <span class="type">OldPower</span> <span class="variable">oldPower</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OldPower</span>();</span><br><span class="line">        <span class="type">NewPower</span> <span class="variable">adapter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PowerAdapter</span>(oldPower);</span><br><span class="line">        adapter.providePower();  <span class="comment">// 输出: Outputting power from old system</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 类适配器</span></span><br><span class="line">        <span class="type">NewPower</span> <span class="variable">adapterClass</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PowerAdapterClass</span>();</span><br><span class="line">        adapterClass.providePower();  <span class="comment">// 输出: Outputting power from old system</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-4">4. 工作原理</h4>
<ul>
<li><strong>对象适配器</strong>：通过组合持有适配者对象，转换调用。</li>
<li><strong>类适配器</strong>：通过继承适配者并实现目标接口，转换调用。</li>
</ul>
<hr />
<h4 id="优点-4">5. 优点</h4>
<ul>
<li><strong>复用性</strong>：无需修改现有代码即可复用适配者。</li>
<li><strong>灵活性</strong>：对象适配器通过组合更灵活，类适配器适合简单场景。</li>
<li><strong>解耦</strong>：客户端只依赖目标接口。</li>
</ul>
<hr />
<h4 id="缺点-4">6. 缺点</h4>
<ul>
<li><strong>复杂度</strong>：增加一个适配器类，可能提高系统复杂性。</li>
<li><strong>类适配器局限</strong>：Java
单继承限制了类适配器的使用。</li>
</ul>
<hr />
<h4 id="与其他模式的对比">7. 与其他模式的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>适配器模式</th>
<th>装饰者模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>目的</strong></td>
<td>接口转换</td>
<td>增强功能</td>
</tr>
<tr class="even">
<td><strong>结构</strong></td>
<td>适配已有类</td>
<td>包装同类对象</td>
</tr>
<tr class="odd">
<td><strong>关系</strong></td>
<td>转换调用</td>
<td>递归调用</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-4">8. 实际应用场景</h4>
<ul>
<li><strong>IO 流</strong>：<code>InputStreamReader</code> 适配
<code>InputStream</code> 到 <code>Reader</code>。</li>
<li><strong>事件监听</strong>：<code>MouseAdapter</code> 适配
<code>MouseListener</code> 接口。</li>
<li><strong>第三方库</strong>：适配旧 API 到新系统。</li>
</ul>
<hr />
<h4 id="源码中的例子-4">9. 源码中的例子</h4>
<p>Java 中的 <code>InputStreamReader</code>： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">InputStream</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;file.txt&quot;</span>);</span><br><span class="line"><span class="type">Reader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(input);  <span class="comment">// 适配器</span></span><br></pre></td></tr></table></figure></p>
<hr />
<h4 id="总结-4">总结</h4>
<ul>
<li><strong>适配器模式</strong>通过转换接口实现兼容性，支持对象适配器（组合）和类适配器（继承）。</li>
<li><strong>Java 实现</strong>依赖接口和组合/继承机制。</li>
<li><strong>Mermaid UML</strong>展示了两种形式的结构。</li>
</ul>
<p>如果需要深究某种适配器或调整 UML 图，请告诉我！</p>
<h3 id="桥接bridge"><strong>桥接（Bridge）</strong></h3>
<p>桥接模式（Bridge
Pattern）是一种结构型设计模式，用于将抽象部分与实现部分分离，使它们可以独立变化。它通过组合而非继承，将两个维度的变化解耦，增强系统的灵活性和扩展性。</p>
<p>以下是用 Java 实现桥接模式的详细讲解，并在“模式结构”部分提供 Mermaid
UML 图。</p>
<hr />
<h4 id="桥接模式的定义">1. 桥接模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：将抽象（Abstraction）与实现（Implementation）分离，通过组合关系连接两者。</li>
<li><strong>目的</strong>：
<ul>
<li>解耦抽象和实现，避免多层继承导致的复杂性。</li>
<li>支持独立扩展抽象和实现。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>一个类存在两个独立变化的维度（如形状和颜色）。</li>
<li>需要在运行时动态切换实现。</li>
<li>避免继承带来的紧耦合。</li>
</ul></li>
</ul>
<hr />
<h4 id="桥接模式的结构">2. 桥接模式的结构</h4>
<ul>
<li><strong>抽象部分（Abstraction）</strong>：定义高层接口，包含对实现的引用。</li>
<li><strong>修正抽象（Refined
Abstraction）</strong>：扩展抽象部分，提供具体功能。</li>
<li><strong>实现接口（Implementor）</strong>：定义实现部分的接口。</li>
<li><strong>具体实现（Concrete
Implementor）</strong>：实现接口的具体类。</li>
</ul>
<h5 id="mermaid-uml-图">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Abstraction &#123;
        -implementor: Implementor
        +operation()
    &#125;
    class RefinedAbstraction &#123;
        +operation()
    &#125;
    class Implementor &#123;
        +operationImpl()
    &#125;
    class ConcreteImplementorA &#123;
        +operationImpl()
    &#125;
    class ConcreteImplementorB &#123;
        +operationImpl()
    &#125;
    
	RefinedAbstraction --|&gt; Abstraction : extends
	ConcreteImplementorA ..|&gt; Implementor : implements
	ConcreteImplementorB ..|&gt; Implementor : implements
	Abstraction --&gt; Implementor : uses</code></pre>
<hr />
<h4 id="java-实现示例-5">3. Java 实现示例</h4>
<p>以下是一个绘制形状（矩形）并支持不同绘制方式（颜色）的桥接模式示例。</p>
<h5 id="实现接口">3.1 实现接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 实现接口：绘制方式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">DrawAPI</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">drawRectangle</span><span class="params">(<span class="type">int</span> width, <span class="type">int</span> height)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体实现类">3.2 具体实现类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体实现：红色绘制</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RedDraw</span> <span class="keyword">implements</span> <span class="title class_">DrawAPI</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drawRectangle</span><span class="params">(<span class="type">int</span> width, <span class="type">int</span> height)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Drawing a red rectangle: &quot;</span> + width + <span class="string">&quot;x&quot;</span> + height);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体实现：蓝色绘制</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BlueDraw</span> <span class="keyword">implements</span> <span class="title class_">DrawAPI</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">drawRectangle</span><span class="params">(<span class="type">int</span> width, <span class="type">int</span> height)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Drawing a blue rectangle: &quot;</span> + width + <span class="string">&quot;x&quot;</span> + height);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="抽象部分">3.3 抽象部分</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象部分：形状</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> DrawAPI drawAPI;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="title function_">Shape</span><span class="params">(DrawAPI drawAPI)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.drawAPI = drawAPI;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="修正抽象类">3.4 修正抽象类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 修正抽象：矩形</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Rectangle</span> <span class="keyword">extends</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> width;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> height;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Rectangle</span><span class="params">(<span class="type">int</span> width, <span class="type">int</span> height, DrawAPI drawAPI)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(drawAPI);</span><br><span class="line">        <span class="built_in">this</span>.width = width;</span><br><span class="line">        <span class="built_in">this</span>.height = height;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">()</span> &#123;</span><br><span class="line">        drawAPI.drawRectangle(width, height);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-5">3.5 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 使用红色绘制矩形</span></span><br><span class="line">        <span class="type">Shape</span> <span class="variable">redRectangle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>(<span class="number">10</span>, <span class="number">5</span>, <span class="keyword">new</span> <span class="title class_">RedDraw</span>());</span><br><span class="line">        redRectangle.draw();  <span class="comment">// 输出: Drawing a red rectangle: 10x5</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用蓝色绘制矩形</span></span><br><span class="line">        <span class="type">Shape</span> <span class="variable">blueRectangle</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rectangle</span>(<span class="number">20</span>, <span class="number">10</span>, <span class="keyword">new</span> <span class="title class_">BlueDraw</span>());</span><br><span class="line">        blueRectangle.draw();  <span class="comment">// 输出: Drawing a blue rectangle: 20x10</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-5">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>创建具体实现（<code>RedDraw</code> 或
<code>BlueDraw</code>）。</li>
<li>将实现注入抽象类（<code>Rectangle</code>），通过组合连接。</li>
<li>调用抽象类的操作（<code>draw()</code>），间接调用实现的方法。</li>
</ol>
<hr />
<h4 id="优点-5">5. 优点</h4>
<ul>
<li><strong>解耦</strong>：抽象和实现独立变化，互不影响。</li>
<li><strong>扩展性</strong>：可独立增加新的抽象或实现类。</li>
<li><strong>运行时切换</strong>：通过组合动态改变实现。</li>
</ul>
<hr />
<h4 id="缺点-5">6. 缺点</h4>
<ul>
<li><strong>复杂度增加</strong>：引入额外接口和类，设计更复杂。</li>
<li><strong>适用性有限</strong>：仅适合有两个独立变化维度的场景。</li>
</ul>
<hr />
<h4 id="与适配器模式的对比">7. 与适配器模式的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>桥接模式</th>
<th>适配器模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>目的</strong></td>
<td>分离抽象和实现</td>
<td>接口转换</td>
</tr>
<tr class="even">
<td><strong>时机</strong></td>
<td>设计时规划</td>
<td>集成已有代码</td>
</tr>
<tr class="odd">
<td><strong>关系</strong></td>
<td>组合为主</td>
<td>组合或继承</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-5">8. 实际应用场景</h4>
<ul>
<li><strong>JDBC</strong>：<code>Driver</code> 和
<code>Connection</code> 分离，驱动实现独立变化。</li>
<li><strong>GUI 框架</strong>：组件（如按钮）与绘制方式（如 Windows/Mac
风格）分离。</li>
<li><strong>日志系统</strong>：日志级别与输出方式（如文件、控制台）解耦。</li>
</ul>
<hr />
<h4 id="源码中的例子-5">9. 源码中的例子</h4>
<p>Java 中的 <code>java.sql.DriverManager</code>： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> DriverManager.getConnection(url);  <span class="comment">// 桥接驱动实现</span></span><br></pre></td></tr></table></figure></p>
<hr />
<h4 id="总结-5">10. 总结</h4>
<ul>
<li><strong>桥接模式</strong>通过组合将抽象与实现分离，支持独立扩展。</li>
<li><strong>Java 实现</strong>依赖接口和组合，灵活性高。</li>
<li><strong>UML 图</strong>清晰展示了两部分的解耦关系。</li>
</ul>
<p>如果需要更复杂示例（如多实现）或调整 UML，请告诉我！</p>
<h3 id="组合composite"><strong>组合（Composite）</strong></h3>
<p>组合模式（Composite
Pattern）是一种结构型设计模式，用于将对象组织成树形结构，以表示“部分-整体”的层次关系。它允许客户端统一对待单个对象（叶子）和对象集合（容器），简化操作。</p>
<p>以下是用 Java
实现组合模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="组合模式的定义">1. 组合模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：将对象组合成树形结构，使单个对象和组合对象具有一致的接口。</li>
<li><strong>目的</strong>：
<ul>
<li>统一处理叶子节点和容器节点。</li>
<li>隐藏内部结构差异，简化客户端代码。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>表示树形结构（如文件系统、组织架构）。</li>
<li>需要统一操作单个对象和对象集合。</li>
</ul></li>
</ul>
<hr />
<h4 id="组合模式的结构">2. 组合模式的结构</h4>
<ul>
<li><strong>抽象组件（Component）</strong>：定义叶子和容器的公共接口。</li>
<li><strong>叶子（Leaf）</strong>：实现组件接口，表示树中的单个对象。</li>
<li><strong>容器（Composite）</strong>：实现组件接口，包含子组件集合，可递归操作。</li>
</ul>
<h5 id="mermaid-uml-图-1">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Component &#123;
        +operation()
        +add(Component)
        +remove(Component)
        +getChild(int) Component
    &#125;
    class Leaf &#123;
        +operation()
    &#125;
    class Composite &#123;
        -children: List&lt;Component&gt;
        +operation()
        +add(Component)
        +remove(Component)
        +getChild(int) Component
    &#125;
    
    Leaf ..|&gt; Component : implements
	Composite ..|&gt; Component : implements
    Composite o--&gt; &quot;many&quot; Component : contains</code></pre>
<hr />
<h4 id="java-实现示例-6">3. Java 实现示例</h4>
<p>以下是一个文件系统（文件和文件夹）的组合模式示例。</p>
<h5 id="抽象组件">3.1 抽象组件</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象组件：文件系统项</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FileSystemItem</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span>;  <span class="comment">// 显示信息</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="叶子类">3.2 叶子类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 叶子：文件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">File</span> <span class="keyword">implements</span> <span class="title class_">FileSystemItem</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">File</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;File: &quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="容器类">3.3 容器类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 容器：文件夹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Folder</span> <span class="keyword">implements</span> <span class="title class_">FileSystemItem</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> List&lt;FileSystemItem&gt; children;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Folder</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.children = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(FileSystemItem item)</span> &#123;</span><br><span class="line">        children.add(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(FileSystemItem item)</span> &#123;</span><br><span class="line">        children.remove(item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">display</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Folder: &quot;</span> + name);</span><br><span class="line">        <span class="keyword">for</span> (FileSystemItem item : children) &#123;</span><br><span class="line">            item.display();  <span class="comment">// 递归显示子项</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-6">3.4 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建文件</span></span><br><span class="line">        <span class="type">FileSystemItem</span> <span class="variable">file1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;doc1.txt&quot;</span>);</span><br><span class="line">        <span class="type">FileSystemItem</span> <span class="variable">file2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;doc2.txt&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建文件夹</span></span><br><span class="line">        <span class="type">Folder</span> <span class="variable">folder1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Folder</span>(<span class="string">&quot;Documents&quot;</span>);</span><br><span class="line">        folder1.add(file1);</span><br><span class="line">        folder1.add(file2);</span><br><span class="line"></span><br><span class="line">        <span class="type">Folder</span> <span class="variable">root</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Folder</span>(<span class="string">&quot;Root&quot;</span>);</span><br><span class="line">        root.add(folder1);</span><br><span class="line">        root.add(<span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;readme.txt&quot;</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 显示树形结构</span></span><br><span class="line">        root.display();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        输出:</span></span><br><span class="line"><span class="comment">        Folder: Root</span></span><br><span class="line"><span class="comment">        Folder: Documents</span></span><br><span class="line"><span class="comment">        File: doc1.txt</span></span><br><span class="line"><span class="comment">        File: doc2.txt</span></span><br><span class="line"><span class="comment">        File: readme.txt</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-6">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>创建叶子（<code>File</code>）和容器（<code>Folder</code>）。</li>
<li>将叶子和子容器添加到容器中，形成树形结构。</li>
<li>调用统一接口（<code>display()</code>），递归处理整个结构。</li>
</ol>
<hr />
<h4 id="优点-6">5. 优点</h4>
<ul>
<li><strong>统一性</strong>：客户端无需区分叶子和容器，使用一致接口。</li>
<li><strong>扩展性</strong>：易于添加新组件（叶子或容器）。</li>
<li><strong>简化操作</strong>：递归处理树形结构。</li>
</ul>
<hr />
<h4 id="缺点-6">6. 缺点</h4>
<ul>
<li><strong>限制性</strong>：叶子和容器的接口必须一致，可能导致叶子实现无意义的方法（如
<code>add</code>）。</li>
<li><strong>复杂度</strong>：管理树形结构可能增加系统复杂性。</li>
</ul>
<hr />
<h4 id="与装饰者模式的对比">7. 与装饰者模式的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>组合模式</th>
<th>装饰者模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>目的</strong></td>
<td>表示部分-整体关系</td>
<td>动态增强功能</td>
</tr>
<tr class="even">
<td><strong>结构</strong></td>
<td>树形层次</td>
<td>线性包装</td>
</tr>
<tr class="odd">
<td><strong>操作</strong></td>
<td>统一处理</td>
<td>递归调用</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-6">8. 实际应用场景</h4>
<ul>
<li><strong>文件系统</strong>：文件和文件夹的树形结构。</li>
<li><strong>GUI 组件</strong>：如 Swing 中的 <code>Container</code> 和
<code>Component</code>。</li>
<li><strong>组织架构</strong>：公司部门和员工的层次关系。</li>
</ul>
<hr />
<h4 id="源码中的例子-6">9. 源码中的例子</h4>
<p>Java 中的 <code>java.awt.Component</code> 和 <code>Container</code>：
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Container</span> <span class="variable">panel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JPanel</span>();</span><br><span class="line">panel.add(<span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">&quot;Click&quot;</span>));  <span class="comment">// 组合结构</span></span><br></pre></td></tr></table></figure></p>
<hr />
<h4 id="总结-6">10. 总结</h4>
<ul>
<li><strong>组合模式</strong>通过统一接口处理树形结构，适合部分-整体场景。</li>
<li><strong>Java 实现</strong>依赖接口和递归，容器管理子组件。</li>
<li><strong>UML 图</strong>展示了组件、叶子和容器的关系。</li>
</ul>
<h3 id="装饰者decorator"><strong>装饰者（Decorator）</strong></h3>
<p>装饰者模式是一种结构型设计模式，用于动态地为对象添加功能，而无需修改其原有代码。它通过包装对象实现功能的扩展，遵循“开闭原则”（对扩展开放，对修改关闭）。</p>
<p>以下是用 Java
实现装饰者模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="装饰者模式的定义">1. 装饰者模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：通过组合动态地为对象添加职责，替代继承。</li>
<li><strong>目的</strong>：
<ul>
<li>增强对象功能，同时保持接口一致。</li>
<li>提供灵活的替代继承的扩展方式。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>需要动态添加功能（如日志、权限）。</li>
<li>无法通过子类扩展现有类。</li>
<li>需要多种功能组合。</li>
</ul></li>
</ul>
<hr />
<h4 id="装饰者模式的结构">2. 装饰者模式的结构</h4>
<ul>
<li><strong>抽象组件（Component）</strong>：定义被装饰对象的接口。</li>
<li><strong>具体组件（Concrete
Component）</strong>：实现组件接口，是被装饰的核心对象。</li>
<li><strong>抽象装饰者（Decorator）</strong>：实现组件接口，持有组件引用，定义装饰框架。</li>
<li><strong>具体装饰者（Concrete
Decorator）</strong>：扩展装饰者，添加具体功能。</li>
</ul>
<h5 id="mermaid-uml-图-2">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Component &#123;
        +operation()
    &#125;
    class ConcreteComponent &#123;
        +operation()
    &#125;
    class Decorator &#123;
        -component: Component
        +operation()
    &#125;
    class ConcreteDecorator &#123;
        +operation()
        +addedBehavior()
    &#125;
    
    ConcreteComponent ..|&gt; Component : implements
	Decorator ..|&gt; Component : implements
	ConcreteDecorator --|&gt; Decorator : extends
    Decorator o--&gt; Component : contains</code></pre>
<hr />
<h4 id="java-实现示例-7">3. Java 实现示例</h4>
<p>以下是一个咖啡定价的装饰者模式示例，支持添加配料（如牛奶、糖）。</p>
<h5 id="抽象组件-1">3.1 抽象组件</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象组件：咖啡</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Coffee</span> &#123;</span><br><span class="line">    <span class="type">double</span> <span class="title function_">cost</span><span class="params">()</span>;  <span class="comment">// 计算价格</span></span><br><span class="line">    String <span class="title function_">description</span><span class="params">()</span>;  <span class="comment">// 获取描述</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体组件">3.2 具体组件</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体组件：简单咖啡</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SimpleCoffee</span> <span class="keyword">implements</span> <span class="title class_">Coffee</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">cost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="number">5.0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">description</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;Simple Coffee&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="抽象装饰者">3.3 抽象装饰者</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象装饰者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">CoffeeDecorator</span> <span class="keyword">implements</span> <span class="title class_">Coffee</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> Coffee coffee;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CoffeeDecorator</span><span class="params">(Coffee coffee)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.coffee = coffee;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">cost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> coffee.cost();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">description</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> coffee.description();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体装饰者">3.4 具体装饰者</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体装饰者：加牛奶</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MilkDecorator</span> <span class="keyword">extends</span> <span class="title class_">CoffeeDecorator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MilkDecorator</span><span class="params">(Coffee coffee)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(coffee);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">cost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.cost() + <span class="number">2.0</span>;  <span class="comment">// 牛奶加价</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">description</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.description() + <span class="string">&quot;, Milk&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体装饰者：加糖</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SugarDecorator</span> <span class="keyword">extends</span> <span class="title class_">CoffeeDecorator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SugarDecorator</span><span class="params">(Coffee coffee)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(coffee);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">cost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.cost() + <span class="number">1.0</span>;  <span class="comment">// 糖加价</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">description</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.description() + <span class="string">&quot;, Sugar&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-7">3.5 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 基础咖啡</span></span><br><span class="line">        <span class="type">Coffee</span> <span class="variable">coffee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleCoffee</span>();</span><br><span class="line">        System.out.println(coffee.description() + <span class="string">&quot; $&quot;</span> + coffee.cost());</span><br><span class="line">        <span class="comment">// 输出: Simple Coffee $5.0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 加牛奶</span></span><br><span class="line">        coffee = <span class="keyword">new</span> <span class="title class_">MilkDecorator</span>(coffee);</span><br><span class="line">        System.out.println(coffee.description() + <span class="string">&quot; $&quot;</span> + coffee.cost());</span><br><span class="line">        <span class="comment">// 输出: Simple Coffee, Milk $7.0</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 加糖</span></span><br><span class="line">        coffee = <span class="keyword">new</span> <span class="title class_">SugarDecorator</span>(coffee);</span><br><span class="line">        System.out.println(coffee.description() + <span class="string">&quot; $&quot;</span> + coffee.cost());</span><br><span class="line">        <span class="comment">// 输出: Simple Coffee, Milk, Sugar $8.0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-7">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>创建具体组件（如
<code>SimpleCoffee</code>）。</li>
<li>使用装饰者（如
<code>MilkDecorator</code>、<code>SugarDecorator</code>）包装组件，动态添加功能。</li>
<li>调用统一接口（<code>cost()</code>、<code>description()</code>），递归执行装饰逻辑。</li>
</ol>
<hr />
<h4 id="优点-7">5. 优点</h4>
<ul>
<li><strong>灵活性</strong>：动态添加或移除功能，无需修改原有类。</li>
<li><strong>复用性</strong>：装饰者可组合使用，生成多种组合。</li>
<li><strong>符合开闭原则</strong>：扩展功能不改动源代码。</li>
</ul>
<hr />
<h4 id="缺点-7">6. 缺点</h4>
<ul>
<li><strong>复杂度增加</strong>：多层装饰导致对象层次复杂，调试困难。</li>
<li><strong>类数量增多</strong>：每个新功能需定义新装饰者。</li>
</ul>
<hr />
<h4 id="与适配器模式的对比-1">7. 与适配器模式的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>装饰者模式</th>
<th>适配器模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>目的</strong></td>
<td>增强功能</td>
<td>接口转换</td>
</tr>
<tr class="even">
<td><strong>结构</strong></td>
<td>包装同类对象</td>
<td>适配不同类</td>
</tr>
<tr class="odd">
<td><strong>调用</strong></td>
<td>递归调用</td>
<td>转换调用</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-7">8. 实际应用场景</h4>
<ul>
<li><strong>IO 流</strong>：<code>BufferedInputStream</code> 装饰
<code>InputStream</code>。</li>
<li><strong>GUI 组件</strong>：添加边框、滚动条等装饰。</li>
<li><strong>日志系统</strong>：为日志添加时间戳、格式化。</li>
</ul>
<hr />
<h4 id="源码中的例子-7">9. 源码中的例子</h4>
<p>Java 中的 <code>java.io</code> 包： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">InputStream</span> <span class="variable">input</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;file.txt&quot;</span>);</span><br><span class="line"><span class="type">InputStream</span> <span class="variable">buffered</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedInputStream</span>(input);  <span class="comment">// 装饰</span></span><br></pre></td></tr></table></figure></p>
<hr />
<h4 id="总结-7">10. 总结</h4>
<ul>
<li><strong>装饰者模式</strong>通过包装动态增强对象功能，保持接口一致。</li>
<li><strong>Java 实现</strong>依赖接口和组合，支持多层装饰。</li>
<li><strong>UML 图</strong>展示了组件和装饰者的递归关系。</li>
</ul>
<h3 id="外观facade"><strong>外观（Facade）</strong></h3>
<p>外观模式是一种结构型设计模式，它为复杂的子系统提供一个简化的统一接口，隐藏子系统的复杂性，使客户端更容易使用。</p>
<p>以下是用 Java
实现外观模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="外观模式的定义">1. 外观模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：通过一个外观类封装子系统的复杂操作，提供简单的高层接口。</li>
<li><strong>目的</strong>：
<ul>
<li>简化客户端与子系统的交互。</li>
<li>解耦客户端与子系统，降低依赖性。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>子系统复杂且难以直接使用。</li>
<li>需要为子系统提供统一入口。</li>
<li>分层设计中隔离层间耦合。</li>
</ul></li>
</ul>
<hr />
<h4 id="外观模式的结构">2. 外观模式的结构</h4>
<ul>
<li><strong>子系统（Subsystem）</strong>：一组独立的类，完成特定功能。</li>
<li><strong>外观（Facade）</strong>：封装子系统，提供简化的接口。</li>
<li><strong>客户端（Client）</strong>：通过外观访问子系统。</li>
</ul>
<h5 id="mermaid-uml-图-3">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Facade &#123;
        -subsystemA: SubsystemA
        -subsystemB: SubsystemB
        +operation()
    &#125;
    class SubsystemA &#123;
        +operationA()
    &#125;
    class SubsystemB &#123;
        +operationB()
    &#125;
    class Client
    
    Client --&gt; Facade : uses
    Facade --&gt; SubsystemA : delegates
    Facade --&gt; SubsystemB : delegates</code></pre>
<hr />
<h4 id="java-实现示例-8">3. Java 实现示例</h4>
<p>以下是一个家庭影院系统的外观模式示例，简化音响、投影仪和灯光的操作。</p>
<h5 id="子系统类">3.1 子系统类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 子系统：音响</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AudioSystem</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">turnOn</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Audio system is on&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVolume</span><span class="params">(<span class="type">int</span> level)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Audio volume set to &quot;</span> + level);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">turnOff</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Audio system is off&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子系统：投影仪</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Projector</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">turnOn</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Projector is on&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setInput</span><span class="params">(String input)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Projector input set to &quot;</span> + input);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">turnOff</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Projector is off&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 子系统：灯光</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Lights</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dim</span><span class="params">(<span class="type">int</span> level)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Lights dimmed to &quot;</span> + level + <span class="string">&quot;%&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">turnOff</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Lights are off&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="外观类">3.2 外观类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 外观：家庭影院</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HomeTheaterFacade</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> AudioSystem audio;</span><br><span class="line">    <span class="keyword">private</span> Projector projector;</span><br><span class="line">    <span class="keyword">private</span> Lights lights;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">HomeTheaterFacade</span><span class="params">(AudioSystem audio, Projector projector, Lights lights)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.audio = audio;</span><br><span class="line">        <span class="built_in">this</span>.projector = projector;</span><br><span class="line">        <span class="built_in">this</span>.lights = lights;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">watchMovie</span><span class="params">(String input)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Preparing to watch a movie...&quot;</span>);</span><br><span class="line">        audio.turnOn();</span><br><span class="line">        audio.setVolume(<span class="number">50</span>);</span><br><span class="line">        projector.turnOn();</span><br><span class="line">        projector.setInput(input);</span><br><span class="line">        lights.dim(<span class="number">20</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Movie is ready!&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">endMovie</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Shutting down the movie...&quot;</span>);</span><br><span class="line">        audio.turnOff();</span><br><span class="line">        projector.turnOff();</span><br><span class="line">        lights.turnOff();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-8">3.3 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">AudioSystem</span> <span class="variable">audio</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AudioSystem</span>();</span><br><span class="line">        <span class="type">Projector</span> <span class="variable">projector</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Projector</span>();</span><br><span class="line">        <span class="type">Lights</span> <span class="variable">lights</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Lights</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">HomeTheaterFacade</span> <span class="variable">theater</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HomeTheaterFacade</span>(audio, projector, lights);</span><br><span class="line"></span><br><span class="line">        theater.watchMovie(<span class="string">&quot;HDMI&quot;</span>);  <span class="comment">// 启动电影</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        输出:</span></span><br><span class="line"><span class="comment">        Preparing to watch a movie...</span></span><br><span class="line"><span class="comment">        Audio system is on</span></span><br><span class="line"><span class="comment">        Audio volume set to 50</span></span><br><span class="line"><span class="comment">        Projector is on</span></span><br><span class="line"><span class="comment">        Projector input set to HDMI</span></span><br><span class="line"><span class="comment">        Lights dimmed to 20%</span></span><br><span class="line"><span class="comment">        Movie is ready!</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        theater.endMovie();  <span class="comment">// 关闭电影</span></span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        输出:</span></span><br><span class="line"><span class="comment">        Shutting down the movie...</span></span><br><span class="line"><span class="comment">        Audio system is off</span></span><br><span class="line"><span class="comment">        Projector is off</span></span><br><span class="line"><span class="comment">        Lights are off</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-8">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>创建子系统实例并注入外观类。</li>
<li>调用外观的简化方法（如
<code>watchMovie</code>），外观协调子系统完成任务。</li>
<li>子系统独立运行，客户端无需直接操作。</li>
</ol>
<hr />
<h4 id="优点-8">5. 优点</h4>
<ul>
<li><strong>简化接口</strong>：降低客户端使用子系统的复杂度。</li>
<li><strong>解耦</strong>：客户端与子系统隔离，降低耦合度。</li>
<li><strong>封装性</strong>：隐藏子系统细节。</li>
</ul>
<hr />
<h4 id="缺点-8">6. 缺点</h4>
<ul>
<li><strong>功能有限</strong>：外观可能无法满足所有需求，客户端可能仍需直接访问子系统。</li>
<li><strong>新增开销</strong>：增加一个外观类，可能提高维护成本。</li>
</ul>
<hr />
<h4 id="与适配器模式的对比-2">7. 与适配器模式的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>外观模式</th>
<th>适配器模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>目的</strong></td>
<td>简化接口</td>
<td>接口转换</td>
</tr>
<tr class="even">
<td><strong>作用对象</strong></td>
<td>整个子系统</td>
<td>单个类</td>
</tr>
<tr class="odd">
<td><strong>复杂度</strong></td>
<td>降低使用复杂度</td>
<td>增加适配层复杂度</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-8">8. 实际应用场景</h4>
<ul>
<li><strong>数据库访问</strong>：封装 JDBC 操作，提供简单 API。</li>
<li><strong>多媒体系统</strong>：简化设备控制（如电视、音响）。</li>
<li><strong>工具库</strong>：为复杂底层功能提供高层接口。</li>
</ul>
<hr />
<h4 id="源码中的例子-8">9. 源码中的例子</h4>
<p>Java 中的 <code>java.util.logging.Logger</code>： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> Logger.getLogger(<span class="string">&quot;myLogger&quot;</span>);  <span class="comment">// 外观简化日志操作</span></span><br><span class="line">logger.info(<span class="string">&quot;Message&quot;</span>);</span><br></pre></td></tr></table></figure></p>
<hr />
<h4 id="总结-8">10. 总结</h4>
<ul>
<li><strong>外观模式</strong>通过封装子系统提供简化的统一接口，降低使用难度。</li>
<li><strong>Java 实现</strong>依赖组合，协调多个子系统。</li>
<li><strong>UML 图</strong>展示了外观与子系统的委托关系。</li>
</ul>
<h3 id="享元flyweight"><strong>享元（Flyweight）</strong></h3>
<p>享元模式（Flyweight
Pattern）是一种结构型设计模式，旨在通过共享对象来减少内存使用和提高性能。它适用于系统中存在大量相似对象的情况，通过复用已有的对象而不是创建新实例来优化资源消耗。</p>
<p>以下是用 Java
实现享元模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="享元模式的定义">1. 享元模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：共享相同的对象实例，减少重复创建，降低内存开销。</li>
<li><strong>目的</strong>：
<ul>
<li>提高系统效率，特别是在对象数量庞大时。</li>
<li>分离对象的内在状态（共享）和外在状态（不共享）。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>系统有大量相似对象。</li>
<li>对象创建成本高且可共享。</li>
<li>需要缓存不可变对象。</li>
</ul></li>
</ul>
<hr />
<h4 id="享元模式的结构">2. 享元模式的结构</h4>
<ul>
<li><strong>抽象享元（Flyweight）</strong>：定义共享对象的接口。</li>
<li><strong>具体享元（Concrete
Flyweight）</strong>：实现享元接口，存储内在状态。</li>
<li><strong>享元工厂（Flyweight
Factory）</strong>：管理享元对象的创建和共享。</li>
<li><strong>客户端（Client）</strong>：使用享元对象，维护外在状态。</li>
</ul>
<h5 id="mermaid-uml-图-4">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Flyweight &#123;
        +operation(extrinsicState)
    &#125;
    class ConcreteFlyweight &#123;
        -intrinsicState
        +operation(extrinsicState)
    &#125;
    class FlyweightFactory &#123;
        -flyweights: Map
        +getFlyweight(key) Flyweight
    &#125;
    class Client
    
    ConcreteFlyweight ..|&gt; Flyweight : implements
    FlyweightFactory --&gt; Flyweight : creates
    Client --&gt; FlyweightFactory : uses
    Client --&gt; Flyweight : uses</code></pre>
<hr />
<h4 id="java-实现示例-9">3. Java 实现示例</h4>
<p>以下是一个绘制圆形的享元模式示例，共享颜色相同的圆形对象。</p>
<h5 id="抽象享元接口">3.1 抽象享元接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象享元：圆形</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span>;  <span class="comment">// 外在状态由客户端传入</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体享元类">3.2 具体享元类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体享元：圆形（共享颜色）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Circle</span> <span class="keyword">implements</span> <span class="title class_">Shape</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String color;  <span class="comment">// 内在状态（共享）</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Circle</span><span class="params">(String color)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.color = color;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">draw</span><span class="params">(<span class="type">int</span> x, <span class="type">int</span> y)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Drawing a &quot;</span> + color + <span class="string">&quot; circle at (&quot;</span> + x + <span class="string">&quot;, &quot;</span> + y + <span class="string">&quot;)&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="享元工厂">3.3 享元工厂</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 享元工厂：管理圆形对象</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShapeFactory</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Shape&gt; circleMap = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Shape <span class="title function_">getCircle</span><span class="params">(String color)</span> &#123;</span><br><span class="line">        <span class="type">Shape</span> <span class="variable">circle</span> <span class="operator">=</span> circleMap.get(color);</span><br><span class="line">        <span class="keyword">if</span> (circle == <span class="literal">null</span>) &#123;</span><br><span class="line">            circle = <span class="keyword">new</span> <span class="title class_">Circle</span>(color);</span><br><span class="line">            circleMap.put(color, circle);</span><br><span class="line">            System.out.println(<span class="string">&quot;Created a new &quot;</span> + color + <span class="string">&quot; circle&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> circle;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-9">3.4 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String[] colors = &#123;<span class="string">&quot;Red&quot;</span>, <span class="string">&quot;Blue&quot;</span>, <span class="string">&quot;Green&quot;</span>&#125;;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">color</span> <span class="operator">=</span> colors[(<span class="type">int</span>) (Math.random() * colors.length)];</span><br><span class="line">            <span class="type">Shape</span> <span class="variable">circle</span> <span class="operator">=</span> ShapeFactory.getCircle(color);</span><br><span class="line">            circle.draw(i, i * <span class="number">2</span>);  <span class="comment">// 外在状态：位置</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>输出示例</strong>： <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">Created a new Red circle</span><br><span class="line">Drawing a Red circle at (0, 0)</span><br><span class="line">Created a new Blue circle</span><br><span class="line">Drawing a Blue circle at (1, 2)</span><br><span class="line">Drawing a Red circle at (2, 4)</span><br><span class="line">Created a new Green circle</span><br><span class="line">Drawing a Green circle at (3, 6)</span><br><span class="line">Drawing a Blue circle at (4, 8)</span><br><span class="line">...</span><br></pre></td></tr></table></figure> -
<strong>说明</strong>：相同颜色的圆形只创建一次，之后共享。</p>
<hr />
<h4 id="工作原理-9">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>通过工厂请求享元对象（如
<code>getCircle</code>）。</li>
<li>工厂检查是否已有对应对象，若无则创建并缓存，若有则返回共享实例。</li>
<li>客户端传入外在状态（如位置），调用享元方法。</li>
</ol>
<hr />
<h4 id="内在状态-vs-外在状态">5. 内在状态 vs 外在状态</h4>
<ul>
<li><strong>内在状态</strong>：存储在享元对象中，不可变且可共享（如
<code>color</code>）。</li>
<li><strong>外在状态</strong>：由客户端维护，不共享（如
<code>x</code>、<code>y</code> 坐标）。</li>
</ul>
<hr />
<h4 id="优点-9">6. 优点</h4>
<ul>
<li><strong>节省内存</strong>：共享对象减少实例数量。</li>
<li><strong>性能提升</strong>：避免重复创建耗时对象。</li>
<li><strong>集中管理</strong>：工厂统一管理共享对象。</li>
</ul>
<hr />
<h4 id="缺点-9">7. 缺点</h4>
<ul>
<li><strong>复杂度增加</strong>：需要分离内外状态，设计更复杂。</li>
<li><strong>线程安全</strong>：共享对象需考虑并发访问（可用同步或不可变设计）。</li>
<li><strong>适用性有限</strong>：仅适合大量相似对象的场景。</li>
</ul>
<hr />
<h4 id="与单例模式的对比">8. 与单例模式的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>享元模式</th>
<th>单例模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>实例数量</strong></td>
<td>多实例（按键共享）</td>
<td>单实例</td>
</tr>
<tr class="even">
<td><strong>目的</strong></td>
<td>共享减少内存</td>
<td>确保唯一性</td>
</tr>
<tr class="odd">
<td><strong>管理</strong></td>
<td>工厂管理</td>
<td>静态方法控制</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-9">9. 实际应用场景</h4>
<ul>
<li><strong>字符缓存</strong>：文本编辑器中共享字体或字符对象。</li>
<li><strong>游戏开发</strong>：复用纹理或模型实例。</li>
<li><strong>连接池</strong>：数据库连接或线程池的共享管理。</li>
</ul>
<hr />
<h4 id="源码中的例子-9">10. 源码中的例子</h4>
<p>Java 中的 <code>Integer.valueOf()</code>： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">a</span> <span class="operator">=</span> Integer.valueOf(<span class="number">100</span>);  <span class="comment">// 缓存 -128 到 127 的整数</span></span><br><span class="line"><span class="type">Integer</span> <span class="variable">b</span> <span class="operator">=</span> Integer.valueOf(<span class="number">100</span>);</span><br><span class="line">System.out.println(a == b);  <span class="comment">// true，共享同一对象</span></span><br></pre></td></tr></table></figure></p>
<hr />
<h4 id="总结-9">11. 总结</h4>
<ul>
<li><strong>享元模式</strong>通过共享对象优化资源使用，分离内外状态。</li>
<li><strong>Java 实现</strong>依赖工厂和缓存（如
<code>Map</code>），支持高效复用。</li>
<li><strong>UML 图</strong>展示了享元、工厂和客户端的关系。</li>
</ul>
<h3 id="代理proxy"><strong>代理（Proxy）</strong></h3>
<p>代理模式（Proxy
Pattern）是一种结构型设计模式，通过引入一个代理对象来控制对目标对象的访问。它可以在不修改目标对象的情况下，增强功能（如权限检查、延迟加载、日志记录等）。代理模式的核心是为目标对象提供一个替代者，客户端通过代理间接访问目标。</p>
<p>以下是用 Java
实现代理模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="代理模式的定义">1. 代理模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：通过代理对象控制对目标对象的访问，增加额外的功能或限制。</li>
<li><strong>目的</strong>：
<ul>
<li>增强目标对象功能。</li>
<li>保护或隐藏目标对象。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>延迟加载（虚拟代理）。</li>
<li>访问控制（保护代理）。</li>
<li>日志或缓存（装饰代理）。</li>
</ul></li>
</ul>
<hr />
<h4 id="代理模式的结构">2. 代理模式的结构</h4>
<ul>
<li><strong>抽象主题（Subject）</strong>：定义目标和代理的公共接口。</li>
<li><strong>真实主题（Real
Subject）</strong>：实现主题接口，是被代理的目标对象。</li>
<li><strong>代理（Proxy）</strong>：实现主题接口，持有真实主题引用，控制访问并添加功能。</li>
</ul>
<h5 id="mermaid-uml-图-5">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Subject &#123;
        +request()
    &#125;
    class RealSubject &#123;
        +request()
    &#125;
    class Proxy &#123;
        -realSubject: RealSubject
        +request()
    &#125;
    
	RealSubject ..|&gt; Subject : implements
	Proxy ..|&gt; Subject : implements
	Proxy --&gt; RealSubject : uses</code></pre>
<hr />
<h4 id="代理模式的类型">3. 代理模式的类型</h4>
<ol type="1">
<li><strong>静态代理</strong>：代理类在编译时手动创建。</li>
<li><strong>动态代理</strong>：运行时通过反射动态生成（如 Java 的
<code>Proxy</code> 类）。</li>
<li><strong>虚拟代理</strong>：延迟加载目标对象。</li>
<li><strong>保护代理</strong>：控制访问权限。</li>
</ol>
<hr />
<h4 id="java-实现示例-10">4. Java 实现示例</h4>
<p>以下是一个文件访问的代理模式示例，展示静态代理和动态代理。</p>
<h5 id="抽象主题">4.1 抽象主题</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象主题：文件操作</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FileService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">readFile</span><span class="params">(String fileName)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="真实主题">4.2 真实主题</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 真实主题：文件服务实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">FileService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readFile</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Reading file: &quot;</span> + fileName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="静态代理">4.3 静态代理</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 静态代理：添加日志功能</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileServiceProxy</span> <span class="keyword">implements</span> <span class="title class_">FileService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> FileService realService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FileServiceProxy</span><span class="params">(FileService realService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.realService = realService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">readFile</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Logging: Attempting to read file &quot;</span> + fileName);</span><br><span class="line">        realService.readFile(fileName);</span><br><span class="line">        System.out.println(<span class="string">&quot;Logging: File read completed&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="动态代理">4.4 动态代理</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.InvocationHandler;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Method;</span><br><span class="line"><span class="keyword">import</span> java.lang.reflect.Proxy;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 动态代理：通过反射实现</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DynamicProxyHandler</span> <span class="keyword">implements</span> <span class="title class_">InvocationHandler</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Object target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DynamicProxyHandler</span><span class="params">(Object target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">invoke</span><span class="params">(Object proxy, Method method, Object[] args)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Dynamic Logging: Before &quot;</span> + method.getName());</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> method.invoke(target, args);</span><br><span class="line">        System.out.println(<span class="string">&quot;Dynamic Logging: After &quot;</span> + method.getName());</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> FileService <span class="title function_">createProxy</span><span class="params">(FileService target)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (FileService) Proxy.newProxyInstance(</span><br><span class="line">            target.getClass().getClassLoader(),</span><br><span class="line">            target.getClass().getInterfaces(),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">DynamicProxyHandler</span>(target)</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-10">4.5 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 静态代理</span></span><br><span class="line">        <span class="type">FileService</span> <span class="variable">realService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileServiceImpl</span>();</span><br><span class="line">        <span class="type">FileService</span> <span class="variable">staticProxy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileServiceProxy</span>(realService);</span><br><span class="line">        staticProxy.readFile(<span class="string">&quot;data.txt&quot;</span>);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        输出:</span></span><br><span class="line"><span class="comment">        Logging: Attempting to read file data.txt</span></span><br><span class="line"><span class="comment">        Reading file: data.txt</span></span><br><span class="line"><span class="comment">        Logging: File read completed</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 动态代理</span></span><br><span class="line">        <span class="type">FileService</span> <span class="variable">dynamicProxy</span> <span class="operator">=</span> DynamicProxyHandler.createProxy(realService);</span><br><span class="line">        dynamicProxy.readFile(<span class="string">&quot;config.txt&quot;</span>);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        输出:</span></span><br><span class="line"><span class="comment">        Dynamic Logging: Before readFile</span></span><br><span class="line"><span class="comment">        Reading file: config.txt</span></span><br><span class="line"><span class="comment">        Dynamic Logging: After readFile</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-10">5. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>通过代理对象调用方法。</li>
<li>代理执行额外逻辑（如日志、权限检查），然后委托给真实主题。</li>
<li>真实主题完成核心操作，返回结果。</li>
</ol>
<hr />
<h4 id="优点-10">6. 优点</h4>
<ul>
<li><strong>功能增强</strong>：无需修改目标代码即可添加功能。</li>
<li><strong>控制访问</strong>：代理可限制或延迟对目标的访问。</li>
<li><strong>灵活性</strong>：动态代理支持运行时调整。</li>
</ul>
<hr />
<h4 id="缺点-10">7. 缺点</h4>
<ul>
<li><strong>性能开销</strong>：代理层增加调用
overhead，尤其是动态代理。</li>
<li><strong>复杂度</strong>：实现动态代理需熟悉反射。</li>
<li><strong>静态局限</strong>：静态代理需为每个目标手动编写代理类。</li>
</ul>
<hr />
<h4 id="与装饰者模式的对比-1">8. 与装饰者模式的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>代理模式</th>
<th>装饰者模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>目的</strong></td>
<td>控制访问</td>
<td>增强功能</td>
</tr>
<tr class="even">
<td><strong>关注点</strong></td>
<td>代理行为</td>
<td>对象功能</td>
</tr>
<tr class="odd">
<td><strong>结构</strong></td>
<td>单层代理</td>
<td>多层包装</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-10">9. 实际应用场景</h4>
<ul>
<li><strong>延迟加载</strong>：如 ORM 框架中的懒加载（Hibernate）。</li>
<li><strong>权限控制</strong>：限制对敏感资源的访问。</li>
<li><strong>AOP</strong>：Spring
中通过代理实现切面（如日志、事务）。</li>
</ul>
<hr />
<h4 id="源码中的例子-10">10. 源码中的例子</h4>
<p>Java 中的 <code>java.lang.reflect.Proxy</code>： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Runnable</span> <span class="variable">proxy</span> <span class="operator">=</span> (Runnable) Proxy.newProxyInstance(</span><br><span class="line">    Runnable.class.getClassLoader(),</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Class</span>&lt;?&gt;[]&#123;Runnable.class&#125;,</span><br><span class="line">    (p, method, args) -&gt; &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Before run&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">);</span><br><span class="line">proxy.run();</span><br></pre></td></tr></table></figure></p>
<hr />
<h4 id="总结-10">11. 总结</h4>
<ul>
<li><strong>代理模式</strong>通过代理对象控制目标访问，支持静态和动态实现。</li>
<li><strong>Java 实现</strong>静态代理用组合，动态代理用反射。</li>
<li><strong>UML 图</strong>展示了代理与真实主题的关系。</li>
</ul>
<h2 id="行为型模式behavioral-patterns">行为型模式（Behavioral
Patterns）</h2>
<h3 id="责任链chain-of-responsibility"><strong>责任链（Chain of
Responsibility）</strong></h3>
<p>我假设你指的是“责任链模式”（Chain of Responsibility
Pattern），可能是“责任链”中的简写或输入问题。责任链模式是一种行为型设计模式，它将请求的处理者组织成一个链，请求沿着链传递，直到某个处理者处理它或链结束。这种模式解耦了请求的发送者和接收者，增强了灵活性。</p>
<p>以下是用 Java
实现责任链模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="责任链模式的定义">1. 责任链模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：将请求的处理者组成一个链，请求沿链传递，每个处理者决定处理或转发。</li>
<li><strong>目的</strong>：
<ul>
<li>解耦请求发送者和处理者。</li>
<li>动态调整处理顺序或责任分配。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>请求有多个处理者，但处理者不确定。</li>
<li>需要动态指定处理流程。</li>
<li>处理逻辑分层或条件化。</li>
</ul></li>
</ul>
<hr />
<h4 id="责任链模式的结构">2. 责任链模式的结构</h4>
<ul>
<li><strong>抽象处理者（Handler）</strong>：定义处理请求的接口和链的链接方法。</li>
<li><strong>具体处理者（Concrete
Handler）</strong>：实现处理逻辑，决定处理或传递请求。</li>
<li><strong>客户端（Client）</strong>：发起请求并交给链的起点。</li>
</ul>
<h5 id="mermaid-uml-图-6">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Handler &#123;
        -next: Handler
        +setNext(Handler)
        +handleRequest(request)
    &#125;
    class ConcreteHandlerA &#123;
        +handleRequest(request)
    &#125;
    class ConcreteHandlerB &#123;
        +handleRequest(request)
    &#125;
    class Client
    
    ConcreteHandlerA ..|&gt; Handler : implements
    ConcreteHandlerB ..|&gt; Handler : implements
    Handler o--&gt; Handler : next
    Client --&gt; Handler : sends to</code></pre>
<hr />
<h4 id="java-实现示例-11">3. Java 实现示例</h4>
<p>以下是一个日志处理的责任链模式示例，根据日志级别分发处理。</p>
<h5 id="抽象处理者">3.1 抽象处理者</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象处理者：日志处理器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> Logger nextLogger;  <span class="comment">// 下一个处理者</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">int</span> level;          <span class="comment">// 处理级别</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setNext</span><span class="params">(Logger nextLogger)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.nextLogger = nextLogger;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logMessage</span><span class="params">(<span class="type">int</span> level, String message)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.level &lt;= level) &#123;</span><br><span class="line">            write(message);  <span class="comment">// 当前处理者处理</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (nextLogger != <span class="literal">null</span>) &#123;</span><br><span class="line">            nextLogger.logMessage(level, message);  <span class="comment">// 传递给下一个</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体处理者">3.2 具体处理者</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体处理者：控制台日志</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsoleLogger</span> <span class="keyword">extends</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConsoleLogger</span><span class="params">(<span class="type">int</span> level)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.level = level;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Console Logger: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者：文件日志</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileLogger</span> <span class="keyword">extends</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">FileLogger</span><span class="params">(<span class="type">int</span> level)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.level = level;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;File Logger: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体处理者：错误日志</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ErrorLogger</span> <span class="keyword">extends</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ErrorLogger</span><span class="params">(<span class="type">int</span> level)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.level = level;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">write</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Error Logger: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-11">3.3 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">INFO</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">DEBUG</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">ERROR</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建处理者</span></span><br><span class="line">        <span class="type">Logger</span> <span class="variable">consoleLogger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConsoleLogger</span>(INFO);</span><br><span class="line">        <span class="type">Logger</span> <span class="variable">fileLogger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileLogger</span>(DEBUG);</span><br><span class="line">        <span class="type">Logger</span> <span class="variable">errorLogger</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ErrorLogger</span>(ERROR);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构建责任链</span></span><br><span class="line">        consoleLogger.setNext(fileLogger);</span><br><span class="line">        fileLogger.setNext(errorLogger);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 发送请求</span></span><br><span class="line">        consoleLogger.logMessage(INFO, <span class="string">&quot;This is an info message&quot;</span>);</span><br><span class="line">        consoleLogger.logMessage(DEBUG, <span class="string">&quot;This is a debug message&quot;</span>);</span><br><span class="line">        consoleLogger.logMessage(ERROR, <span class="string">&quot;This is an error message&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>输出</strong>： <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Console Logger: This is an info message</span><br><span class="line">Console Logger: This is a debug message</span><br><span class="line">File Logger: This is a debug message</span><br><span class="line">Console Logger: This is an error message</span><br><span class="line">File Logger: This is an error message</span><br><span class="line">Error Logger: This is an error message</span><br></pre></td></tr></table></figure> -
<strong>说明</strong>：消息按级别沿链传递，符合条件的处理者输出日志。</p>
<hr />
<h4 id="工作原理-11">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>构建责任链，设置处理者顺序。</li>
<li>请求从链头开始传递，每个处理者检查是否处理。</li>
<li>若当前处理者不处理，则传递给下一个，直到链结束。</li>
</ol>
<hr />
<h4 id="优点-11">5. 优点</h4>
<ul>
<li><strong>解耦</strong>：请求发送者无需知道具体处理者。</li>
<li><strong>灵活性</strong>：可动态调整链的结构和顺序。</li>
<li><strong>扩展性</strong>：易于添加新处理者。</li>
</ul>
<hr />
<h4 id="缺点-11">6. 缺点</h4>
<ul>
<li><strong>不确定性</strong>：请求可能未被处理（链尾无匹配）。</li>
<li><strong>性能开销</strong>：链过长可能影响效率。</li>
<li><strong>调试复杂</strong>：多处理者时难以跟踪流程。</li>
</ul>
<hr />
<h4 id="与装饰者模式的对比-2">7. 与装饰者模式的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>责任链模式</th>
<th>装饰者模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>目的</strong></td>
<td>分担责任</td>
<td>增强功能</td>
</tr>
<tr class="even">
<td><strong>传递</strong></td>
<td>条件传递</td>
<td>递归调用</td>
</tr>
<tr class="odd">
<td><strong>结果</strong></td>
<td>单处理或无处理</td>
<td>层层增强</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-11">8. 实际应用场景</h4>
<ul>
<li><strong>Servlet 过滤器</strong>：请求沿 Filter 链处理。</li>
<li><strong>日志框架</strong>：如 SLF4J 的日志级别处理。</li>
<li><strong>事件处理</strong>：GUI 事件传递。</li>
</ul>
<hr />
<h4 id="源码中的例子-11">9. 源码中的例子</h4>
<p>Java 中的 <code>javax.servlet.FilterChain</code>： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest request, ServletResponse response, FilterChain chain)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Before filter&quot;</span>);</span><br><span class="line">        chain.doFilter(request, response);  <span class="comment">// 传递给下一个</span></span><br><span class="line">        System.out.println(<span class="string">&quot;After filter&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr />
<h4 id="总结-11">10. 总结</h4>
<ul>
<li><strong>责任链模式</strong>通过链式结构分担请求处理，解耦发送者和接收者。</li>
<li><strong>Java 实现</strong>依赖抽象类和链式引用，支持动态调整。</li>
<li><strong>UML 图</strong>展示了处理者的链接关系。</li>
</ul>
<h3 id="命令command"><strong>命令（Command）</strong></h3>
<p>命令模式（Command
Pattern）是一种行为型设计模式，它将请求封装成一个对象，从而允许参数化客户端、记录请求日志、支持撤销操作以及将请求排队或延迟执行。命令模式通过解耦请求的发送者和接收者，增强了系统的灵活性。</p>
<p>以下是用 Java
实现命令模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="命令模式的定义">1. 命令模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：将请求封装为命令对象，分离请求的发起者（Invoker）和执行者（Receiver）。</li>
<li><strong>目的</strong>：
<ul>
<li>解耦调用者和执行逻辑。</li>
<li>支持请求的存储、撤销、重做等操作。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>需要参数化操作（如菜单、按钮）。</li>
<li>支持事务或回滚。</li>
<li>请求需要排队或延迟执行。</li>
</ul></li>
</ul>
<hr />
<h4 id="命令模式的结构">2. 命令模式的结构</h4>
<ul>
<li><strong>抽象命令（Command）</strong>：定义命令的接口，通常包含执行方法。</li>
<li><strong>具体命令（Concrete
Command）</strong>：实现命令接口，关联接收者并调用其操作。</li>
<li><strong>接收者（Receiver）</strong>：执行具体操作的类。</li>
<li><strong>调用者（Invoker）</strong>：持有命令对象并触发执行。</li>
<li><strong>客户端（Client）</strong>：创建命令并配置调用者。</li>
</ul>
<h5 id="mermaid-uml-图-7">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Command &#123;
        +execute()
    &#125;
    class ConcreteCommand &#123;
        -receiver: Receiver
        +execute()
    &#125;
    class Receiver &#123;
        +action()
    &#125;
    class Invoker &#123;
        -command: Command
        +setCommand(Command)
        +executeCommand()
    &#125;
    class Client
    
    ConcreteCommand ..|&gt; Command : implements
    ConcreteCommand --&gt; Receiver : uses
    Invoker --&gt; Command : holds
    Client --&gt; Invoker : configures
    Client --&gt; ConcreteCommand : creates</code></pre>
<hr />
<h4 id="java-实现示例-12">3. Java 实现示例</h4>
<p>以下是一个控制灯光开关的命令模式示例。</p>
<h5 id="接收者">3.1 接收者</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 接收者：灯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Light</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">turnOn</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Light is ON&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">turnOff</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Light is OFF&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="抽象命令">3.2 抽象命令</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象命令</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体命令">3.3 具体命令</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体命令：开灯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LightOnCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Light light;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LightOnCommand</span><span class="params">(Light light)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.light = light;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        light.turnOn();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体命令：关灯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LightOffCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Light light;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LightOffCommand</span><span class="params">(Light light)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.light = light;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        light.turnOff();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="调用者">3.4 调用者</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 调用者：遥控器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RemoteControl</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Command command;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCommand</span><span class="params">(Command command)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.command = command;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pressButton</span><span class="params">()</span> &#123;</span><br><span class="line">        command.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-12">3.5 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建接收者</span></span><br><span class="line">        <span class="type">Light</span> <span class="variable">light</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Light</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建命令</span></span><br><span class="line">        <span class="type">Command</span> <span class="variable">lightOn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LightOnCommand</span>(light);</span><br><span class="line">        <span class="type">Command</span> <span class="variable">lightOff</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LightOffCommand</span>(light);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建调用者</span></span><br><span class="line">        <span class="type">RemoteControl</span> <span class="variable">remote</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RemoteControl</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行开灯</span></span><br><span class="line">        remote.setCommand(lightOn);</span><br><span class="line">        remote.pressButton();  <span class="comment">// 输出: Light is ON</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 执行关灯</span></span><br><span class="line">        remote.setCommand(lightOff);</span><br><span class="line">        remote.pressButton();  <span class="comment">// 输出: Light is OFF</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-12">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>创建接收者和命令，将命令与接收者关联。</li>
<li>将命令注入调用者（<code>RemoteControl</code>）。</li>
<li>调用者触发命令执行，命令调用接收者的方法。</li>
</ol>
<hr />
<h4 id="优点-12">5. 优点</h4>
<ul>
<li><strong>解耦</strong>：请求发起者和执行者分离。</li>
<li><strong>扩展性</strong>：易于添加新命令。</li>
<li><strong>支持撤销</strong>：可通过添加 <code>undo()</code>
方法实现回滚。</li>
<li><strong>可记录</strong>：命令对象可存储用于日志或重做。</li>
</ul>
<hr />
<h4 id="缺点-12">6. 缺点</h4>
<ul>
<li><strong>类数量增加</strong>：每个操作需定义新命令类。</li>
<li><strong>复杂度</strong>：简单场景可能显得过于繁琐。</li>
</ul>
<hr />
<h4 id="支持撤销的扩展">7. 支持撤销的扩展</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LightOnCommand</span> <span class="keyword">implements</span> <span class="title class_">Command</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Light light;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LightOnCommand</span><span class="params">(Light light)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.light = light;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">()</span> &#123;</span><br><span class="line">        light.turnOn();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">undo</span><span class="params">()</span> &#123;</span><br><span class="line">        light.turnOff();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Light</span> <span class="variable">light</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Light</span>();</span><br><span class="line">        <span class="type">Command</span> <span class="variable">lightOn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LightOnCommand</span>(light);</span><br><span class="line">        <span class="type">RemoteControl</span> <span class="variable">remote</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RemoteControl</span>();</span><br><span class="line"></span><br><span class="line">        remote.setCommand(lightOn);</span><br><span class="line">        remote.pressButton();  <span class="comment">// 输出: Light is ON</span></span><br><span class="line">        ((LightOnCommand) lightOn).undo();  <span class="comment">// 输出: Light is OFF</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="与策略模式的对比">8. 与策略模式的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>命令模式</th>
<th>策略模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>目的</strong></td>
<td>封装请求</td>
<td>封装算法</td>
</tr>
<tr class="even">
<td><strong>关注点</strong></td>
<td>操作执行</td>
<td>行为选择</td>
</tr>
<tr class="odd">
<td><strong>结构</strong></td>
<td>命令+接收者</td>
<td>上下文+策略</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-12">9. 实际应用场景</h4>
<ul>
<li><strong>GUI 按钮</strong>：按钮点击触发命令。</li>
<li><strong>事务管理</strong>：支持回滚的操作队列。</li>
<li><strong>宏命令</strong>：组合多个命令执行。</li>
</ul>
<hr />
<h4 id="源码中的例子-12">10. 源码中的例子</h4>
<p>Java 中的 <code>Runnable</code>： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; System.out.println(<span class="string">&quot;Running&quot;</span>));</span><br><span class="line">thread.start();  <span class="comment">// 封装并执行命令</span></span><br></pre></td></tr></table></figure></p>
<hr />
<h4 id="总结-12">11. 总结</h4>
<ul>
<li><strong>命令模式</strong>将请求封装为对象，解耦发起者和执行者。</li>
<li><strong>Java 实现</strong>依赖接口和组合，支持扩展功能如撤销。</li>
<li><strong>UML 图</strong>展示了命令、接收者和调用者的关系。</li>
</ul>
<p>如果需要宏命令示例（组合多个命令）或调整 UML，请告诉我！</p>
<h3 id="解释器interpreter"><strong>解释器（Interpreter）</strong></h3>
<p>解释器模式（Interpreter
Pattern）是一种行为型设计模式，用于定义一种语言的语法，并通过解释器对象来解析和执行这种语言的语句。它特别适合处理简单的语法规则或领域特定语言（DSL），将复杂的表达式分解为可递归解释的对象。</p>
<p>以下是对解释器模式的详细讲解，包括定义、结构、Java
实现示例及其优缺点。</p>
<hr />
<h4 id="解释器模式的定义">1. 解释器模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：为特定语言定义语法表示，并通过递归解释器解析语句。</li>
<li><strong>目的</strong>：
<ul>
<li>将语法规则封装为对象，便于处理复杂的表达式。</li>
<li>支持动态解释和执行语言规则。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>解析简单的脚本或表达式（如数学表达式、查询语言）。</li>
<li>处理规则引擎或自定义语言。</li>
</ul></li>
</ul>
<hr />
<h4 id="解释器模式的结构">2. 解释器模式的结构</h4>
<ul>
<li><strong>抽象表达式（Abstract
Expression）</strong>：定义解释方法的接口。</li>
<li><strong>终结符表达式（Terminal
Expression）</strong>：表示语法中的基本元素，直接实现解释逻辑。</li>
<li><strong>非终结符表达式（Non-Terminal
Expression）</strong>：表示复合规则，递归调用子表达式解释。</li>
<li><strong>上下文（Context）</strong>：存储解释过程中需要的全局信息（如变量值）。</li>
<li><strong>客户端（Client）</strong>：构建表达式树并调用解释器。</li>
</ul>
<h5 id="mermaid-uml-图-8">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class AbstractExpression &#123;
        +interpret(context) int
    &#125;
    class TerminalExpression &#123;
        -value: int
        +interpret(context) int
    &#125;
    class NonTerminalExpression &#123;
        -left: AbstractExpression
        -right: AbstractExpression
        +interpret(context) int
    &#125;
    class Context &#123;
        -data: Map
        +getValue(key) int
        +setValue(key, value)
    &#125;
    class Client
    
    TerminalExpression ..|&gt; AbstractExpression : implements
	NonTerminalExpression ..|&gt; AbstractExpression : implements
    NonTerminalExpression o--&gt; &quot;2&quot; AbstractExpression : contains
    Client --&gt; AbstractExpression : uses
    Client --&gt; Context : uses</code></pre>
<hr />
<h4 id="java-实现示例-13">3. Java 实现示例</h4>
<p>以下是一个解析简单加减法的解释器模式示例。</p>
<h5 id="上下文类">3.1 上下文类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上下文：存储变量值</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Context</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Integer&gt; variables = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setVariable</span><span class="params">(String name, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        variables.put(name, value);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getVariable</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> variables.getOrDefault(name, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="抽象表达式">3.2 抽象表达式</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象表达式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line">    <span class="type">int</span> <span class="title function_">interpret</span><span class="params">(Context context)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="终结符表达式">3.3 终结符表达式</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 终结符表达式：数字或变量</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NumberExpression</span> <span class="keyword">implements</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String value;  <span class="comment">// 可以是数字或变量名</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NumberExpression</span><span class="params">(String value)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.value = value;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">interpret</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> Integer.parseInt(value);  <span class="comment">// 直接数字</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (NumberFormatException e) &#123;</span><br><span class="line">            <span class="keyword">return</span> context.getVariable(value);  <span class="comment">// 变量名</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="非终结符表达式">3.4 非终结符表达式</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 非终结符表达式：加法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AddExpression</span> <span class="keyword">implements</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Expression left;</span><br><span class="line">    <span class="keyword">private</span> Expression right;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AddExpression</span><span class="params">(Expression left, Expression right)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.left = left;</span><br><span class="line">        <span class="built_in">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">interpret</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> left.interpret(context) + right.interpret(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 非终结符表达式：减法</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SubtractExpression</span> <span class="keyword">implements</span> <span class="title class_">Expression</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Expression left;</span><br><span class="line">    <span class="keyword">private</span> Expression right;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SubtractExpression</span><span class="params">(Expression left, Expression right)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.left = left;</span><br><span class="line">        <span class="built_in">this</span>.right = right;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">interpret</span><span class="params">(Context context)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> left.interpret(context) - right.interpret(context);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-13">3.5 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建上下文并设置变量</span></span><br><span class="line">        <span class="type">Context</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Context</span>();</span><br><span class="line">        context.setVariable(<span class="string">&quot;x&quot;</span>, <span class="number">10</span>);</span><br><span class="line">        context.setVariable(<span class="string">&quot;y&quot;</span>, <span class="number">5</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 构建表达式：x + y - 3</span></span><br><span class="line">        <span class="type">Expression</span> <span class="variable">expression</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SubtractExpression</span>(</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">AddExpression</span>(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">NumberExpression</span>(<span class="string">&quot;x&quot;</span>),</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">NumberExpression</span>(<span class="string">&quot;y&quot;</span>)</span><br><span class="line">            ),</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">NumberExpression</span>(<span class="string">&quot;3&quot;</span>)</span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 解释执行</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> expression.interpret(context);</span><br><span class="line">        System.out.println(<span class="string">&quot;Result: &quot;</span> + result);  <span class="comment">// 输出: Result: 12 (10 + 5 - 3)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-13">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>构建表达式树（如
<code>x + y - 3</code>）。</li>
<li>将上下文（变量值）传递给表达式。</li>
<li>表达式递归调用 <code>interpret()</code> 方法，计算结果：
<ul>
<li>终结符直接返回值。</li>
<li>非终结符组合子表达式的结果。</li>
</ul></li>
</ol>
<hr />
<h4 id="优点-13">5. 优点</h4>
<ul>
<li><strong>灵活性</strong>：易于扩展新语法规则（新增表达式类）。</li>
<li><strong>模块化</strong>：语法规则封装为独立对象。</li>
<li><strong>可解释性</strong>：支持动态解析语言。</li>
</ul>
<hr />
<h4 id="缺点-13">6. 缺点</h4>
<ul>
<li><strong>复杂度高</strong>：大量表达式类增加系统复杂性。</li>
<li><strong>性能开销</strong>：递归解析复杂表达式可能效率低。</li>
<li><strong>适用性有限</strong>：仅适合简单语言，复杂语法（如完整编程语言）不实用。</li>
</ul>
<hr />
<h4 id="与其他模式的对比-1">7. 与其他模式的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>解释器模式</th>
<th>命令模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>目的</strong></td>
<td>解析语法</td>
<td>封装请求</td>
</tr>
<tr class="even">
<td><strong>结构</strong></td>
<td>表达式树</td>
<td>命令对象</td>
</tr>
<tr class="odd">
<td><strong>执行</strong></td>
<td>递归解释</td>
<td>单次调用</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-13">8. 实际应用场景</h4>
<ul>
<li><strong>数学表达式</strong>：计算器程序解析公式。</li>
<li><strong>规则引擎</strong>：解释业务规则。</li>
<li><strong>脚本语言</strong>：简单 DSL 的解析。</li>
</ul>
<hr />
<h4 id="源码中的例子-13">9. 源码中的例子</h4>
<p>Java 中的正则表达式（<code>java.util.regex</code>）：
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Pattern</span> <span class="variable">pattern</span> <span class="operator">=</span> Pattern.compile(<span class="string">&quot;\\d+&quot;</span>);  <span class="comment">// 定义语法</span></span><br><span class="line"><span class="type">Matcher</span> <span class="variable">matcher</span> <span class="operator">=</span> pattern.matcher(<span class="string">&quot;123&quot;</span>);</span><br><span class="line"><span class="keyword">if</span> (matcher.matches()) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;Valid number&quot;</span>);  <span class="comment">// 解释执行</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr />
<h4 id="总结-13">10. 总结</h4>
<ul>
<li><strong>解释器模式</strong>通过对象表示语法规则，递归解析表达式。</li>
<li><strong>Java 实现</strong>依赖接口和表达式树，支持动态解释。</li>
<li><strong>UML 图</strong>展示了表达式和上下文的关系。</li>
</ul>
<h3 id="迭代器iterator"><strong>迭代器（Iterator）</strong></h3>
<p>迭代器模式（Iterator
Pattern）是一种行为型设计模式，它提供了一种方法来顺序访问聚合对象（如集合、列表或数组）的元素，而无需暴露其内部结构。迭代器模式将遍历逻辑从集合中分离出来，增强了封装性和灵活性。</p>
<p>以下是用 Java
实现迭代器模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="迭代器模式的定义">1. 迭代器模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：通过迭代器对象提供对集合元素的顺序访问，隐藏集合的实现细节。</li>
<li><strong>目的</strong>：
<ul>
<li>统一访问不同类型的集合。</li>
<li>分离集合的遍历逻辑和数据存储。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>需要遍历复杂数据结构（如树、图）。</li>
<li>集合类型多样但需一致访问。</li>
<li>增强集合的封装性。</li>
</ul></li>
</ul>
<hr />
<h4 id="迭代器模式的结构">2. 迭代器模式的结构</h4>
<ul>
<li><strong>抽象迭代器（Iterator）</strong>：定义遍历接口，如
<code>hasNext()</code> 和 <code>next()</code>。</li>
<li><strong>具体迭代器（Concrete
Iterator）</strong>：实现迭代器接口，跟踪遍历位置。</li>
<li><strong>抽象聚合（Aggregate）</strong>：定义创建迭代器的方法。</li>
<li><strong>具体聚合（Concrete
Aggregate）</strong>：实现聚合接口，存储数据并返回迭代器。</li>
<li><strong>客户端（Client）</strong>：使用迭代器遍历集合。</li>
</ul>
<h5 id="mermaid-uml-图-9">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Iterator &#123;
        +hasNext() boolean
        +next() Object
    &#125;
    class ConcreteIterator &#123;
        -aggregate: ConcreteAggregate
        -index: int
        +hasNext() boolean
        +next() Object
    &#125;
    class Aggregate &#123;
        +createIterator() Iterator
    &#125;
    class ConcreteAggregate &#123;
        -items: List
        +createIterator() Iterator
    &#125;
    class Client
    
	ConcreteIterator ..|&gt; Iterator : implements
	ConcreteAggregate ..|&gt; Aggregate : implements
	ConcreteAggregate --&gt; ConcreteIterator : creates
	ConcreteIterator --&gt; ConcreteAggregate : references
	Client --&gt; Iterator : uses
	Client --&gt; Aggregate : uses</code></pre>
<hr />
<h4 id="java-实现示例-14">3. Java 实现示例</h4>
<p>以下是一个简单列表的迭代器模式示例。</p>
<h5 id="抽象迭代器">3.1 抽象迭代器</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象迭代器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Iterator</span> &#123;</span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span>;</span><br><span class="line">    Object <span class="title function_">next</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="抽象聚合">3.2 抽象聚合</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象聚合</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Collection</span> &#123;</span><br><span class="line">    Iterator <span class="title function_">createIterator</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体聚合">3.3 具体聚合</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体聚合：自定义列表</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyList</span> <span class="keyword">implements</span> <span class="title class_">Collection</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String[] items;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyList</span><span class="params">(String[] items)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.items = items;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Iterator <span class="title function_">createIterator</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ListIterator</span>(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items[index];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">size</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> items.length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体迭代器">3.4 具体迭代器</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体迭代器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ListIterator</span> <span class="keyword">implements</span> <span class="title class_">Iterator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> MyList list;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> index;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ListIterator</span><span class="params">(MyList list)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.list = list;</span><br><span class="line">        <span class="built_in">this</span>.index = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasNext</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> index &lt; list.size();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">next</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (hasNext()) &#123;</span><br><span class="line">            <span class="keyword">return</span> list.get(index++);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-14">3.5 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        String[] data = &#123;<span class="string">&quot;Apple&quot;</span>, <span class="string">&quot;Banana&quot;</span>, <span class="string">&quot;Cherry&quot;</span>&#125;;</span><br><span class="line">        <span class="type">MyList</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyList</span>(data);</span><br><span class="line">        <span class="type">Iterator</span> <span class="variable">iterator</span> <span class="operator">=</span> list.createIterator();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            System.out.println(iterator.next());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        输出:</span></span><br><span class="line"><span class="comment">        Apple</span></span><br><span class="line"><span class="comment">        Banana</span></span><br><span class="line"><span class="comment">        Cherry</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-14">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>创建具体聚合（如
<code>MyList</code>）并获取迭代器。</li>
<li>使用迭代器的 <code>hasNext()</code> 和 <code>next()</code>
方法顺序访问元素。</li>
<li>迭代器内部维护遍历状态，隐藏聚合的实现细节。</li>
</ol>
<hr />
<h4 id="优点-14">5. 优点</h4>
<ul>
<li><strong>封装性</strong>：隐藏集合内部结构，保护数据。</li>
<li><strong>统一性</strong>：为不同集合提供一致的遍历接口。</li>
<li><strong>解耦</strong>：分离遍历逻辑和集合实现。</li>
</ul>
<hr />
<h4 id="缺点-14">6. 缺点</h4>
<ul>
<li><strong>复杂度增加</strong>：为简单集合引入迭代器可能显得多余。</li>
<li><strong>功能有限</strong>：标准迭代器不支持修改集合或双向遍历。</li>
<li><strong>性能开销</strong>：动态创建迭代器可能增加少量开销。</li>
</ul>
<hr />
<h4 id="与其他模式的对比-2">7. 与其他模式的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>迭代器模式</th>
<th>访问者模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>目的</strong></td>
<td>顺序访问</td>
<td>操作复杂结构</td>
</tr>
<tr class="even">
<td><strong>关注点</strong></td>
<td>遍历集合</td>
<td>扩展功能</td>
</tr>
<tr class="odd">
<td><strong>控制权</strong></td>
<td>客户端控制遍历</td>
<td>访问者控制操作</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-14">8. 实际应用场景</h4>
<ul>
<li><strong>集合遍历</strong>：Java 集合框架中的
<code>Iterator</code>。</li>
<li><strong>树结构</strong>：遍历树节点。</li>
<li><strong>数据库查询</strong>：结果集迭代。</li>
</ul>
<hr />
<h4 id="源码中的例子-14">9. 源码中的例子</h4>
<p>Java 中的 <code>java.util.Iterator</code>： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = Arrays.asList(<span class="string">&quot;A&quot;</span>, <span class="string">&quot;B&quot;</span>, <span class="string">&quot;C&quot;</span>);</span><br><span class="line">Iterator&lt;String&gt; iterator = list.iterator();</span><br><span class="line"><span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">    System.out.println(iterator.next());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr />
<h4 id="总结-14">10. 总结</h4>
<ul>
<li><strong>迭代器模式</strong>通过分离遍历逻辑提供集合的顺序访问。</li>
<li><strong>Java 实现</strong>依赖接口和具体迭代器，支持灵活遍历。</li>
<li><strong>UML 图</strong>展示了迭代器与聚合的关系。</li>
</ul>
<p>如果需要增强版（如支持 <code>remove()</code> 或双向迭代器）或调整
UML，请告诉我！</p>
<h3 id="中介者mediator"><strong>中介者（Mediator）</strong></h3>
<p>中介者模式（Mediator
Pattern）是一种行为型设计模式，它通过引入一个中介者对象来封装一组对象之间的交互，从而减少对象间的直接耦合。中介者模式将多对多的通信转换为一对多的通信，提升系统的灵活性和可维护性。</p>
<p>以下是用 Java
实现中介者模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="中介者模式的定义">1. 中介者模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：通过中介者协调对象间的通信，降低耦合。</li>
<li><strong>目的</strong>：
<ul>
<li>解耦复杂对象间的直接依赖。</li>
<li>集中管理交互逻辑。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>对象间存在复杂的多对多关系。</li>
<li>需要协调多个组件的行为。</li>
<li>简化对象间的通信。</li>
</ul></li>
</ul>
<hr />
<h4 id="中介者模式的结构">2. 中介者模式的结构</h4>
<ul>
<li><strong>抽象中介者（Mediator）</strong>：定义中介者接口，声明通信方法。</li>
<li><strong>具体中介者（Concrete
Mediator）</strong>：实现中介逻辑，协调同事对象。</li>
<li><strong>抽象同事（Colleague）</strong>：定义同事类的接口，与中介者交互。</li>
<li><strong>具体同事（Concrete
Colleague）</strong>：实现同事接口，通过中介者通信。</li>
<li><strong>客户端（Client）</strong>：创建同事和中介者，发起交互。</li>
</ul>
<h5 id="mermaid-uml-图-10">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Mediator &#123;
        +notify(sender: Colleague, event)
    &#125;
    class ConcreteMediator &#123;
        -colleagueA: ColleagueA
        -colleagueB: ColleagueB
        +notify(sender: Colleague, event)
    &#125;
    class Colleague &#123;
        +send(event)
        +receive(event)
    &#125;
    class ColleagueA &#123;
        -mediator: Mediator
        +send(event)
        +receive(event)
    &#125;
    class ColleagueB &#123;
        -mediator: Mediator
        +send(event)
        +receive(event)
    &#125;
    
    ConcreteMediator ..|&gt; Mediator : implements
    ColleagueA ..|&gt; Colleague : implements
    ColleagueB ..|&gt; Colleague : implements
    ConcreteMediator --&gt; ColleagueA : coordinates
    ConcreteMediator --&gt; ColleagueB : coordinates
    ColleagueA --&gt; Mediator : uses
    ColleagueB --&gt; Mediator : uses</code></pre>
<hr />
<h4 id="java-实现示例-15">3. Java 实现示例</h4>
<p>以下是一个聊天室的中介者模式示例，用户通过中介者发送和接收消息。</p>
<h5 id="抽象中介者">3.1 抽象中介者</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象中介者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ChatMediator</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String message, User sender)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体中介者">3.2 具体中介者</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体中介者：聊天室</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatRoom</span> <span class="keyword">implements</span> <span class="title class_">ChatMediator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        users.add(user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String message, User sender)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            <span class="keyword">if</span> (user != sender) &#123;  <span class="comment">// 不发给自己</span></span><br><span class="line">                user.receive(message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="抽象同事">3.3 抽象同事</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象同事：用户</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">protected</span> ChatMediator mediator;</span><br><span class="line">    <span class="keyword">protected</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(ChatMediator mediator, String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mediator = mediator;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String message)</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体同事">3.4 具体同事</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体同事：普通用户</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ChatUser</span> <span class="keyword">extends</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ChatUser</span><span class="params">(ChatMediator mediator, String name)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(mediator, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(name + <span class="string">&quot; sends: &quot;</span> + message);</span><br><span class="line">        mediator.sendMessage(message, <span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(name + <span class="string">&quot; receives: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-15">3.5 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ChatRoom</span> <span class="variable">chatRoom</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChatRoom</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">User</span> <span class="variable">alice</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChatUser</span>(chatRoom, <span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">bob</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChatUser</span>(chatRoom, <span class="string">&quot;Bob&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">charlie</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ChatUser</span>(chatRoom, <span class="string">&quot;Charlie&quot;</span>);</span><br><span class="line"></span><br><span class="line">        chatRoom.addUser(alice);</span><br><span class="line">        chatRoom.addUser(bob);</span><br><span class="line">        chatRoom.addUser(charlie);</span><br><span class="line"></span><br><span class="line">        alice.send(<span class="string">&quot;Hello everyone!&quot;</span>);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        输出:</span></span><br><span class="line"><span class="comment">        Alice sends: Hello everyone!</span></span><br><span class="line"><span class="comment">        Bob receives: Hello everyone!</span></span><br><span class="line"><span class="comment">        Charlie receives: Hello everyone!</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        bob.send(<span class="string">&quot;Hi Alice!&quot;</span>);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        输出:</span></span><br><span class="line"><span class="comment">        Bob sends: Hi Alice!</span></span><br><span class="line"><span class="comment">        Alice receives: Hi Alice!</span></span><br><span class="line"><span class="comment">        Charlie receives: Hi Alice!</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-15">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>创建中介者和同事对象，注册同事到中介者。</li>
<li>同事通过中介者发送消息（<code>send</code>），中介者协调分发（<code>notify</code>）。</li>
<li>其他同事接收消息（<code>receive</code>），完成通信。</li>
</ol>
<hr />
<h4 id="优点-15">5. 优点</h4>
<ul>
<li><strong>解耦</strong>：减少同事间的直接依赖，降低耦合。</li>
<li><strong>集中控制</strong>：交互逻辑集中在中介者，便于管理。</li>
<li><strong>灵活性</strong>：易于修改通信规则。</li>
</ul>
<hr />
<h4 id="缺点-15">6. 缺点</h4>
<ul>
<li><strong>中介者复杂性</strong>：中介者可能变得臃肿，难以维护。</li>
<li><strong>性能开销</strong>：大量对象交互时，中介者可能成为瓶颈。</li>
<li><strong>单点故障</strong>：中介者失败影响整个系统。</li>
</ul>
<hr />
<h4 id="与观察者模式的对比">7. 与观察者模式的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>中介者模式</th>
<th>观察者模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>通信方式</strong></td>
<td>通过中介者协调</td>
<td>发布-订阅</td>
</tr>
<tr class="even">
<td><strong>耦合</strong></td>
<td>同事依赖中介者</td>
<td>观察者依赖主题</td>
</tr>
<tr class="odd">
<td><strong>控制权</strong></td>
<td>中介者集中控制</td>
<td>主题广播</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-15">8. 实际应用场景</h4>
<ul>
<li><strong>GUI 框架</strong>：控件间通过对话框协调。</li>
<li><strong>聊天系统</strong>：用户通过服务器通信。</li>
<li><strong>航空管制</strong>：飞机通过塔台协调。</li>
</ul>
<hr />
<h4 id="源码中的例子-15">9. 源码中的例子</h4>
<p>Java 中的 <code>java.util.Timer</code>（简化中介者）：
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Timer</span> <span class="variable">timer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Timer</span>();</span><br><span class="line">timer.schedule(<span class="keyword">new</span> <span class="title class_">TimerTask</span>() &#123; <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123; System.out.println(<span class="string">&quot;Task&quot;</span>); &#125; &#125;, <span class="number">1000</span>);</span><br></pre></td></tr></table></figure></p>
<hr />
<h4 id="总结-15">10. 总结</h4>
<ul>
<li><strong>中介者模式</strong>通过中介者封装对象交互，降低耦合。</li>
<li><strong>Java 实现</strong>依赖接口和组合，支持集中管理通信。</li>
<li><strong>UML 图</strong>展示了中介者与同事的关系。</li>
</ul>
<p>如果需要更复杂示例（如支持事件类型）或调整 UML，请告诉我！</p>
<h3 id="备忘录memento"><strong>备忘录（Memento）</strong></h3>
<p>备忘录模式（Memento
Pattern）是一种行为型设计模式，用于捕获并保存对象的内部状态，以便在需要时恢复到该状态，而不破坏对象的封装性。它常用于实现撤销（Undo）功能或状态快照。</p>
<p>以下是用 Java
实现备忘录模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="备忘录模式的定义">1. 备忘录模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：通过备忘录对象保存对象状态，并在需要时恢复。</li>
<li><strong>目的</strong>：
<ul>
<li>保存和恢复对象的状态。</li>
<li>保持封装性，避免暴露内部细节。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>需要撤销或回滚操作。</li>
<li>保存历史状态（如游戏存档）。</li>
<li>状态快照管理。</li>
</ul></li>
</ul>
<hr />
<h4 id="备忘录模式的结构">2. 备忘录模式的结构</h4>
<ul>
<li><strong>原发器（Originator）</strong>：需要保存和恢复状态的对象，创建和使用备忘录。</li>
<li><strong>备忘录（Memento）</strong>：存储原发器状态的对象，通常只提供有限访问。</li>
<li><strong>管理者（Caretaker）</strong>：负责保存备忘录，但不修改其内容。</li>
<li><strong>客户端（Client）</strong>：触发状态保存和恢复。</li>
</ul>
<h5 id="mermaid-uml-图-11">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Originator &#123;
        -state: State
        +createMemento() Memento
        +setMemento(Memento)
        +setState(state)
        +getState() State
    &#125;
    class Memento &#123;
        -state: State
        +getState() State
    &#125;
    class Caretaker &#123;
        -memento: Memento
        +setMemento(Memento)
        +getMemento() Memento
    &#125;
    class Client
    
    Originator --&gt; Memento : creates/uses
    Caretaker --&gt; Memento : holds
    Client --&gt; Originator : uses
    Client --&gt; Caretaker : uses</code></pre>
<hr />
<h4 id="java-实现示例-16">3. Java 实现示例</h4>
<p>以下是一个文本编辑器的备忘录模式示例，支持保存和恢复文本状态。</p>
<h5 id="备忘录类">3.1 备忘录类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 备忘录：保存状态</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Memento</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Memento</span><span class="params">(String state)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getState</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="原发器类">3.2 原发器类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 原发器：文本编辑器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TextEditor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setState</span><span class="params">(String state)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">        System.out.println(<span class="string">&quot;Current state: &quot;</span> + state);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getState</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Memento <span class="title function_">createMemento</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Memento</span>(state);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMemento</span><span class="params">(Memento memento)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = memento.getState();</span><br><span class="line">        System.out.println(<span class="string">&quot;Restored state: &quot;</span> + state);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="管理者类">3.3 管理者类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 管理者：保存备忘录</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">History</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Memento memento;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMemento</span><span class="params">(Memento memento)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.memento = memento;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Memento <span class="title function_">getMemento</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> memento;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-16">3.4 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">TextEditor</span> <span class="variable">editor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TextEditor</span>();</span><br><span class="line">        <span class="type">History</span> <span class="variable">history</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">History</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 设置初始状态</span></span><br><span class="line">        editor.setState(<span class="string">&quot;Hello&quot;</span>);  <span class="comment">// 输出: Current state: Hello</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 保存状态</span></span><br><span class="line">        history.setMemento(editor.createMemento());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 修改状态</span></span><br><span class="line">        editor.setState(<span class="string">&quot;Hello World&quot;</span>);  <span class="comment">// 输出: Current state: Hello World</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 恢复状态</span></span><br><span class="line">        editor.setMemento(history.getMemento());  <span class="comment">// 输出: Restored state: Hello</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-16">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>通过原发器（<code>TextEditor</code>）设置状态。</li>
<li>调用 <code>createMemento()</code>
保存状态到备忘录，交给管理者（<code>History</code>）存储。</li>
<li>修改状态后，通过 <code>setMemento()</code>
从备忘录恢复之前的状态。</li>
</ol>
<hr />
<h4 id="优点-16">5. 优点</h4>
<ul>
<li><strong>封装性</strong>：备忘录隐藏原发器的内部状态。</li>
<li><strong>支持撤销</strong>：方便实现回滚功能。</li>
<li><strong>状态隔离</strong>：管理者不修改备忘录内容。</li>
</ul>
<hr />
<h4 id="缺点-16">6. 缺点</h4>
<ul>
<li><strong>内存开销</strong>：保存大量状态可能消耗内存。</li>
<li><strong>复杂度</strong>：增加备忘录和管理类，提高系统复杂性。</li>
<li><strong>状态管理</strong>：多状态时需额外设计存储结构。</li>
</ul>
<hr />
<h4 id="与命令模式的对比">7. 与命令模式的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>备忘录模式</th>
<th>命令模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>目的</strong></td>
<td>保存/恢复状态</td>
<td>封装请求</td>
</tr>
<tr class="even">
<td><strong>关注点</strong></td>
<td>状态管理</td>
<td>操作执行</td>
</tr>
<tr class="odd">
<td><strong>撤销</strong></td>
<td>通过状态恢复</td>
<td>通过命令回滚</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-16">8. 实际应用场景</h4>
<ul>
<li><strong>文本编辑器</strong>：撤销和重做功能。</li>
<li><strong>游戏</strong>：保存和加载游戏进度。</li>
<li><strong>数据库</strong>：事务回滚。</li>
</ul>
<hr />
<h4 id="源码中的例子-16">9. 源码中的例子</h4>
<p>Java 中的 <code>java.util.Date</code>（简化备忘录思想）：
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Date</span> <span class="variable">date</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Date</span>();</span><br><span class="line"><span class="type">long</span> <span class="variable">time</span> <span class="operator">=</span> date.getTime();  <span class="comment">// 保存状态</span></span><br><span class="line">date.setTime(time);  <span class="comment">// 恢复状态</span></span><br></pre></td></tr></table></figure></p>
<hr />
<h4 id="总结-16">10. 总结</h4>
<ul>
<li><strong>备忘录模式</strong>通过备忘录保存和恢复对象状态，支持撤销。</li>
<li><strong>Java
实现</strong>依赖原发器创建和使用备忘录，管理者存储。</li>
<li><strong>UML 图</strong>展示了原发器、备忘录和管理者的关系。</li>
</ul>
<p>如果需要多状态管理示例（如历史记录列表）或调整 UML，请告诉我！</p>
<h3 id="观察者observer"><strong>观察者（Observer）</strong></h3>
<p>观察者模式（Observer
Pattern）是一种行为型设计模式，它定义了对象之间的一对多依赖关系，使得当一个对象的状态发生变化时，所有依赖它的对象都会自动收到通知并更新。观察者模式也被称为“发布-订阅模式”，广泛用于事件处理和状态监控。</p>
<p>以下是用 Java
实现观察者模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="观察者模式的定义">1. 观察者模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：通过主题（Subject）维护观察者（Observer）列表，当主题状态变化时通知所有观察者。</li>
<li><strong>目的</strong>：
<ul>
<li>解耦主体和依赖对象。</li>
<li>实现状态变化的自动广播。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>事件监听（如 GUI 按钮点击）。</li>
<li>数据变化通知（如股票价格）。</li>
<li>发布-订阅系统。</li>
</ul></li>
</ul>
<hr />
<h4 id="观察者模式的结构">2. 观察者模式的结构</h4>
<ul>
<li><strong>抽象主题（Subject）</strong>：维护观察者列表，提供添加、移除和通知方法。</li>
<li><strong>具体主题（Concrete
Subject）</strong>：实现主题接口，存储状态并触发通知。</li>
<li><strong>抽象观察者（Observer）</strong>：定义更新接口。</li>
<li><strong>具体观察者（Concrete
Observer）</strong>：实现更新逻辑，响应主题变化。</li>
<li><strong>客户端（Client）</strong>：创建主题和观察者，发起交互。</li>
</ul>
<h5 id="mermaid-uml-图-12">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Subject &#123;
        +attach(Observer)
        +detach(Observer)
        +notify()
    &#125;
    class ConcreteSubject &#123;
        -state: State
        -observers: List&lt;Observer&gt;
        +attach(Observer)
        +detach(Observer)
        +notify()
        +setState(state)
        +getState() State
    &#125;
    class Observer &#123;
        +update()
    &#125;
    class ConcreteObserver &#123;
        -subject: Subject
        +update()
    &#125;
    
    ConcreteSubject ..|&gt; Subject : implements
    ConcreteObserver ..|&gt; Observer : implements
    ConcreteSubject o--&gt; &quot;many&quot; Observer : notifies
    ConcreteObserver --&gt; Subject : observes</code></pre>
<hr />
<h4 id="java-实现示例-17">3. Java 实现示例</h4>
<p>以下是一个天气站的观察者模式示例，天气变化时通知显示器。</p>
<h5 id="抽象观察者">3.1 抽象观察者</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象观察者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">float</span> temperature)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="抽象主题-1">3.2 抽象主题</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象主题</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">WeatherStation</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">addObserver</span><span class="params">(Observer observer)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">removeObserver</span><span class="params">(Observer observer)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">notifyObservers</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体主题">3.3 具体主题</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体主题：天气站</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcreteWeatherStation</span> <span class="keyword">implements</span> <span class="title class_">WeatherStation</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Observer&gt; observers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> temperature;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addObserver</span><span class="params">(Observer observer)</span> &#123;</span><br><span class="line">        observers.add(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">removeObserver</span><span class="params">(Observer observer)</span> &#123;</span><br><span class="line">        observers.remove(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">notifyObservers</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (Observer observer : observers) &#123;</span><br><span class="line">            observer.update(temperature);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTemperature</span><span class="params">(<span class="type">float</span> temperature)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.temperature = temperature;</span><br><span class="line">        System.out.println(<span class="string">&quot;Temperature changed to: &quot;</span> + temperature);</span><br><span class="line">        notifyObservers();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体观察者">3.4 具体观察者</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体观察者：温度显示器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TemperatureDisplay</span> <span class="keyword">implements</span> <span class="title class_">Observer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">TemperatureDisplay</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">float</span> temperature)</span> &#123;</span><br><span class="line">        System.out.println(name + <span class="string">&quot; displays temperature: &quot;</span> + temperature);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-17">3.5 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ConcreteWeatherStation</span> <span class="variable">station</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConcreteWeatherStation</span>();</span><br><span class="line"></span><br><span class="line">        <span class="type">Observer</span> <span class="variable">display1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemperatureDisplay</span>(<span class="string">&quot;Display 1&quot;</span>);</span><br><span class="line">        <span class="type">Observer</span> <span class="variable">display2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">TemperatureDisplay</span>(<span class="string">&quot;Display 2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        station.addObserver(display1);</span><br><span class="line">        station.addObserver(display2);</span><br><span class="line"></span><br><span class="line">        station.setTemperature(<span class="number">25.0f</span>);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        输出:</span></span><br><span class="line"><span class="comment">        Temperature changed to: 25.0</span></span><br><span class="line"><span class="comment">        Display 1 displays temperature: 25.0</span></span><br><span class="line"><span class="comment">        Display 2 displays temperature: 25.0</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        station.setTemperature(<span class="number">30.0f</span>);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        输出:</span></span><br><span class="line"><span class="comment">        Temperature changed to: 30.0</span></span><br><span class="line"><span class="comment">        Display 1 displays temperature: 30.0</span></span><br><span class="line"><span class="comment">        Display 2 displays temperature: 30.0</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-17">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>创建主题和观察者，将观察者注册到主题。</li>
<li>主题状态变化（<code>setTemperature</code>）时，调用
<code>notifyObservers</code>。</li>
<li>所有观察者收到通知，执行 <code>update</code> 更新状态。</li>
</ol>
<hr />
<h4 id="优点-17">5. 优点</h4>
<ul>
<li><strong>解耦</strong>：主题和观察者松耦合，仅通过接口交互。</li>
<li><strong>动态性</strong>：支持运行时添加或移除观察者。</li>
<li><strong>广播</strong>：自动通知所有依赖对象。</li>
</ul>
<hr />
<h4 id="缺点-17">6. 缺点</h4>
<ul>
<li><strong>性能开销</strong>：大量观察者时通知可能变慢。</li>
<li><strong>内存泄漏</strong>：未移除的观察者可能导致引用残留。</li>
<li><strong>复杂性</strong>：多观察者时调试困难。</li>
</ul>
<hr />
<h4 id="与中介者模式的对比">7. 与中介者模式的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>观察者模式</th>
<th>中介者模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>通信方式</strong></td>
<td>广播</td>
<td>协调</td>
</tr>
<tr class="even">
<td><strong>耦合</strong></td>
<td>观察者依赖主题</td>
<td>同事依赖中介者</td>
</tr>
<tr class="odd">
<td><strong>控制权</strong></td>
<td>主题主动通知</td>
<td>中介者集中控制</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-17">8. 实际应用场景</h4>
<ul>
<li><strong>GUI 事件</strong>：按钮点击通知监听器。</li>
<li><strong>数据绑定</strong>：视图随模型变化更新。</li>
<li><strong>消息系统</strong>：发布-订阅模型。</li>
</ul>
<hr />
<h4 id="源码中的例子-17">9. 源码中的例子</h4>
<p>Java 中的 <code>java.util.Observable</code> 和
<code>Observer</code>（已废弃，但为经典示例）： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Observable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Weather</span> <span class="keyword">extends</span> <span class="title class_">Observable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">float</span> temp;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setTemp</span><span class="params">(<span class="type">float</span> temp)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.temp = temp;</span><br><span class="line">        setChanged();</span><br><span class="line">        notifyObservers(temp);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Display</span> <span class="keyword">implements</span> <span class="title class_">java</span>.util.Observer &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(Observable o, Object arg)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Temperature: &quot;</span> + arg);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Weather</span> <span class="variable">weather</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Weather</span>();</span><br><span class="line">        weather.addObserver(<span class="keyword">new</span> <span class="title class_">Display</span>());</span><br><span class="line">        weather.setTemp(<span class="number">25.0f</span>);  <span class="comment">// 输出: Temperature: 25.0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>现代替代：<code>java.beans.PropertyChangeSupport</code>。</p>
<hr />
<h4 id="总结-17">10. 总结</h4>
<ul>
<li><strong>观察者模式</strong>通过主题广播状态变化，解耦依赖关系。</li>
<li><strong>Java 实现</strong>依赖接口和列表管理，支持动态通知。</li>
<li><strong>UML 图</strong>展示了主题与观察者的一对多关系。</li>
</ul>
<p>如果需要推模式（推送数据）与拉模式（观察者拉取）的对比或调整
UML，请告诉我！</p>
<h3 id="状态state"><strong>状态（State）</strong></h3>
<p>状态模式（State
Pattern）是一种行为型设计模式，它允许对象在内部状态发生变化时改变其行为，使对象看起来像是改变了其类。状态模式通过将状态封装为独立的对象，简化复杂条件逻辑，提高代码的可维护性和扩展性。</p>
<p>以下是用 Java
实现状态模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="状态模式的定义">1. 状态模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：将状态抽象为对象，对象根据状态切换行为。</li>
<li><strong>目的</strong>：
<ul>
<li>消除大量条件语句（如 if-else）。</li>
<li>使状态转换逻辑清晰且可扩展。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>对象行为随状态变化。</li>
<li>状态转换规则复杂。</li>
<li>需要状态机（如订单流程）。</li>
</ul></li>
</ul>
<hr />
<h4 id="状态模式的结构">2. 状态模式的结构</h4>
<ul>
<li><strong>上下文（Context）</strong>：持有当前状态，委托行为给状态对象。</li>
<li><strong>抽象状态（State）</strong>：定义状态接口，声明行为方法。</li>
<li><strong>具体状态（Concrete
State）</strong>：实现状态接口，定义具体行为并处理状态转换。</li>
<li><strong>客户端（Client）</strong>：创建上下文并触发操作。</li>
</ul>
<h5 id="mermaid-uml-图-13">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Context &#123;
        -state: State
        +setState(State)
        +request()
    &#125;
    class State &#123;
        +handle(Context)
    &#125;
    class ConcreteStateA &#123;
        +handle(Context)
    &#125;
    class ConcreteStateB &#123;
        +handle(Context)
    &#125;
    
    ConcreteStateA ..|&gt; State : implements
    ConcreteStateB ..|&gt; State : implements
    Context --&gt; State : uses
    ConcreteStateA --&gt; Context : changes state
    ConcreteStateB --&gt; Context : changes state</code></pre>
<hr />
<h4 id="java-实现示例-18">3. Java 实现示例</h4>
<p>以下是一个订单状态机的状态模式示例，订单状态在待支付、已支付和已发货之间切换。</p>
<h5 id="抽象状态">3.1 抽象状态</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象状态</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">OrderState</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Order order)</span>;  <span class="comment">// 处理订单</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体状态">3.2 具体状态</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体状态：待支付</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PendingState</span> <span class="keyword">implements</span> <span class="title class_">OrderState</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Order is pending payment&quot;</span>);</span><br><span class="line">        order.setState(<span class="keyword">new</span> <span class="title class_">PaidState</span>());  <span class="comment">// 转换为已支付</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态：已支付</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaidState</span> <span class="keyword">implements</span> <span class="title class_">OrderState</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Order has been paid&quot;</span>);</span><br><span class="line">        order.setState(<span class="keyword">new</span> <span class="title class_">ShippedState</span>());  <span class="comment">// 转换为已发货</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体状态：已发货</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShippedState</span> <span class="keyword">implements</span> <span class="title class_">OrderState</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">handle</span><span class="params">(Order order)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Order has been shipped&quot;</span>);</span><br><span class="line">        <span class="comment">// 不再转换状态</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="上下文">3.3 上下文</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上下文：订单</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Order</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> OrderState state;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Order</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = <span class="keyword">new</span> <span class="title class_">PendingState</span>();  <span class="comment">// 初始状态</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setState</span><span class="params">(OrderState state)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.state = state;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">process</span><span class="params">()</span> &#123;</span><br><span class="line">        state.handle(<span class="built_in">this</span>);  <span class="comment">// 委托给当前状态</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-18">3.4 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Order</span> <span class="variable">order</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Order</span>();</span><br><span class="line"></span><br><span class="line">        order.process();  <span class="comment">// 输出: Order is pending payment</span></span><br><span class="line">        order.process();  <span class="comment">// 输出: Order has been paid</span></span><br><span class="line">        order.process();  <span class="comment">// 输出: Order has been shipped</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-18">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>创建上下文（<code>Order</code>），初始状态为
<code>PendingState</code>。</li>
<li>调用 <code>process()</code>，上下文委托给当前状态对象执行。</li>
<li>状态对象处理请求并可切换上下文的状态（如从 <code>Pending</code> 到
<code>Paid</code>）。</li>
</ol>
<hr />
<h4 id="优点-18">5. 优点</h4>
<ul>
<li><strong>清晰性</strong>：状态逻辑封装在独立类中，减少条件分支。</li>
<li><strong>扩展性</strong>：新增状态只需添加新类。</li>
<li><strong>符合开闭原则</strong>：修改行为不需更改上下文。</li>
</ul>
<hr />
<h4 id="缺点-18">6. 缺点</h4>
<ul>
<li><strong>类数量增加</strong>：每个状态需定义新类。</li>
<li><strong>复杂度</strong>：小型系统使用状态模式可能显得繁琐。</li>
<li><strong>状态切换管理</strong>：转换逻辑分散在状态类中，可能难跟踪。</li>
</ul>
<hr />
<h4 id="与策略模式的对比-1">7. 与策略模式的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>状态模式</th>
<th>策略模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>目的</strong></td>
<td>状态驱动行为</td>
<td>算法选择</td>
</tr>
<tr class="even">
<td><strong>切换</strong></td>
<td>状态内部控制</td>
<td>客户端控制</td>
</tr>
<tr class="odd">
<td><strong>关注点</strong></td>
<td>状态转换</td>
<td>行为替换</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-18">8. 实际应用场景</h4>
<ul>
<li><strong>订单系统</strong>：状态流转（如待支付 → 已支付）。</li>
<li><strong>游戏角色</strong>：角色状态（如站立、行走、跳跃）。</li>
<li><strong>有限状态机</strong>：网络协议状态管理。</li>
</ul>
<hr />
<h4 id="源码中的例子-18">9. 源码中的例子</h4>
<p>Java 中的 <code>java.nio.channels.SelectionKey</code>（状态相关）：
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SelectionKey</span> <span class="variable">key</span> <span class="operator">=</span> channel.register(selector, SelectionKey.OP_READ);</span><br><span class="line"><span class="comment">// 根据状态执行不同操作</span></span><br></pre></td></tr></table></figure></p>
<hr />
<h4 id="总结-18">10. 总结</h4>
<ul>
<li><strong>状态模式</strong>通过状态对象改变行为，简化状态管理。</li>
<li><strong>Java 实现</strong>依赖接口和状态切换，支持动态行为。</li>
<li><strong>UML 图</strong>展示了上下文与状态的关系。</li>
</ul>
<p>如果需要复杂状态机（如带条件转换）或调整 UML，请告诉我！</p>
<h3 id="策略strategy"><strong>策略（Strategy）</strong></h3>
<p>策略模式（Strategy
Pattern）是一种行为型设计模式，它定义了一系列算法或策略，将每个策略封装成独立的对象，使得这些策略可以在运行时动态切换。策略模式通过解耦上下文和具体策略，增强了代码的灵活性和可扩展性。</p>
<p>以下是用 Java
实现策略模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="策略模式的定义">1. 策略模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：将算法或行为封装为策略对象，上下文根据需要选择策略。</li>
<li><strong>目的</strong>：
<ul>
<li>消除条件语句（如 if-else）。</li>
<li>支持运行时动态替换行为。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>多个类似行为需动态选择。</li>
<li>算法或策略可能频繁变化。</li>
<li>需要隔离具体实现。</li>
</ul></li>
</ul>
<hr />
<h4 id="策略模式的结构">2. 策略模式的结构</h4>
<ul>
<li><strong>抽象策略（Strategy）</strong>：定义策略接口，声明行为方法。</li>
<li><strong>具体策略（Concrete
Strategy）</strong>：实现策略接口，提供具体算法。</li>
<li><strong>上下文（Context）</strong>：持有策略引用，调用策略执行行为。</li>
<li><strong>客户端（Client）</strong>：创建上下文并配置策略。</li>
</ul>
<h4 id="mermaid-uml-图-14"># Mermaid UML 图</h4>
<pre><code class="highlight mermaid">classDiagram
    class Strategy &#123;
        +execute()
    &#125;
    class ConcreteStrategyA &#123;
        +execute()
    &#125;
    class ConcreteStrategyB &#123;
        +execute()
    &#125;
    class Context &#123;
        -strategy: Strategy
        +setStrategy(Strategy)
        +executeStrategy()
    &#125;
    class Client
    
    ConcreteStrategyA ..|&gt; Strategy : implements
    ConcreteStrategyB ..|&gt; Strategy : implements
    Context --&gt; Strategy : uses
    Client --&gt; Context : uses
    Client --&gt; Strategy : configures</code></pre>
<hr />
<h4 id="java-实现示例-19">3. Java 实现示例</h4>
<p>以下是一个支付系统的策略模式示例，支持不同支付方式。</p>
<h4 id="抽象策略"># 3.1 抽象策略</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象策略：支付方式</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">double</span> amount)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="具体策略"># 3.2 具体策略</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体策略：信用卡支付</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CreditCardPayment</span> <span class="keyword">implements</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String cardNumber;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CreditCardPayment</span><span class="params">(String cardNumber)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.cardNumber = cardNumber;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Paid &quot;</span> + amount + <span class="string">&quot; with credit card &quot;</span> + cardNumber);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体策略：PayPal 支付</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayPalPayment</span> <span class="keyword">implements</span> <span class="title class_">PaymentStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">PayPalPayment</span><span class="params">(String email)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.email = email;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Paid &quot;</span> + amount + <span class="string">&quot; with PayPal &quot;</span> + email);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="上下文-1"># 3.3 上下文</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 上下文：购物车</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ShoppingCart</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> PaymentStrategy paymentStrategy;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setPaymentStrategy</span><span class="params">(PaymentStrategy paymentStrategy)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.paymentStrategy = paymentStrategy;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">checkout</span><span class="params">(<span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (paymentStrategy != <span class="literal">null</span>) &#123;</span><br><span class="line">            paymentStrategy.pay(amount);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;No payment strategy selected&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="客户端代码-19"># 3.4 客户端代码</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ShoppingCart</span> <span class="variable">cart</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ShoppingCart</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 使用信用卡支付</span></span><br><span class="line">        <span class="type">PaymentStrategy</span> <span class="variable">creditCard</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CreditCardPayment</span>(<span class="string">&quot;1234-5678-9012-3456&quot;</span>);</span><br><span class="line">        cart.setPaymentStrategy(creditCard);</span><br><span class="line">        cart.checkout(<span class="number">100.0</span>);  <span class="comment">// 输出: Paid 100.0 with credit card 1234-5678-9012-3456</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 切换到 PayPal 支付</span></span><br><span class="line">        <span class="type">PaymentStrategy</span> <span class="variable">payPal</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PayPalPayment</span>(<span class="string">&quot;user@example.com&quot;</span>);</span><br><span class="line">        cart.setPaymentStrategy(payPal);</span><br><span class="line">        cart.checkout(<span class="number">50.0</span>);  <span class="comment">// 输出: Paid 50.0 with PayPal user@example.com</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-19">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>创建上下文（<code>ShoppingCart</code>）和策略（如
<code>CreditCardPayment</code>）。</li>
<li>将策略注入上下文（<code>setPaymentStrategy</code>）。</li>
<li>调用上下文方法（<code>checkout</code>），执行当前策略的行为。</li>
</ol>
<hr />
<h4 id="优点-19">5. 优点</h4>
<ul>
<li><strong>灵活性</strong>：运行时动态切换策略。</li>
<li><strong>扩展性</strong>：新增策略只需添加新类。</li>
<li><strong>消除条件</strong>：避免大量 if-else 语句。</li>
</ul>
<hr />
<h4 id="缺点-19">6. 缺点</h4>
<ul>
<li><strong>类数量增加</strong>：每个策略需定义新类。</li>
<li><strong>客户端复杂性</strong>：客户端需了解并选择策略。</li>
<li><strong>适用性有限</strong>：适合行为差异明显的情况。</li>
</ul>
<hr />
<h4 id="与状态模式的对比">7. 与状态模式的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>策略模式</th>
<th>状态模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>目的</strong></td>
<td>算法选择</td>
<td>状态驱动行为</td>
</tr>
<tr class="even">
<td><strong>切换控制</strong></td>
<td>客户端控制</td>
<td>状态内部控制</td>
</tr>
<tr class="odd">
<td><strong>关注点</strong></td>
<td>行为替换</td>
<td>状态转换</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-19">8. 实际应用场景</h4>
<ul>
<li><strong>排序算法</strong>：选择不同排序策略（如快排、冒泡）。</li>
<li><strong>支付系统</strong>：动态选择支付方式。</li>
<li><strong>游戏 AI</strong>：切换敌人行为策略。</li>
</ul>
<hr />
<h4 id="源码中的例子-19">9. 源码中的例子</h4>
<p>Java 中的 <code>Comparator</code>： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = Arrays.asList(<span class="string">&quot;b&quot;</span>, <span class="string">&quot;a&quot;</span>, <span class="string">&quot;c&quot;</span>);</span><br><span class="line">Collections.sort(list, Comparator.naturalOrder());  <span class="comment">// 自然顺序策略</span></span><br><span class="line">Collections.sort(list, Comparator.reverseOrder());  <span class="comment">// 逆序策略</span></span><br></pre></td></tr></table></figure></p>
<hr />
<h4 id="总结-19">10. 总结</h4>
<ul>
<li><strong>策略模式</strong>通过封装策略对象实现行为动态切换。</li>
<li><strong>Java 实现</strong>依赖接口和组合，支持灵活替换。</li>
<li><strong>UML 图</strong>展示了上下文与策略的关系。</li>
</ul>
<p>如果需要更复杂示例（如结合工厂模式）或调整 UML，请告诉我！</p>
<h3 id="模板方法template-method"><strong>模板方法（Template
Method）</strong></h3>
<p>模板方法模式（Template Method
Pattern）是一种行为型设计模式，它在抽象类中定义了一个操作的算法骨架，将某些步骤的具体实现推迟到子类中。模板方法模式通过固定的流程控制和灵活的实现分离，实现了代码复用和行为定制。</p>
<p>以下是用 Java
实现模板方法模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="模板方法模式的定义">1. 模板方法模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：在抽象类中定义算法框架，子类实现具体步骤。</li>
<li><strong>目的</strong>：
<ul>
<li>复用通用算法结构。</li>
<li>允许子类定制部分行为。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>多个类共享固定流程但细节不同。</li>
<li>需要控制算法执行顺序。</li>
<li>提取公共代码。</li>
</ul></li>
</ul>
<hr />
<h4 id="模板方法模式的结构">2. 模板方法模式的结构</h4>
<ul>
<li><strong>抽象类（Abstract
Class）</strong>：定义模板方法（算法骨架）和抽象步骤。</li>
<li><strong>具体类（Concrete
Class）</strong>：实现抽象步骤，完成具体逻辑。</li>
<li><strong>客户端（Client）</strong>：调用模板方法执行算法。</li>
</ul>
<h5 id="mermaid-uml-图-15">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class AbstractClass &#123;
        +templateMethod()
        #abstractStep1()
        #abstractStep2()
        +concreteStep()
    &#125;
    class ConcreteClass &#123;
        #abstractStep1()
        #abstractStep2()
    &#125;
    class Client
    
    ConcreteClass --|&gt; AbstractClass : extends
    Client --&gt; AbstractClass : uses</code></pre>
<hr />
<h4 id="java-实现示例-20">3. Java 实现示例</h4>
<p>以下是一个制作饮料的模板方法模式示例，流程固定但配方不同。</p>
<h5 id="抽象类">3.1 抽象类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象类：饮料制作</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">Beverage</span> &#123;</span><br><span class="line">    <span class="comment">// 模板方法：定义制作流程</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">prepareBeverage</span><span class="params">()</span> &#123;</span><br><span class="line">        boilWater();       <span class="comment">// 固定步骤</span></span><br><span class="line">        brew();            <span class="comment">// 抽象步骤，由子类实现</span></span><br><span class="line">        pourInCup();       <span class="comment">// 固定步骤</span></span><br><span class="line">        <span class="keyword">if</span> (customerWantsCondiments()) &#123;  <span class="comment">// 钩子方法</span></span><br><span class="line">            addCondiments();  <span class="comment">// 抽象步骤</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 固定步骤</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">boilWater</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Boiling water&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">pourInCup</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Pouring into cup&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 抽象步骤</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">brew</span><span class="params">()</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title function_">addCondiments</span><span class="params">()</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 钩子方法（可选步骤）</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">customerWantsCondiments</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;  <span class="comment">// 默认添加调料</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体类">3.2 具体类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体类：咖啡</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Coffee</span> <span class="keyword">extends</span> <span class="title class_">Beverage</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">brew</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Brewing coffee grounds&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addCondiments</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Adding sugar and milk&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体类：茶</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Tea</span> <span class="keyword">extends</span> <span class="title class_">Beverage</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">brew</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Steeping tea leaves&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">addCondiments</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Adding lemon&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">customerWantsCondiments</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;  <span class="comment">// 茶默认不加调料</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-20">3.3 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Beverage</span> <span class="variable">coffee</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Coffee</span>();</span><br><span class="line">        System.out.println(<span class="string">&quot;Making coffee:&quot;</span>);</span><br><span class="line">        coffee.prepareBeverage();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        输出:</span></span><br><span class="line"><span class="comment">        Making coffee:</span></span><br><span class="line"><span class="comment">        Boiling water</span></span><br><span class="line"><span class="comment">        Brewing coffee grounds</span></span><br><span class="line"><span class="comment">        Pouring into cup</span></span><br><span class="line"><span class="comment">        Adding sugar and milk</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        <span class="type">Beverage</span> <span class="variable">tea</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Tea</span>();</span><br><span class="line">        System.out.println(<span class="string">&quot;\nMaking tea:&quot;</span>);</span><br><span class="line">        tea.prepareBeverage();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        输出:</span></span><br><span class="line"><span class="comment">        Making tea:</span></span><br><span class="line"><span class="comment">        Boiling water</span></span><br><span class="line"><span class="comment">        Steeping tea leaves</span></span><br><span class="line"><span class="comment">        Pouring into cup</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-20">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>创建具体类实例（如 <code>Coffee</code> 或
<code>Tea</code>）。</li>
<li>调用模板方法（<code>prepareBeverage</code>），执行固定流程。</li>
<li>子类实现抽象步骤（<code>brew</code> 和
<code>addCondiments</code>），定制行为。</li>
</ol>
<hr />
<h4 id="优点-20">5. 优点</h4>
<ul>
<li><strong>代码复用</strong>：通用流程在抽象类中定义，避免重复。</li>
<li><strong>控制性</strong>：模板方法控制算法顺序，子类只实现细节。</li>
<li><strong>扩展性</strong>：新增行为只需添加子类。</li>
</ul>
<hr />
<h4 id="缺点-20">6. 缺点</h4>
<ul>
<li><strong>类数量增加</strong>：每个新行为需定义新子类。</li>
<li><strong>继承依赖</strong>：子类必须继承抽象类，灵活性受限。</li>
<li><strong>复杂性</strong>：大型系统可能导致继承层次深。</li>
</ul>
<hr />
<h4 id="与策略模式的对比-2">7. 与策略模式的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>模板方法模式</th>
<th>策略模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>实现方式</strong></td>
<td>继承</td>
<td>组合</td>
</tr>
<tr class="even">
<td><strong>控制权</strong></td>
<td>抽象类控制流程</td>
<td>客户端选择策略</td>
</tr>
<tr class="odd">
<td><strong>灵活性</strong></td>
<td>固定流程</td>
<td>动态切换</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-20">8. 实际应用场景</h4>
<ul>
<li><strong>Servlet</strong>：<code>HttpServlet</code> 的
<code>service</code> 方法。</li>
<li><strong>游戏流程</strong>：固定游戏循环，子类实现细节。</li>
<li><strong>数据处理</strong>：通用处理框架，子类定制步骤。</li>
</ul>
<hr />
<h4 id="源码中的例子-20">9. 源码中的例子</h4>
<p>Java 中的 <code>AbstractList</code>： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AbstractList</span>&lt;E&gt; <span class="keyword">extends</span> <span class="title class_">AbstractCollection</span>&lt;E&gt; &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> index, E element)</span> &#123;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">UnsupportedOperationException</span>();  <span class="comment">// 子类实现</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure> - 子类如
<code>ArrayList</code> 实现具体逻辑。</p>
<hr />
<h4 id="总结-20">10. 总结</h4>
<ul>
<li><strong>模板方法模式</strong>通过抽象类定义算法框架，子类实现细节。</li>
<li><strong>Java 实现</strong>结合继承和抽象方法，支持行为定制。</li>
<li><strong>UML 图</strong>展示了抽象类与具体类的关系。</li>
</ul>
<p>如果需要更复杂示例（如带钩子方法的多步骤流程）或调整
UML，请告诉我！</p>
<h3 id="访问者visitor"><strong>访问者（Visitor）</strong></h3>
<p>访问者模式（Visitor
Pattern）是一种行为型设计模式，它允许在不修改对象结构的情况下，为对象添加新的操作。访问者模式通过将操作逻辑分离到访问者对象中，实现了数据结构与操作的解耦，特别适用于结构稳定但操作频繁变化的场景。</p>
<p>以下是用 Java
实现访问者模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="访问者模式的定义">1. 访问者模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：将操作封装到访问者对象中，对象结构接受访问者并调用其操作。</li>
<li><strong>目的</strong>：
<ul>
<li>分离数据结构与操作逻辑。</li>
<li>支持动态添加新功能。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>对象结构稳定但操作多变。</li>
<li>需要对复杂对象执行多种操作。</li>
<li>数据结构与操作独立演化。</li>
</ul></li>
</ul>
<hr />
<h4 id="访问者模式的结构">2. 访问者模式的结构</h4>
<ul>
<li><strong>抽象访问者（Visitor）</strong>：定义对每个元素类的访问方法。</li>
<li><strong>具体访问者（Concrete Visitor）</strong>：实现访问逻辑。</li>
<li><strong>抽象元素（Element）</strong>：定义接受访问者的方法。</li>
<li><strong>具体元素（Concrete
Element）</strong>：实现接受方法，调用访问者操作。</li>
<li><strong>对象结构（Object
Structure）</strong>：包含元素集合，允许访问者遍历。</li>
<li><strong>客户端（Client）</strong>：创建结构和访问者，发起访问。</li>
</ul>
<h5 id="mermaid-uml-图-16">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Visitor &#123;
        +visitElementA(ElementA)
        +visitElementB(ElementB)
    &#125;
    class ConcreteVisitor &#123;
        +visitElementA(ElementA)
        +visitElementB(ElementB)
    &#125;
    class Element &#123;
        +accept(Visitor)
    &#125;
    class ElementA &#123;
        +accept(Visitor)
    &#125;
    class ElementB &#123;
        +accept(Visitor)
    &#125;
    class ObjectStructure &#123;
        -elements: List&lt;Element&gt;
        +accept(Visitor)
    &#125;
    class Client
    
    ConcreteVisitor ..|&gt; Visitor : implements
    ElementA ..|&gt; Element : implements
    ElementB ..|&gt; Element : implements
    ObjectStructure o--&gt; &quot;many&quot; Element : contains
    Element --&gt; Visitor : accepts
    Client --&gt; ObjectStructure : uses
    Client --&gt; Visitor : uses</code></pre>
<hr />
<h4 id="java-实现示例-21">3. Java 实现示例</h4>
<p>以下是一个计算文件大小的访问者模式示例，访问文件和文件夹。</p>
<h5 id="抽象元素">3.1 抽象元素</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象元素</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FileSystemElement</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(FileSystemVisitor visitor)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体元素">3.2 具体元素</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体元素：文件</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">File</span> <span class="keyword">implements</span> <span class="title class_">FileSystemElement</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> size;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">File</span><span class="params">(String name, <span class="type">int</span> size)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">        <span class="built_in">this</span>.size = size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getSize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> size;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(FileSystemVisitor visitor)</span> &#123;</span><br><span class="line">        visitor.visit(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体元素：文件夹</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Folder</span> <span class="keyword">implements</span> <span class="title class_">FileSystemElement</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> List&lt;FileSystemElement&gt; children = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Folder</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(FileSystemElement element)</span> &#123;</span><br><span class="line">        children.add(element);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;FileSystemElement&gt; <span class="title function_">getChildren</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> children;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(FileSystemVisitor visitor)</span> &#123;</span><br><span class="line">        visitor.visit(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="抽象访问者">3.3 抽象访问者</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 抽象访问者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">FileSystemVisitor</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(File file)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(Folder folder)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体访问者">3.4 具体访问者</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体访问者：计算大小</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SizeCalculatorVisitor</span> <span class="keyword">implements</span> <span class="title class_">FileSystemVisitor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">totalSize</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(File file)</span> &#123;</span><br><span class="line">        totalSize += file.getSize();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(Folder folder)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (FileSystemElement element : folder.getChildren()) &#123;</span><br><span class="line">            element.accept(<span class="built_in">this</span>);  <span class="comment">// 递归访问子元素</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getTotalSize</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> totalSize;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="对象结构可选">3.5 对象结构（可选）</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 对象结构</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileSystem</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;FileSystemElement&gt; elements = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addElement</span><span class="params">(FileSystemElement element)</span> &#123;</span><br><span class="line">        elements.add(element);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">accept</span><span class="params">(FileSystemVisitor visitor)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (FileSystemElement element : elements) &#123;</span><br><span class="line">            element.accept(visitor);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-21">3.6 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">file1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;doc1.txt&quot;</span>, <span class="number">100</span>);</span><br><span class="line">        <span class="type">File</span> <span class="variable">file2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;doc2.txt&quot;</span>, <span class="number">200</span>);</span><br><span class="line">        <span class="type">Folder</span> <span class="variable">folder</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Folder</span>(<span class="string">&quot;Documents&quot;</span>);</span><br><span class="line">        folder.add(file1);</span><br><span class="line">        folder.add(file2);</span><br><span class="line"></span><br><span class="line">        <span class="type">FileSystem</span> <span class="variable">fileSystem</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileSystem</span>();</span><br><span class="line">        fileSystem.addElement(folder);</span><br><span class="line"></span><br><span class="line">        <span class="type">SizeCalculatorVisitor</span> <span class="variable">sizeVisitor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SizeCalculatorVisitor</span>();</span><br><span class="line">        fileSystem.accept(sizeVisitor);</span><br><span class="line">        System.out.println(<span class="string">&quot;Total size: &quot;</span> + sizeVisitor.getTotalSize());  <span class="comment">// 输出: Total size: 300</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-21">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>创建对象结构（<code>FileSystem</code>）和具体元素（<code>File</code>
和 <code>Folder</code>）。</li>
<li>创建访问者（<code>SizeCalculatorVisitor</code>）并传递给结构。</li>
<li>元素通过 <code>accept</code> 调用访问者的对应方法，执行操作。</li>
</ol>
<hr />
<h4 id="优点-21">5. 优点</h4>
<ul>
<li><strong>扩展性</strong>：新增操作只需添加新访问者。</li>
<li><strong>解耦</strong>：数据结构与操作分离。</li>
<li><strong>集中逻辑</strong>：操作集中在访问者中。</li>
</ul>
<hr />
<h4 id="缺点-21">6. 缺点</h4>
<ul>
<li><strong>结构稳定要求</strong>：元素类变化会影响所有访问者。</li>
<li><strong>复杂度</strong>：增加访问者类，提高系统复杂性。</li>
<li><strong>访问限制</strong>：需暴露元素接口给访问者。</li>
</ul>
<hr />
<h4 id="与迭代器模式的对比">7. 与迭代器模式的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>访问者模式</th>
<th>迭代器模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>目的</strong></td>
<td>扩展操作</td>
<td>顺序访问</td>
</tr>
<tr class="even">
<td><strong>关注点</strong></td>
<td>操作逻辑</td>
<td>遍历逻辑</td>
</tr>
<tr class="odd">
<td><strong>控制权</strong></td>
<td>访问者控制</td>
<td>客户端控制</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-21">8. 实际应用场景</h4>
<ul>
<li><strong>编译器</strong>：语法树遍历和操作（如类型检查）。</li>
<li><strong>文档处理</strong>：对文档元素执行统计或格式化。</li>
<li><strong>游戏</strong>：对不同对象执行渲染或碰撞检测。</li>
</ul>
<hr />
<h4 id="源码中的例子-21">9. 源码中的例子</h4>
<p>Java 中的 <code>javax.swing.tree.TreeVisitor</code>（概念类似）：
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 伪代码示例</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">TreeVisitor</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">visit</span><span class="params">(Node node)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr />
<h4 id="总结-21">10. 总结</h4>
<ul>
<li><strong>访问者模式</strong>通过访问者分离操作和结构，支持动态功能扩展。</li>
<li><strong>Java 实现</strong>依赖双重分派（<code>accept</code> 和
<code>visit</code>），实现灵活操作。</li>
<li><strong>UML 图</strong>展示了访问者与元素的关系。</li>
</ul>
<p>如果需要更复杂示例（如多访问者）或调整 UML，请告诉我！</p>
<h2 id="扩展模式extended-patterns">扩展模式（Extended Patterns）</h2>
<h3 id="依赖注入dependency-injection"><strong>依赖注入（Dependency
Injection）</strong></h3>
<p>依赖注入模式（Dependency Injection Pattern，简称
DI）是一种设计模式，用于实现控制反转（Inversion of
Control，IoC）。它通过将对象的依赖关系从对象内部创建转移到外部注入，从而解耦对象的创建和使用，提高代码的灵活性、可测试性和可维护性。依赖注入是
IoC 的一种具体实现方式。</p>
<p>以下是用 Java
实现依赖注入模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="依赖注入模式的定义">1. 依赖注入模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：将对象的依赖（即所需的服务或组件）从外部注入，而不是由对象自己创建。</li>
<li><strong>目的</strong>：
<ul>
<li>解耦对象的创建和使用。</li>
<li>提高代码的可测试性（易于 mock 依赖）。</li>
<li>支持动态配置和替换依赖。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>对象依赖复杂或需频繁更换。</li>
<li>单元测试需要隔离依赖。</li>
<li>系统需要集中管理组件。</li>
</ul></li>
</ul>
<hr />
<h4 id="依赖注入模式的结构">2. 依赖注入模式的结构</h4>
<ul>
<li><strong>服务（Service）</strong>：被注入的依赖，提供具体功能。</li>
<li><strong>客户端（Client）</strong>：依赖服务的对象，使用注入的依赖。</li>
<li><strong>注入器（Injector）</strong>：负责创建和注入依赖，可以是手动实现或框架（如
Spring）。</li>
<li><strong>接口（Interface）</strong>：定义服务契约，解耦客户端和具体实现。</li>
</ul>
<h5 id="mermaid-uml-图-17">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Service &#123;
        &lt;&lt;interface&gt;&gt;
        +doSomething()
    &#125;
    class ConcreteService &#123;
        +doSomething()
    &#125;
    class Client &#123;
        -service: Service
        +setService(Service)
        +useService()
    &#125;
    class Injector &#123;
        +injectDependencies(Client)
    &#125;
    
    ConcreteService ..|&gt; Service : implements
    Client --&gt; Service : uses
    Injector --&gt; Client : injects
    Injector --&gt; ConcreteService : creates</code></pre>
<hr />
<h4 id="依赖注入的类型">3. 依赖注入的类型</h4>
<ol type="1">
<li><strong>构造函数注入</strong>：通过构造函数传递依赖。</li>
<li><strong>Setter 注入</strong>：通过 setter 方法设置依赖。</li>
<li><strong>接口注入</strong>：通过接口定义注入方法（较少使用）。</li>
</ol>
<hr />
<h4 id="java-实现示例-22">4. Java 实现示例</h4>
<p>以下是一个消息服务的依赖注入示例，展示构造函数和 Setter 注入。</p>
<h5 id="服务接口">4.1 服务接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MessageService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体服务">4.2 具体服务</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体服务：邮件服务</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailService</span> <span class="keyword">implements</span> <span class="title class_">MessageService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Sending email: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体服务：短信服务</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SMSService</span> <span class="keyword">implements</span> <span class="title class_">MessageService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Sending SMS: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端构造函数注入">4.3 客户端（构造函数注入）</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端：消息发送器（构造函数注入）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageSenderConstructor</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MessageService service;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MessageSenderConstructor</span><span class="params">(MessageService service)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.service = service;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        service.sendMessage(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端setter-注入">4.4 客户端（Setter 注入）</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 客户端：消息发送器（Setter 注入）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageSenderSetter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> MessageService service;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setService</span><span class="params">(MessageService service)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.service = service;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (service != <span class="literal">null</span>) &#123;</span><br><span class="line">            service.sendMessage(message);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Service not set&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="注入器手动实现">4.5 注入器（手动实现）</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 注入器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DependencyInjector</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> MessageSenderConstructor <span class="title function_">createConstructorSender</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MessageSenderConstructor</span>(<span class="keyword">new</span> <span class="title class_">EmailService</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> MessageSenderSetter <span class="title function_">createSetterSender</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MessageSenderSetter</span> <span class="variable">sender</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MessageSenderSetter</span>();</span><br><span class="line">        sender.setService(<span class="keyword">new</span> <span class="title class_">SMSService</span>());</span><br><span class="line">        <span class="keyword">return</span> sender;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-22">4.6 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 构造函数注入</span></span><br><span class="line">        <span class="type">MessageSenderConstructor</span> <span class="variable">constructorSender</span> <span class="operator">=</span> DependencyInjector.createConstructorSender();</span><br><span class="line">        constructorSender.send(<span class="string">&quot;Hello via email&quot;</span>);  <span class="comment">// 输出: Sending email: Hello via email</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// Setter 注入</span></span><br><span class="line">        <span class="type">MessageSenderSetter</span> <span class="variable">setterSender</span> <span class="operator">=</span> DependencyInjector.createSetterSender();</span><br><span class="line">        setterSender.send(<span class="string">&quot;Hello via SMS&quot;</span>);  <span class="comment">// 输出: Sending SMS: Hello via SMS</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-22">5. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>定义依赖接口（<code>MessageService</code>），不直接创建实例。</li>
<li><strong>注入器</strong>创建具体服务（如
<code>EmailService</code>）并注入客户端。</li>
<li>客户端通过接口调用服务，完成功能。</li>
</ol>
<hr />
<h4 id="优点-22">6. 优点</h4>
<ul>
<li><strong>解耦</strong>：客户端不依赖具体实现，只依赖接口。</li>
<li><strong>可测试性</strong>：易于注入 mock 对象进行测试。</li>
<li><strong>灵活性</strong>：运行时可切换依赖实现。</li>
</ul>
<hr />
<h4 id="缺点-22">7. 缺点</h4>
<ul>
<li><strong>复杂度</strong>：手动注入增加代码量，需依赖框架简化。</li>
<li><strong>运行时错误</strong>：依赖未注入可能导致空指针异常。</li>
<li><strong>学习曲线</strong>：理解 IoC 和 DI 需一定经验。</li>
</ul>
<hr />
<h4 id="与工厂模式的对比-2">8. 与工厂模式的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>依赖注入模式</th>
<th>工厂模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>创建方式</strong></td>
<td>外部注入</td>
<td>工厂创建</td>
</tr>
<tr class="even">
<td><strong>控制权</strong></td>
<td>注入器控制</td>
<td>客户端控制</td>
</tr>
<tr class="odd">
<td><strong>耦合</strong></td>
<td>更低（接口依赖）</td>
<td>较高（工厂依赖）</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-22">9. 实际应用场景</h4>
<ul>
<li><strong>Spring 框架</strong>：通过 <code>@Autowired</code>
注入依赖。</li>
<li><strong>单元测试</strong>：注入 mock 对象（如 Mockito）。</li>
<li><strong>模块化系统</strong>：动态配置服务。</li>
</ul>
<hr />
<h4 id="源码中的例子spring-示例">10. 源码中的例子（Spring 示例）</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MessageSender</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MessageService service;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MessageSender</span><span class="params">(MessageService service)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.service = service;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">send</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        service.sendMessage(message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">EmailService</span> <span class="keyword">implements</span> <span class="title class_">MessageService</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendMessage</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Email: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="总结-22">11. 总结</h4>
<ul>
<li><strong>依赖注入模式</strong>通过外部注入解耦依赖关系。</li>
<li><strong>Java 实现</strong>支持构造函数和 Setter
注入，手动或框架实现。</li>
<li><strong>UML 图</strong>展示了服务、客户端和注入器的关系。</li>
</ul>
<p>如果需要框架（如 Spring）示例或调整 UML，请告诉我！</p>
<h3
id="发布-订阅publish-subscribe"><strong>发布-订阅（Publish-Subscribe）</strong></h3>
<p>发布订阅模式（Publish-Subscribe Pattern，简称
Pub/Sub）是一种消息传递模式，虽然它与观察者模式（Observer
Pattern）有相似之处，但它更强调松耦合的异步通信。发布订阅模式通过一个中间消息代理（Broker）实现发布者（Publisher）和订阅者（Subscriber）之间的解耦，订阅者无需直接依赖发布者。</p>
<p>以下是用 Java
实现发布订阅模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="发布订阅模式的定义">1. 发布订阅模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：发布者发送消息到中间代理，订阅者通过订阅主题或频道接收消息。</li>
<li><strong>目的</strong>：
<ul>
<li>解耦消息发送者和接收者。</li>
<li>支持异步、分布式通信。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>事件驱动系统（如 GUI 事件）。</li>
<li>消息队列（如 Kafka、RabbitMQ）。</li>
<li>实时通知（如股票价格更新）。</li>
</ul></li>
</ul>
<hr />
<h4 id="发布订阅模式的结构">2. 发布订阅模式的结构</h4>
<ul>
<li><strong>发布者（Publisher）</strong>：生成并发送消息。</li>
<li><strong>订阅者（Subscriber）</strong>：接收感兴趣的消息。</li>
<li><strong>消息代理（Broker）</strong>：管理订阅关系，分发消息。</li>
<li><strong>主题（Topic）</strong>：消息的分类，订阅者订阅特定主题。</li>
<li><strong>客户端（Client）</strong>：创建发布者和订阅者，发起交互。</li>
</ul>
<h5 id="mermaid-uml-图-18">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Publisher &#123;
        +publish(topic, message)
    &#125;
    class Subscriber &#123;
        +receive(topic, message)
    &#125;
    class MessageBroker &#123;
        -subscriptions: Map&lt;Topic, List&lt;Subscriber&gt;&gt;
        +subscribe(topic, Subscriber)
        +unsubscribe(topic, Subscriber)
        +publish(topic, message)
    &#125;
    class Client
    
    MessageBroker --&gt; Publisher : receives from
    MessageBroker --&gt; Subscriber : notifies
    Client --&gt; Publisher : uses
    Client --&gt; Subscriber : uses
    Client --&gt; MessageBroker : configures</code></pre>
<hr />
<h4 id="java-实现示例-23">3. Java 实现示例</h4>
<p>以下是一个简单的事件通知系统的发布订阅模式示例。</p>
<h5 id="消息代理">3.1 消息代理</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 消息代理</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MessageBroker</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, List&lt;Subscriber&gt;&gt; subscriptions = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">subscribe</span><span class="params">(String topic, Subscriber subscriber)</span> &#123;</span><br><span class="line">        subscriptions.computeIfAbsent(topic, k -&gt; <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;()).add(subscriber);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unsubscribe</span><span class="params">(String topic, Subscriber subscriber)</span> &#123;</span><br><span class="line">        List&lt;Subscriber&gt; subscribers = subscriptions.get(topic);</span><br><span class="line">        <span class="keyword">if</span> (subscribers != <span class="literal">null</span>) &#123;</span><br><span class="line">            subscribers.remove(subscriber);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">publish</span><span class="params">(String topic, String message)</span> &#123;</span><br><span class="line">        List&lt;Subscriber&gt; subscribers = subscriptions.get(topic);</span><br><span class="line">        <span class="keyword">if</span> (subscribers != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">for</span> (Subscriber subscriber : subscribers) &#123;</span><br><span class="line">                subscriber.receive(topic, message);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="订阅者接口">3.2 订阅者接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 订阅者接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Subscriber</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(String topic, String message)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体订阅者">3.3 具体订阅者</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体订阅者：邮件通知</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailSubscriber</span> <span class="keyword">implements</span> <span class="title class_">Subscriber</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">EmailSubscriber</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(String topic, String message)</span> &#123;</span><br><span class="line">        System.out.println(name + <span class="string">&quot; received email on &quot;</span> + topic + <span class="string">&quot;: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体订阅者：短信通知</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SMSSubscriber</span> <span class="keyword">implements</span> <span class="title class_">Subscriber</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SMSSubscriber</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">receive</span><span class="params">(String topic, String message)</span> &#123;</span><br><span class="line">        System.out.println(name + <span class="string">&quot; received SMS on &quot;</span> + topic + <span class="string">&quot;: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="发布者">3.4 发布者</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 发布者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NewsPublisher</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> MessageBroker broker;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">NewsPublisher</span><span class="params">(MessageBroker broker)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.broker = broker;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">publish</span><span class="params">(String topic, String message)</span> &#123;</span><br><span class="line">        broker.publish(topic, message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-23">3.5 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MessageBroker</span> <span class="variable">broker</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MessageBroker</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建订阅者</span></span><br><span class="line">        <span class="type">Subscriber</span> <span class="variable">emailSub</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EmailSubscriber</span>(<span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">        <span class="type">Subscriber</span> <span class="variable">smsSub</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SMSSubscriber</span>(<span class="string">&quot;Bob&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 订阅主题</span></span><br><span class="line">        broker.subscribe(<span class="string">&quot;news&quot;</span>, emailSub);</span><br><span class="line">        broker.subscribe(<span class="string">&quot;news&quot;</span>, smsSub);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 创建发布者</span></span><br><span class="line">        <span class="type">NewsPublisher</span> <span class="variable">publisher</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NewsPublisher</span>(broker);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 发布消息</span></span><br><span class="line">        publisher.publish(<span class="string">&quot;news&quot;</span>, <span class="string">&quot;Breaking news!&quot;</span>);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        输出:</span></span><br><span class="line"><span class="comment">        Alice received email on news: Breaking news!</span></span><br><span class="line"><span class="comment">        Bob received SMS on news: Breaking news!</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 取消订阅</span></span><br><span class="line">        broker.unsubscribe(<span class="string">&quot;news&quot;</span>, smsSub);</span><br><span class="line">        publisher.publish(<span class="string">&quot;news&quot;</span>, <span class="string">&quot;Update!&quot;</span>);</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        输出:</span></span><br><span class="line"><span class="comment">        Alice received email on news: Update!</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-23">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>创建消息代理、订阅者和发布者。</li>
<li>订阅者通过代理订阅主题（<code>subscribe</code>）。</li>
<li>发布者发送消息到代理（<code>publish</code>），代理分发给订阅者（<code>receive</code>）。</li>
</ol>
<hr />
<h4 id="优点-23">5. 优点</h4>
<ul>
<li><strong>解耦</strong>：发布者和订阅者无直接依赖，仅通过代理交互。</li>
<li><strong>灵活性</strong>：支持动态订阅和取消。</li>
<li><strong>异步性</strong>：可结合队列实现异步通信。</li>
</ul>
<hr />
<h4 id="缺点-23">6. 缺点</h4>
<ul>
<li><strong>复杂度</strong>：代理增加系统复杂性。</li>
<li><strong>性能</strong>：大量订阅者或消息可能影响分发效率。</li>
<li><strong>依赖代理</strong>：代理故障影响整个系统。</li>
</ul>
<hr />
<h4 id="与观察者模式的对比-1">7. 与观察者模式的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>发布订阅模式</th>
<th>观察者模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>耦合</strong></td>
<td>松耦合（通过代理）</td>
<td>紧耦合（直接依赖主题）</td>
</tr>
<tr class="even">
<td><strong>中介</strong></td>
<td>有独立代理</td>
<td>无（主题直接通知）</td>
</tr>
<tr class="odd">
<td><strong>通信</strong></td>
<td>异步支持强</td>
<td>通常同步</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-23">8. 实际应用场景</h4>
<ul>
<li><strong>消息队列</strong>：如 Kafka、RabbitMQ。</li>
<li><strong>事件总线</strong>：GUI 框架中的事件分发。</li>
<li><strong>实时系统</strong>：股票价格通知。</li>
</ul>
<hr />
<h4 id="源码中的例子-22">9. 源码中的例子</h4>
<p>Java 中的 <code>java.util.concurrent.Flow</code>（Java 9+）：
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.Flow.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyPublisher</span> <span class="keyword">implements</span> <span class="title class_">Publisher</span>&lt;String&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Subscriber&lt;? <span class="built_in">super</span> String&gt;&gt; subscribers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">subscribe</span><span class="params">(Subscriber&lt;? <span class="built_in">super</span> String&gt; subscriber)</span> &#123;</span><br><span class="line">        subscribers.add(subscriber);</span><br><span class="line">        subscriber.onSubscribe(<span class="keyword">new</span> <span class="title class_">Subscription</span>() &#123;</span><br><span class="line">            <span class="meta">@Override</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">request</span><span class="params">(<span class="type">long</span> n)</span> &#123;&#125;</span><br><span class="line">            <span class="meta">@Override</span> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">cancel</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">publish</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        subscribers.forEach(s -&gt; s.onNext(message));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr />
<h4 id="总结-23">10. 总结</h4>
<ul>
<li><strong>发布订阅模式</strong>通过代理实现松耦合消息传递。</li>
<li><strong>Java 实现</strong>依赖代理分发，支持动态订阅。</li>
<li><strong>UML 图</strong>展示了发布者、订阅者和代理的关系。</li>
</ul>
<p>如果需要异步示例（如线程池）或调整 UML，请告诉我！</p>
<h3 id="模块模式module-pattern"><strong>模块模式（Module
Pattern）</strong></h3>
<p>我假设你指的是“模块模式”（Module
Pattern），可能是“模块”中的拼写或表述差异。模块模式不是经典的 GoF
设计模式，而是一种在 JavaScript
中广泛使用的设计模式，用于封装代码、隐藏实现细节并提供公共接口。它通过闭包和立即执行函数（IIFE）实现私有作用域和模块化。</p>
<p>由于你的问题要求用 Java，而 Java 的模块化机制与 JavaScript 不同（如
Java 使用类和包），我将讲解模块模式的核心思想，并将其适配到 Java
环境中，提供类似的实现方式（基于类的封装或 Java 9+
的模块系统）。以下是详细讲解。</p>
<hr />
<h4 id="模块模式的定义">1. 模块模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：通过封装隐藏私有成员，只暴露公共接口，实现数据隐私和模块化。</li>
<li><strong>目的</strong>：
<ul>
<li>防止全局命名空间污染。</li>
<li>提供清晰的 API，隐藏实现细节。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>需要封装逻辑和状态。</li>
<li>避免变量冲突。</li>
<li>分离关注点。</li>
</ul></li>
</ul>
<hr />
<h4 id="模块模式的结构javascript-视角">2. 模块模式的结构（JavaScript
视角）</h4>
<ul>
<li><strong>私有成员</strong>：通过闭包定义的变量和方法，仅模块内部可访问。</li>
<li><strong>公共接口</strong>：通过返回的对象暴露给外部。</li>
<li><strong>立即执行函数（IIFE）</strong>：创建模块作用域。</li>
</ul>
<h5 id="javascript-示例">JavaScript 示例</h5>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> <span class="title class_">CounterModule</span> = (<span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="comment">// 私有成员</span></span><br><span class="line">    <span class="keyword">var</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">function</span> <span class="title function_">incrementInternal</span>(<span class="params"></span>) &#123; count++; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 公共接口</span></span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        <span class="attr">increment</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123;</span><br><span class="line">            <span class="title function_">incrementInternal</span>();</span><br><span class="line">            <span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="string">&quot;Count: &quot;</span> + count);</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="attr">getCount</span>: <span class="keyword">function</span>(<span class="params"></span>) &#123; <span class="keyword">return</span> count; &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;)();</span><br><span class="line"></span><br><span class="line"><span class="title class_">CounterModule</span>.<span class="title function_">increment</span>();  <span class="comment">// 输出: Count: 1</span></span><br><span class="line"><span class="title class_">CounterModule</span>.<span class="title function_">increment</span>();  <span class="comment">// 输出: Count: 2</span></span><br><span class="line"><span class="variable language_">console</span>.<span class="title function_">log</span>(<span class="title class_">CounterModule</span>.<span class="title function_">getCount</span>());  <span class="comment">// 输出: 2</span></span><br></pre></td></tr></table></figure>
<hr />
<h4 id="java-中的模块模式适配">3. Java 中的模块模式适配</h4>
<p>Java 没有闭包和
IIFE，但可以通过类的封装（私有字段和公共方法）实现类似效果。Java 9
引入的模块系统（JPMS）进一步支持模块化。以下是两种方式的实现。</p>
<h5 id="使用类封装类似-javascript-模块模式">3.1 使用类封装（类似
JavaScript 模块模式）</h5>
<h6 id="模块类">模块类</h6>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模块类：计数器模块</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CounterModule</span> &#123;</span><br><span class="line">    <span class="comment">// 私有成员</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 私有方法</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">incrementInternal</span><span class="params">()</span> &#123;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 公共接口</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        incrementInternal();</span><br><span class="line">        System.out.println(<span class="string">&quot;Count: &quot;</span> + count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 单例模式确保唯一实例（可选）</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">CounterModule</span> <span class="variable">INSTANCE</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CounterModule</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">CounterModule</span><span class="params">()</span> &#123;&#125;  <span class="comment">// 私有构造防止外部实例化</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> CounterModule <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> INSTANCE;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="客户端代码-24">客户端代码</h6>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CounterModule</span> <span class="variable">counter</span> <span class="operator">=</span> CounterModule.getInstance();</span><br><span class="line">        counter.increment();  <span class="comment">// 输出: Count: 1</span></span><br><span class="line">        counter.increment();  <span class="comment">// 输出: Count: 2</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Current count: &quot;</span> + counter.getCount());  <span class="comment">// 输出: Current count: 2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>说明</strong>：
<ul>
<li>私有字段 <code>count</code> 和方法 <code>incrementInternal</code>
隐藏实现。</li>
<li>公共方法 <code>increment</code> 和 <code>getCount</code>
暴露接口。</li>
<li>单例模式模拟 JavaScript 的单一模块实例。</li>
</ul></li>
</ul>
<h5 id="使用-java-9-模块系统jpms">3.2 使用 Java 9+ 模块系统（JPMS）</h5>
<p>Java 9 引入的模块系统提供了更高级的模块化支持，通过
<code>module-info.java</code> 定义模块边界。</p>
<h6 id="模块定义module-info.java">模块定义（module-info.java）</h6>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> counterModule &#123;</span><br><span class="line">    <span class="keyword">exports</span> com.example.counter;  <span class="comment">// 暴露公共接口包</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6
id="模块实现com.example.counter.countermodule">模块实现（com.example.counter.CounterModule）</h6>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.counter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CounterModule</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">incrementInternal</span><span class="params">()</span> &#123;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        incrementInternal();</span><br><span class="line">        System.out.println(<span class="string">&quot;Count: &quot;</span> + count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6 id="客户端模块module-info.java">客户端模块（module-info.java）</h6>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">module</span> client &#123;</span><br><span class="line">    <span class="keyword">requires</span> counterModule;  <span class="comment">// 依赖 counterModule</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h6
id="客户端代码com.example.client.main">客户端代码（com.example.client.Main）</h6>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.example.client;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> com.example.counter.CounterModule;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CounterModule</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CounterModule</span>();</span><br><span class="line">        counter.increment();  <span class="comment">// 输出: Count: 1</span></span><br><span class="line">        counter.increment();  <span class="comment">// 输出: Count: 2</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>说明</strong>：
<ul>
<li><code>module-info.java</code> 定义模块边界，控制包的可见性。</li>
<li>类似 JavaScript 的模块作用域，但更静态。</li>
</ul></li>
</ul>
<hr />
<h4 id="工作原理-24">4. 工作原理</h4>
<ol type="1">
<li><strong>封装</strong>：私有成员（如
<code>count</code>）隐藏在类或模块内部。</li>
<li><strong>暴露接口</strong>：通过公共方法（如
<code>increment</code>）提供访问。</li>
<li><strong>客户端</strong>：仅通过接口操作模块，无需了解实现。</li>
</ol>
<hr />
<h4 id="优点-24">5. 优点</h4>
<ul>
<li><strong>封装性</strong>：隐藏实现细节，保护数据。</li>
<li><strong>模块化</strong>：逻辑清晰，便于维护。</li>
<li><strong>复用性</strong>：单一模块可多次使用。</li>
</ul>
<hr />
<h4 id="缺点-24">6. 缺点</h4>
<ul>
<li><strong>灵活性低</strong>：Java 类封装静态，动态性不如
JavaScript。</li>
<li><strong>单例限制</strong>：单例模式可能不适合所有场景。</li>
<li><strong>JPMS 复杂性</strong>：模块系统配置较繁琐。</li>
</ul>
<hr />
<h4 id="与工厂模式的对比-3">7. 与工厂模式的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>模块模式</th>
<th>工厂模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>目的</strong></td>
<td>封装和模块化</td>
<td>创建对象</td>
</tr>
<tr class="even">
<td><strong>结构</strong></td>
<td>单一实例或模块</td>
<td>工厂类</td>
</tr>
<tr class="odd">
<td><strong>动态性</strong></td>
<td>较静态</td>
<td>动态创建</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-24">8. 实际应用场景</h4>
<ul>
<li><strong>工具类</strong>：封装工具函数（如 <code>Math</code>
类）。</li>
<li><strong>配置管理</strong>：隐藏配置细节，提供接口。</li>
<li><strong>服务模块</strong>：如日志或缓存服务。</li>
</ul>
<hr />
<h4 id="源码中的例子-23">9. 源码中的例子</h4>
<p>Java 中的 <code>java.util.Collections</code>： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.Collections;</span><br><span class="line"></span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">Collections.sort(list);  <span class="comment">// 模块化接口</span></span><br></pre></td></tr></table></figure> -
<strong>说明</strong>：<code>Collections</code>
封装排序逻辑，隐藏实现。</p>
<hr />
<h4 id="总结-24">10. 总结</h4>
<ul>
<li><strong>模块模式</strong>通过封装实现私有性和公共接口。</li>
<li><strong>Java 实现</strong>可用类封装或 JPMS，模拟 JavaScript
模块化。</li>
<li><strong>UML 图</strong>（若需要）可展示单一模块与客户端关系。</li>
</ul>
<p>如果需要更复杂示例（如带配置的模块）或 UML 图，请告诉我！</p>
<h3
id="mvcmodel-view-controller"><strong>MVC（Model-View-Controller）</strong></h3>
<p>MVC 模式（Model-View-Controller
Pattern）是一种广泛使用的架构模式，用于组织代码，分分离用户界面、数据和控制逻辑。它通过将应用程序分为三个相互连接的部分，提高了代码的可维护性、可扩展性和模块化。</p>
<p>以下是用 Java 实现 MVC
模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="mvc-模式的定义">1. MVC 模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：将应用程序分为模型（Model）、视图（View）和控制器（Controller），实现职责分离。</li>
<li><strong>目的</strong>：
<ul>
<li>解耦数据、界面和逻辑。</li>
<li>支持独立开发和测试。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>GUI 应用程序（如 Swing、JavaFX）。</li>
<li>Web 应用（如 Spring MVC）。</li>
<li>复杂交互系统。</li>
</ul></li>
</ul>
<hr />
<h4 id="mvc-模式的结构">2. MVC 模式的结构</h4>
<ul>
<li><strong>模型（Model）</strong>：管理数据和业务逻辑，独立于 UI。</li>
<li><strong>视图（View）</strong>：显示模型数据，负责用户界面。</li>
<li><strong>控制器（Controller）</strong>：处理用户输入，协调模型和视图。</li>
<li><strong>交互关系</strong>：
<ul>
<li>控制器接收用户输入，更新模型。</li>
<li>模型通知视图更新显示。</li>
<li>视图从模型获取数据。</li>
</ul></li>
</ul>
<h5 id="mermaid-uml-图-19">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Model &#123;
        -data: Data
        +setData(data)
        +getData() Data
        +notifyViews()
    &#125;
    class View &#123;
        -model: Model
        +update()
        +display()
    &#125;
    class Controller &#123;
        -model: Model
        -view: View
        +handleInput(input)
    &#125;
    
    Model --&gt; View : notifies
    View --&gt; Model : queries
    Controller --&gt; Model : updates
    Controller --&gt; View : controls</code></pre>
<hr />
<h4 id="java-实现示例-24">3. Java 实现示例</h4>
<p>以下是一个简单的计数器应用的 MVC 示例。</p>
<h5 id="模型model">3.1 模型（Model）</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模型：计数器数据</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CounterModel</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> count;</span><br><span class="line">    <span class="keyword">private</span> List&lt;View&gt; views = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        count++;</span><br><span class="line">        notifyViews();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decrement</span><span class="params">()</span> &#123;</span><br><span class="line">        count--;</span><br><span class="line">        notifyViews();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addView</span><span class="params">(View view)</span> &#123;</span><br><span class="line">        views.add(view);</span><br><span class="line">        view.update();  <span class="comment">// 初始化视图</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">notifyViews</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (View view : views) &#123;</span><br><span class="line">            view.update();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="视图view">3.2 视图（View）</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 视图：显示计数器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CounterView</span> <span class="keyword">implements</span> <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> CounterModel model;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CounterView</span><span class="params">(CounterModel model)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.model = model;</span><br><span class="line">        model.addView(<span class="built_in">this</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Current count: &quot;</span> + model.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 视图接口</span></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">View</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">update</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="控制器controller">3.3 控制器（Controller）</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 控制器：处理用户输入</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CounterController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> CounterModel model;</span><br><span class="line">    <span class="keyword">private</span> CounterView view;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CounterController</span><span class="params">(CounterModel model, CounterView view)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.model = model;</span><br><span class="line">        <span class="built_in">this</span>.view = view;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        model.increment();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decrement</span><span class="params">()</span> &#123;</span><br><span class="line">        model.decrement();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-25">3.4 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CounterModel</span> <span class="variable">model</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CounterModel</span>();</span><br><span class="line">        <span class="type">CounterView</span> <span class="variable">view</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CounterView</span>(model);</span><br><span class="line">        <span class="type">CounterController</span> <span class="variable">controller</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CounterController</span>(model, view);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 模拟用户操作</span></span><br><span class="line">        controller.increment();  <span class="comment">// 输出: Current count: 1</span></span><br><span class="line">        controller.increment();  <span class="comment">// 输出: Current count: 2</span></span><br><span class="line">        controller.decrement();  <span class="comment">// 输出: Current count: 1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-25">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>创建模型、视图和控制器，关联三者。</li>
<li>用户通过控制器发起操作（如 <code>increment</code>）。</li>
<li>控制器更新模型，模型通知视图刷新显示。</li>
</ol>
<hr />
<h4 id="优点-25">5. 优点</h4>
<ul>
<li><strong>解耦</strong>：模型、视图和控制器独立，互不干扰。</li>
<li><strong>可扩展</strong>：易于添加新视图或控制器。</li>
<li><strong>可测试</strong>：模型独立于 UI，便于单元测试。</li>
</ul>
<hr />
<h4 id="缺点-25">6. 缺点</h4>
<ul>
<li><strong>复杂度</strong>：小型应用可能显得过于繁琐。</li>
<li><strong>耦合风险</strong>：视图和控制器可能间接耦合。</li>
<li><strong>维护成本</strong>：多组件增加协调难度。</li>
</ul>
<hr />
<h4 id="与-mvpmvvm-的对比">7. 与 MVP/MVVM 的对比</h4>
<table>
<colgroup>
<col style="width: 22%" />
<col style="width: 22%" />
<col style="width: 22%" />
<col style="width: 31%" />
</colgroup>
<thead>
<tr class="header">
<th>特性</th>
<th>MVC</th>
<th>MVP</th>
<th>MVVM</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>控制器角色</strong></td>
<td>协调视图和模型</td>
<td>主动更新视图</td>
<td>数据绑定</td>
</tr>
<tr class="even">
<td><strong>视图依赖</strong></td>
<td>依赖模型</td>
<td>依赖 Presenter</td>
<td>通过 ViewModel 绑定</td>
</tr>
<tr class="odd">
<td><strong>耦合</strong></td>
<td>中等</td>
<td>较低</td>
<td>最低</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-25">8. 实际应用场景</h4>
<ul>
<li><strong>Swing/JavaFX</strong>：GUI 组件分离。</li>
<li><strong>Spring MVC</strong>：Web 应用框架。</li>
<li><strong>游戏开发</strong>：游戏逻辑与渲染分离。</li>
</ul>
<hr />
<h4 id="源码中的例子-24">9. 源码中的例子</h4>
<p>Java Swing 中的 MVC： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">JButton</span> <span class="variable">button</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">JButton</span>(<span class="string">&quot;Click&quot;</span>);</span><br><span class="line">button.addActionListener(e -&gt; System.out.println(<span class="string">&quot;Clicked&quot;</span>));  <span class="comment">// 控制器监听</span></span><br></pre></td></tr></table></figure> -
<strong>Model</strong>：按钮状态。 - <strong>View</strong>：按钮 UI。 -
<strong>Controller</strong>：<code>ActionListener</code>。</p>
<hr />
<h4 id="总结-25">10. 总结</h4>
<ul>
<li><strong>MVC
模式</strong>通过分离模型、视图和控制器实现职责分工。</li>
<li><strong>Java 实现</strong>依赖观察者机制协调视图更新。</li>
<li><strong>UML 图</strong>展示了三者之间的关系。</li>
</ul>
<p>如果需要更复杂示例（如多视图支持）或调整 UML，请告诉我！</p>
<h3
id="mvpmodel-view-presenter"><strong>MVP（Model-View-Presenter）</strong></h3>
<p>MVP 模式（Model-View-Presenter Pattern）是一种架构模式，演变自 MVC
模式，旨在进一步解耦视图和逻辑，增强可测试性。MVP
通过将视图（View）和模型（Model）之间的交互完全交给展示者（Presenter）处理，避免了视图直接依赖模型，提高了代码的模块化和清晰度。</p>
<p>以下是用 Java 实现 MVP
模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="mvp-模式的定义">1. MVP 模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：通过展示者（Presenter）协调视图和模型，视图只负责显示，Presenter
处理逻辑。</li>
<li><strong>目的</strong>：
<ul>
<li>解耦视图和模型。</li>
<li>提高代码可测试性。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>GUI 应用程序需要清晰分离。</li>
<li>需要测试业务逻辑而不依赖 UI。</li>
<li>视图逻辑复杂。</li>
</ul></li>
</ul>
<hr />
<h4 id="mvp-模式的结构">2. MVP 模式的结构</h4>
<ul>
<li><strong>模型（Model）</strong>：管理数据和业务逻辑，与 MVC
类似。</li>
<li><strong>视图（View）</strong>：显示数据和用户界面，定义与 Presenter
交互的接口。</li>
<li><strong>展示者（Presenter）</strong>：处理用户输入，更新模型并控制视图。</li>
<li><strong>客户端（Client）</strong>：创建并连接组件。</li>
</ul>
<h5 id="mermaid-uml-图-20">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Model &#123;
        -data: Data
        +setData(data)
        +getData() Data
    &#125;
    class View &#123;
        &lt;&lt;interface&gt;&gt;
        +showData(data)
        +getInput() Input
    &#125;
    class ConcreteView &#123;
        +showData(data)
        +getInput() Input
    &#125;
    class Presenter &#123;
        -model: Model
        -view: View
        +handleInput(input)
    &#125;
    class Client
    
    ConcreteView ..|&gt; View : implements
    Presenter --&gt; Model : updates
    Presenter --&gt; View : controls
    ConcreteView --&gt; Presenter : notifies
    Client --&gt; Presenter : uses
    Client --&gt; ConcreteView : uses</code></pre>
<hr />
<h4 id="java-实现示例-25">3. Java 实现示例</h4>
<p>以下是一个计数器的 MVP 示例，Presenter 处理增减逻辑。</p>
<h5 id="模型model-1">3.1 模型（Model）</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模型：计数器数据</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CounterModel</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decrement</span><span class="params">()</span> &#123;</span><br><span class="line">        count--;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="视图接口view">3.2 视图接口（View）</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 视图接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">CounterView</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">showCount</span><span class="params">(<span class="type">int</span> count)</span>;  <span class="comment">// 显示计数</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">incrementClicked</span><span class="params">()</span>;    <span class="comment">// 通知增操作</span></span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">decrementClicked</span><span class="params">()</span>;    <span class="comment">// 通知减操作</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体视图concrete-view">3.3 具体视图（Concrete View）</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体视图</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsoleCounterView</span> <span class="keyword">implements</span> <span class="title class_">CounterView</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> CounterPresenter presenter;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">ConsoleCounterView</span><span class="params">(CounterPresenter presenter)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.presenter = presenter;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">showCount</span><span class="params">(<span class="type">int</span> count)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Current count: &quot;</span> + count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">incrementClicked</span><span class="params">()</span> &#123;</span><br><span class="line">        presenter.increment();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decrementClicked</span><span class="params">()</span> &#123;</span><br><span class="line">        presenter.decrement();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模拟用户操作</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">simulateUserInteraction</span><span class="params">()</span> &#123;</span><br><span class="line">        incrementClicked();</span><br><span class="line">        decrementClicked();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="展示者presenter">3.4 展示者（Presenter）</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 展示者</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CounterPresenter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> CounterModel model;</span><br><span class="line">    <span class="keyword">private</span> CounterView view;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CounterPresenter</span><span class="params">(CounterModel model, CounterView view)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.model = model;</span><br><span class="line">        <span class="built_in">this</span>.view = view;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        model.increment();</span><br><span class="line">        view.showCount(model.getCount());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decrement</span><span class="params">()</span> &#123;</span><br><span class="line">        model.decrement();</span><br><span class="line">        view.showCount(model.getCount());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-26">3.5 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CounterModel</span> <span class="variable">model</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CounterModel</span>();</span><br><span class="line">        <span class="type">ConsoleCounterView</span> <span class="variable">view</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ConsoleCounterView</span>(<span class="literal">null</span>);  <span class="comment">// 先创建视图</span></span><br><span class="line">        <span class="type">CounterPresenter</span> <span class="variable">presenter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CounterPresenter</span>(model, view);</span><br><span class="line">        view.presenter = presenter;  <span class="comment">// 注入 Presenter</span></span><br><span class="line"></span><br><span class="line">        view.simulateUserInteraction();</span><br><span class="line">        <span class="comment">/*</span></span><br><span class="line"><span class="comment">        输出:</span></span><br><span class="line"><span class="comment">        Current count: 1</span></span><br><span class="line"><span class="comment">        Current count: 0</span></span><br><span class="line"><span class="comment">        */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-26">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>创建模型、视图和展示者，关联三者。</li>
<li>视图捕获用户输入（如 <code>incrementClicked</code>），通知
Presenter。</li>
<li>Presenter 更新模型并调用视图方法刷新显示。</li>
</ol>
<hr />
<h4 id="优点-26">5. 优点</h4>
<ul>
<li><strong>解耦</strong>：视图不直接访问模型，依赖 Presenter。</li>
<li><strong>可测试性</strong>：Presenter 无 UI 依赖，易于单元测试。</li>
<li><strong>清晰性</strong>：职责明确，逻辑集中。</li>
</ul>
<hr />
<h4 id="缺点-26">6. 缺点</h4>
<ul>
<li><strong>复杂度</strong>：小型应用可能显得繁琐。</li>
<li><strong>类数量</strong>：增加接口和实现类。</li>
<li><strong>双向依赖</strong>：视图和 Presenter 可能形成循环引用。</li>
</ul>
<hr />
<h4 id="与-mvc-的对比">7. 与 MVC 的对比</h4>
<table>
<colgroup>
<col style="width: 17%" />
<col style="width: 34%" />
<col style="width: 47%" />
</colgroup>
<thead>
<tr class="header">
<th>特性</th>
<th>MVP</th>
<th>MVC</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>视图依赖</strong></td>
<td>不依赖模型</td>
<td>依赖模型</td>
</tr>
<tr class="even">
<td><strong>控制角色</strong></td>
<td>Presenter 主动更新视图</td>
<td>Controller 协调</td>
</tr>
<tr class="odd">
<td><strong>通信</strong></td>
<td>双向（View ↔︎ Presenter）</td>
<td>三方（View ↔︎ Controller ↔︎ Model）</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-26">8. 实际应用场景</h4>
<ul>
<li><strong>Android 开发</strong>：Activity/View 作为视图，Presenter
处理逻辑。</li>
<li><strong>桌面应用</strong>：Swing/JavaFX 的逻辑分离。</li>
<li><strong>测试驱动开发</strong>：隔离 UI 进行测试。</li>
</ul>
<hr />
<h4 id="源码中的例子-25">9. 源码中的例子</h4>
<p>Android 中的 MVP（伪代码）： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LoginView</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">showLoginSuccess</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginPresenter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> LoginView view;</span><br><span class="line">    <span class="keyword">private</span> LoginModel model;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LoginPresenter</span><span class="params">(LoginView view, LoginModel model)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.view = view;</span><br><span class="line">        <span class="built_in">this</span>.model = model;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">login</span><span class="params">(String username, String password)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (model.validate(username, password)) &#123;</span><br><span class="line">            view.showLoginSuccess();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr />
<h4 id="总结-26">10. 总结</h4>
<ul>
<li><strong>MVP 模式</strong>通过 Presenter
分离视图和模型，增强解耦。</li>
<li><strong>Java 实现</strong>依赖接口和双向通信，支持灵活控制。</li>
<li><strong>UML 图</strong>展示了视图、Presenter 和模型的关系。</li>
</ul>
<p>如果需要更复杂示例（如多视图）或调整 UML，请告诉我！</p>
<h3
id="mvvmmodel-view-viewmodel"><strong>MVVM（Model-View-ViewModel）</strong></h3>
<p>MVVM 模式（Model-View-ViewModel Pattern）是一种架构模式，起源于微软的
WPF 和 Silverlight，广泛应用于现代前端框架（如
Angular、Vue.js）和桌面应用开发。它通过引入 ViewModel
层，将视图（View）和模型（Model）解耦，并利用数据绑定简化视图更新。MVVM
模式特别适合双向数据绑定的场景。</p>
<p>以下是用 Java 实现 MVVM
模式的详细讲解，包括定义、结构、代码示例及其优缺点。由于 Java
不原生支持双向数据绑定，我会通过观察者机制模拟绑定效果。</p>
<hr />
<h4 id="mvvm-模式的定义">1. MVVM 模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：通过 ViewModel
连接视图和模型，利用数据绑定实现视图与数据的自动同步。</li>
<li><strong>目的</strong>：
<ul>
<li>解耦视图和业务逻辑。</li>
<li>简化视图更新，提高开发效率。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>视图频繁更新（如表单、实时数据）。</li>
<li>支持数据绑定的 UI 框架。</li>
<li>需要清晰分离 UI 和逻辑。</li>
</ul></li>
</ul>
<hr />
<h4 id="mvvm-模式的结构">2. MVVM 模式的结构</h4>
<ul>
<li><strong>模型（Model）</strong>：管理数据和业务逻辑。</li>
<li><strong>视图（View）</strong>：显示数据，响应用户输入。</li>
<li><strong>视图模型（ViewModel）</strong>：持有视图所需数据，处理逻辑，绑定模型和视图。</li>
<li><strong>绑定机制（Binding）</strong>：同步 View 和 ViewModel（Java
中需手动模拟）。</li>
<li><strong>客户端（Client）</strong>：创建组件并启动应用。</li>
</ul>
<h5 id="mermaid-uml-图-21">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Model &#123;
        -data: Data
        +setData(data)
        +getData() Data
    &#125;
    class View &#123;
        +display(data)
        +notifyInput(input)
    &#125;
    class ViewModel &#123;
        -model: Model
        -observers: List&lt;View&gt;
        +setValue(value)
        +getValue() Value
        +notifyViews()
    &#125;
    class Client
    
    ViewModel --&gt; Model : uses
    View --&gt; ViewModel : binds to
    ViewModel --&gt; View : notifies
    Client --&gt; View : uses
    Client --&gt; ViewModel : uses</code></pre>
<hr />
<h4 id="java-实现示例-26">3. Java 实现示例</h4>
<p>以下是一个计数器的 MVVM 示例，ViewModel
管理计数并通过观察者通知视图。</p>
<h5 id="模型model-2">3.1 模型（Model）</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 模型：计数器数据</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CounterModel</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> count;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setCount</span><span class="params">(<span class="type">int</span> count)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.count = count;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="视图view-1">3.2 视图（View）</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 视图：计数器显示</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CounterView</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> CounterViewModel viewModel;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CounterView</span><span class="params">(CounterViewModel viewModel)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.viewModel = viewModel;</span><br><span class="line">        viewModel.addObserver(<span class="built_in">this</span>::update);  <span class="comment">// 绑定 ViewModel</span></span><br><span class="line">        update(viewModel.getValue());  <span class="comment">// 初始化显示</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">update</span><span class="params">(<span class="type">int</span> count)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;View updated - Count: &quot;</span> + count);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 模拟用户输入</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        viewModel.setValue(viewModel.getValue() + <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decrement</span><span class="params">()</span> &#123;</span><br><span class="line">        viewModel.setValue(viewModel.getValue() - <span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="视图模型viewmodel">3.3 视图模型（ViewModel）</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 视图模型</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CounterViewModel</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> CounterModel model;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Consumer&lt;Integer&gt;&gt; observers = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">CounterViewModel</span><span class="params">(CounterModel model)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.model = model;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(<span class="type">int</span> value)</span> &#123;</span><br><span class="line">        model.setCount(value);</span><br><span class="line">        notifyViews();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getValue</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> model.getCount();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">addObserver</span><span class="params">(Consumer&lt;Integer&gt; observer)</span> &#123;</span><br><span class="line">        observers.add(observer);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">notifyViews</span><span class="params">()</span> &#123;</span><br><span class="line">        observers.forEach(observer -&gt; observer.accept(model.getCount()));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-27">3.4 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CounterModel</span> <span class="variable">model</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CounterModel</span>();</span><br><span class="line">        <span class="type">CounterViewModel</span> <span class="variable">viewModel</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CounterViewModel</span>(model);</span><br><span class="line">        <span class="type">CounterView</span> <span class="variable">view</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CounterView</span>(viewModel);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 模拟用户操作</span></span><br><span class="line">        view.increment();  <span class="comment">// 输出: View updated - Count: 1</span></span><br><span class="line">        view.increment();  <span class="comment">// 输出: View updated - Count: 2</span></span><br><span class="line">        view.decrement();  <span class="comment">// 输出: View updated - Count: 1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-27">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>创建模型、ViewModel 和视图，关联三者。</li>
<li>视图绑定到 ViewModel，监听数据变化。</li>
<li>用户通过视图发起操作（如 <code>increment</code>），ViewModel
更新模型并通知视图刷新。</li>
</ol>
<hr />
<h4 id="优点-27">5. 优点</h4>
<ul>
<li><strong>解耦</strong>：视图不直接访问模型，依赖 ViewModel。</li>
<li><strong>自动化</strong>：数据绑定减少手动更新代码。</li>
<li><strong>可测试性</strong>：ViewModel 独立于 UI，易于测试。</li>
</ul>
<hr />
<h4 id="缺点-27">6. 缺点</h4>
<ul>
<li><strong>复杂度</strong>：绑定机制增加实现难度（Java
中需手动）。</li>
<li><strong>性能</strong>：大量绑定可能影响效率。</li>
<li><strong>适用性</strong>：需框架支持（如
JavaFX）才充分发挥优势。</li>
</ul>
<hr />
<h4 id="与-mvcmvp-的对比">7. 与 MVC/MVP 的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>MVVM</th>
<th>MVC</th>
<th>MVP</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>视图更新</strong></td>
<td>数据绑定</td>
<td>Controller 控制</td>
<td>Presenter 控制</td>
</tr>
<tr class="even">
<td><strong>视图依赖</strong></td>
<td>ViewModel</td>
<td>Model</td>
<td>Presenter</td>
</tr>
<tr class="odd">
<td><strong>耦合</strong></td>
<td>最低</td>
<td>中等</td>
<td>较低</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-27">8. 实际应用场景</h4>
<ul>
<li><strong>JavaFX</strong>：绑定属性到 UI。</li>
<li><strong>前端框架</strong>：Vue.js、WPF 的 MVVM。</li>
<li><strong>表单应用</strong>：实时同步输入和数据。</li>
</ul>
<hr />
<h4 id="源码中的例子javafx">9. 源码中的例子（JavaFX）</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javafx.beans.property.IntegerProperty;</span><br><span class="line"><span class="keyword">import</span> javafx.beans.property.SimpleIntegerProperty;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CounterViewModel</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">IntegerProperty</span> <span class="variable">count</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SimpleIntegerProperty</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123; count.set(count.get() + <span class="number">1</span>); &#125;</span><br><span class="line">    <span class="keyword">public</span> IntegerProperty <span class="title function_">countProperty</span><span class="params">()</span> &#123; <span class="keyword">return</span> count; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">CounterViewModel</span> <span class="variable">vm</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CounterViewModel</span>();</span><br><span class="line">        vm.countProperty().addListener((obs, old, newVal) -&gt; </span><br><span class="line">            System.out.println(<span class="string">&quot;Count: &quot;</span> + newVal));</span><br><span class="line">        vm.increment();  <span class="comment">// 输出: Count: 1</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="总结-27">10. 总结</h4>
<ul>
<li><strong>MVVM 模式</strong>通过 ViewModel 和绑定解耦视图和模型。</li>
<li><strong>Java
实现</strong>需手动模拟绑定（如观察者），框架支持更佳。</li>
<li><strong>UML 图</strong>展示了 ViewModel 的中介作用。</li>
</ul>
<p>如果需要更复杂示例（如双向绑定）或调整 UML，请告诉我！</p>
<h3 id="mvc-mvp-mvvm-比较">MVC, MVP, MVVM 比较</h3>
<p>以下是 MVC（Model-View-Controller）、MVP（Model-View-Presenter）和
MVVM（Model-View-ViewModel）三种架构模式的详细比较表格，涵盖定义、结构、职责、耦合性、数据流、测试性等关键方面。</p>
<table>
<colgroup>
<col style="width: 16%" />
<col style="width: 27%" />
<col style="width: 27%" />
<col style="width: 27%" />
</colgroup>
<thead>
<tr class="header">
<th><strong>特性</strong></th>
<th><strong>MVC (Model-View-Controller)</strong></th>
<th><strong>MVP (Model-View-Presenter)</strong></th>
<th><strong>MVVM (Model-View-ViewModel)</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>定义</strong></td>
<td>通过控制器协调模型和视图，分离数据、UI 和逻辑。</td>
<td>通过展示者处理视图和模型交互，视图不直接访问模型。</td>
<td>通过 ViewModel 和数据绑定解耦视图和模型，强调自动化。</td>
</tr>
<tr class="even">
<td><strong>核心思想</strong></td>
<td>视图显示模型，控制器处理输入，模型管理数据。</td>
<td>Presenter 控制视图和模型，视图被动接收更新。</td>
<td>ViewModel 暴露数据和命令，视图通过绑定自动更新。</td>
</tr>
<tr class="odd">
<td><strong>结构</strong></td>
<td>- Model: 数据和逻辑<br>- View: UI<br>- Controller: 协调</td>
<td>- Model: 数据和逻辑<br>- View: UI 接口<br>- Presenter: 逻辑</td>
<td>- Model: 数据和逻辑<br>- View: UI<br>- ViewModel: 中介</td>
</tr>
<tr class="even">
<td><strong>职责分配</strong></td>
<td>- Model: 数据存储和业务逻辑<br>- View: 显示和输入<br>- Controller:
更新模型、控制视图</td>
<td>- Model: 数据存储和逻辑<br>- View: 显示和通知<br>- Presenter:
处理输入、更新视图</td>
<td>- Model: 数据和逻辑<br>- View: 显示<br>- ViewModel:
数据绑定和逻辑</td>
</tr>
<tr class="odd">
<td><strong>耦合性</strong></td>
<td>中等：View 直接依赖 Model，Controller 依赖两者</td>
<td>较低：View 只依赖 Presenter，Presenter 依赖 Model</td>
<td>最低：View 通过绑定依赖 ViewModel，ViewModel 依赖 Model</td>
</tr>
<tr class="even">
<td><strong>数据流</strong></td>
<td>- 用户 → Controller → Model → View</td>
<td>- 用户 → View → Presenter → Model → View</td>
<td>- 用户 → View → ViewModel → Model（绑定双向同步）</td>
</tr>
<tr class="odd">
<td><strong>视图更新</strong></td>
<td>Controller 主动更新 View</td>
<td>Presenter 主动更新 View</td>
<td>数据绑定自动更新 View</td>
</tr>
<tr class="even">
<td><strong>控制器/Presenter/ViewModel 角色</strong></td>
<td>Controller 协调模型和视图更新</td>
<td>Presenter 处理逻辑，主动控制视图</td>
<td>ViewModel 暴露数据和命令，视图绑定更新</td>
</tr>
<tr class="odd">
<td><strong>通信方式</strong></td>
<td>- View → Controller (输入)<br>- Model → View (通知)</td>
<td>- View → Presenter (通知)<br>- Presenter → View (更新)</td>
<td>- View ↔︎ ViewModel (绑定)<br>- ViewModel → Model (更新)</td>
</tr>
<tr class="even">
<td><strong>测试性</strong></td>
<td>Model 可独立测试，Controller 依赖 UI 难测</td>
<td>Presenter 可独立测试，View 可 mock</td>
<td>ViewModel 可独立测试，View 可 mock</td>
</tr>
<tr class="odd">
<td><strong>复杂度</strong></td>
<td>中等：简单应用可能繁琐</td>
<td>中等：需定义接口和实现</td>
<td>较高：绑定机制增加复杂性（Java 需手动实现）</td>
</tr>
<tr class="even">
<td><strong>优点</strong></td>
<td>- 解耦 UI 和逻辑<br>- 易于理解</td>
<td>- 视图与模型解耦<br>- 高测试性</td>
<td>- 视图自动更新<br>- 最低耦合</td>
</tr>
<tr class="odd">
<td><strong>缺点</strong></td>
<td>- View 依赖 Model<br>- 控制器可能臃肿</td>
<td>- 类数量增加<br>- View-Presenter 双向依赖</td>
<td>- 绑定复杂<br>- 性能开销（大量绑定）</td>
</tr>
<tr class="even">
<td><strong>适用场景</strong></td>
<td>- 传统 GUI<br>- Web 应用（如 Spring MVC）</td>
<td>- 测试驱动开发<br>- 复杂视图逻辑</td>
<td>- 数据驱动 UI<br>- 支持绑定的框架（如 JavaFX）</td>
</tr>
<tr class="odd">
<td><strong>Java 示例</strong></td>
<td>Controller 更新 Model，Model 通知 View</td>
<td>Presenter 处理输入，调用 View 更新</td>
<td>ViewModel 绑定数据，View 自动更新</td>
</tr>
<tr class="even">
<td><strong>典型框架</strong></td>
<td>Spring MVC、Struts</td>
<td>Android (早期)、GWT</td>
<td>JavaFX、WPF、Vue.js</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="详细说明">详细说明</h4>
<h5 id="数据流"><strong>数据流</strong></h5>
<ul>
<li><strong>MVC</strong>：用户输入通过控制器传递到模型，模型更新后通知视图显示（单向为主，视图可直接查询模型）。</li>
<li><strong>MVP</strong>：用户输入通过视图通知 Presenter，Presenter
更新模型并主动刷新视图（双向通信）。</li>
<li><strong>MVVM</strong>：用户输入直接影响
ViewModel（通过绑定），ViewModel
更新模型，视图自动同步（双向绑定）。</li>
</ul>
<h5 id="视图与模型关系"><strong>视图与模型关系</strong></h5>
<ul>
<li><strong>MVC</strong>：视图直接访问模型获取数据，可能导致耦合。</li>
<li><strong>MVP</strong>：视图通过 Presenter
间接访问模型，解耦更彻底。</li>
<li><strong>MVVM</strong>：视图通过 ViewModel
绑定访问数据，完全隔离模型。</li>
</ul>
<h5 id="测试性"><strong>测试性</strong></h5>
<ul>
<li><strong>MVC</strong>：控制器依赖视图，测试需模拟 UI。</li>
<li><strong>MVP</strong>：Presenter 不依赖具体视图实现，可轻松 mock View
接口。</li>
<li><strong>MVVM</strong>：ViewModel
独立于视图，测试只需验证数据逻辑。</li>
</ul>
<h5 id="java-示例代码片段"><strong>Java 示例代码片段</strong></h5>
<ol type="1">
<li><p><strong>MVC</strong>： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Model</span> &#123; <span class="type">int</span> count; <span class="keyword">void</span> <span class="title function_">setCount</span><span class="params">(<span class="type">int</span> c)</span> &#123; count = c; &#125; &#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">View</span> &#123; <span class="keyword">void</span> <span class="title function_">show</span><span class="params">(<span class="type">int</span> count)</span> &#123; System.out.println(count); &#125; &#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Controller</span> &#123;</span><br><span class="line">    Model m; View v;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123; m.setCount(m.count + <span class="number">1</span>); v.show(m.count); &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p></li>
<li><p><strong>MVP</strong>： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">View</span> &#123; <span class="keyword">void</span> <span class="title function_">show</span><span class="params">(<span class="type">int</span> count)</span>; &#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Model</span> &#123; <span class="type">int</span> count; <span class="keyword">void</span> <span class="title function_">setCount</span><span class="params">(<span class="type">int</span> c)</span> &#123; count = c; &#125; &#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Presenter</span> &#123; Model m; View v; <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123; m.setCount(m.count + <span class="number">1</span>); v.show(m.count); &#125; &#125;</span><br></pre></td></tr></table></figure></p></li>
<li><p><strong>MVVM</strong>： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Model</span> &#123; <span class="type">int</span> count; <span class="keyword">void</span> <span class="title function_">setCount</span><span class="params">(<span class="type">int</span> c)</span> &#123; count = c; &#125; &#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ViewModel</span> &#123;</span><br><span class="line">    Model m; Consumer&lt;Integer&gt; observer;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setValue</span><span class="params">(<span class="type">int</span> v)</span> &#123; m.setCount(v); observer.accept(v); &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">View</span> &#123; ViewModel vm; <span class="keyword">void</span> <span class="title function_">bind</span><span class="params">()</span> &#123; vm.observer = <span class="built_in">this</span>::show; &#125; <span class="keyword">void</span> <span class="title function_">show</span><span class="params">(<span class="type">int</span> v)</span> &#123; System.out.println(v); &#125; &#125;</span><br></pre></td></tr></table></figure></p></li>
</ol>
<hr />
<h4 id="总结-28">总结</h4>
<ul>
<li><strong>MVC</strong>：适合传统应用，视图与模型直接交互。</li>
<li><strong>MVP</strong>：增强解耦，Presenter 主动控制，利于测试。</li>
<li><strong>MVVM</strong>：依赖数据绑定，视图最被动，适合现代 UI
框架。</li>
</ul>
<p>如果需要更具体示例或调整表格内容，请告诉我！</p>
<h3 id="仓储模式repository-pattern"><strong>仓储模式（Repository
Pattern）</strong></h3>
<p>仓储模式（Repository
Pattern）是一种设计模式，广泛用于数据访问层，旨在将数据访问逻辑从业务逻辑中分离出来。它通过提供一个类似集合的接口来操作数据，隐藏底层数据存储的实现细节（如数据库、文件系统），从而解耦应用程序与数据源。</p>
<p>以下是用 Java
实现仓储模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="仓储模式的定义">1. 仓储模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：通过仓储对象提供对数据的统一访问接口，封装数据操作逻辑。</li>
<li><strong>目的</strong>：
<ul>
<li>解耦业务逻辑与数据访问。</li>
<li>提供一致的数据操作方式。</li>
<li>便于测试和替换数据源。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>需要隔离数据库操作。</li>
<li>数据源可能切换（如从 SQL 到 NoSQL）。</li>
<li>单元测试需要 mock 数据访问。</li>
</ul></li>
</ul>
<hr />
<h4 id="仓储模式的结构">2. 仓储模式的结构</h4>
<ul>
<li><strong>领域模型（Domain
Model）</strong>：表示业务实体的数据结构。</li>
<li><strong>仓储接口（Repository
Interface）</strong>：定义数据操作的抽象方法。</li>
<li><strong>具体仓储（Concrete
Repository）</strong>：实现仓储接口，封装数据访问逻辑。</li>
<li><strong>数据存储（Data
Store）</strong>：底层数据源（如数据库、文件）。</li>
<li><strong>客户端（Client）</strong>：使用仓储访问数据。</li>
</ul>
<h5 id="mermaid-uml-图-22">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class DomainModel &#123;
        -id: int
        -name: String
    &#125;
    class Repository &#123;
        &lt;&lt;interface&gt;&gt;
        +add(entity: DomainModel)
        +findById(id: int) DomainModel
        +remove(id: int)
    &#125;
    class ConcreteRepository &#123;
        -dataStore: DataStore
        +add(entity: DomainModel)
        +findById(id: int) DomainModel
        +remove(id: int)
    &#125;
    class DataStore &#123;
        +save(entity)
        +load(id)
        +delete(id)
    &#125;
    class Client
    
    ConcreteRepository ..|&gt; Repository : implements
    ConcreteRepository --&gt; DataStore : uses
    Client --&gt; Repository : uses</code></pre>
<hr />
<h4 id="java-实现示例-27">3. Java 实现示例</h4>
<p>以下是一个简单的用户管理的仓储模式示例，使用内存存储模拟数据源。</p>
<h5 id="领域模型">3.1 领域模型</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 领域模型：用户</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">User</span><span class="params">(<span class="type">int</span> id, String name)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getId</span><span class="params">()</span> &#123; <span class="keyword">return</span> id; &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123; <span class="keyword">return</span> name; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setName</span><span class="params">(String name)</span> &#123; <span class="built_in">this</span>.name = name; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">toString</span><span class="params">()</span> &#123; <span class="keyword">return</span> <span class="string">&quot;User&#123;id=&quot;</span> + id + <span class="string">&quot;, name=&#x27;&quot;</span> + name + <span class="string">&quot;&#x27;&#125;&quot;</span>; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="仓储接口">3.2 仓储接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 仓储接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(User user)</span>;</span><br><span class="line">    User <span class="title function_">findById</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(<span class="type">int</span> id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体仓储">3.3 具体仓储</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体仓储：内存实现的仓储</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InMemoryUserRepository</span> <span class="keyword">implements</span> <span class="title class_">UserRepository</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;Integer, User&gt; store = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        store.put(user.getId(), user);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findById</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> store.get(id);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        store.remove(id);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-28">3.4 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">UserRepository</span> <span class="variable">repository</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InMemoryUserRepository</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 添加用户</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">user1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1</span>, <span class="string">&quot;Alice&quot;</span>);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">2</span>, <span class="string">&quot;Bob&quot;</span>);</span><br><span class="line">        repository.add(user1);</span><br><span class="line">        repository.add(user2);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 查询用户</span></span><br><span class="line">        <span class="type">User</span> <span class="variable">found</span> <span class="operator">=</span> repository.findById(<span class="number">1</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;Found: &quot;</span> + found);  <span class="comment">// 输出: Found: User&#123;id=1, name=&#x27;Alice&#x27;&#125;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 删除用户</span></span><br><span class="line">        repository.remove(<span class="number">2</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;After removal, find Bob: &quot;</span> + repository.findById(<span class="number">2</span>));  <span class="comment">// 输出: After removal, find Bob: null</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="扩展数据库仓储">3.5 扩展：数据库仓储</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体仓储：数据库实现的仓储（伪代码）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DatabaseUserRepository</span> <span class="keyword">implements</span> <span class="title class_">UserRepository</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> DataStore database;  <span class="comment">// 模拟数据库连接</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DatabaseUserRepository</span><span class="params">(DataStore database)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.database = database;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">add</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        database.save(user);  <span class="comment">// 假设 save 是数据库操作</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findById</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (User) database.load(id);  <span class="comment">// 假设 load 从数据库读取</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">remove</span><span class="params">(<span class="type">int</span> id)</span> &#123;</span><br><span class="line">        database.delete(id);  <span class="comment">// 假设 delete 是数据库删除</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-28">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>通过仓储接口（<code>UserRepository</code>）操作数据。</li>
<li>具体仓储（如
<code>InMemoryUserRepository</code>）实现接口，封装数据访问逻辑。</li>
<li>底层数据存储（如内存或数据库）执行实际操作。</li>
</ol>
<hr />
<h4 id="优点-28">5. 优点</h4>
<ul>
<li><strong>解耦</strong>：业务逻辑不依赖具体数据源。</li>
<li><strong>可测试性</strong>：易于 mock 仓储进行测试。</li>
<li><strong>一致性</strong>：提供类似集合的统一接口。</li>
</ul>
<hr />
<h4 id="缺点-28">6. 缺点</h4>
<ul>
<li><strong>额外层</strong>：增加抽象层，可能提高复杂度。</li>
<li><strong>实现成本</strong>：每个实体需定义仓储接口和实现。</li>
<li><strong>性能</strong>：抽象可能掩盖底层优化。</li>
</ul>
<hr />
<h4 id="与-dao-模式的对比">7. 与 DAO 模式的对比</h4>
<table>
<colgroup>
<col style="width: 18%" />
<col style="width: 40%" />
<col style="width: 40%" />
</colgroup>
<thead>
<tr class="header">
<th>特性</th>
<th>仓储模式</th>
<th>DAO 模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>目的</strong></td>
<td>封装数据访问，提供集合接口</td>
<td>数据访问对象，直接操作数据</td>
</tr>
<tr class="even">
<td><strong>抽象级别</strong></td>
<td>更高（业务导向）</td>
<td>较低（数据导向）</td>
</tr>
<tr class="odd">
<td><strong>接口风格</strong></td>
<td>类似集合（如 add、find）</td>
<td>数据库操作（如 CRUD）</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-28">8. 实际应用场景</h4>
<ul>
<li><strong>Spring Data</strong>：JPA 仓储接口。</li>
<li><strong>DDD（领域驱动设计）</strong>：仓储管理聚合根。</li>
<li><strong>测试</strong>：mock 数据访问层。</li>
</ul>
<hr />
<h4 id="源码中的例子spring-data">9. 源码中的例子（Spring Data）</h4>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.data.jpa.repository.JpaRepository;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserRepository</span> <span class="keyword">extends</span> <span class="title class_">JpaRepository</span>&lt;User, Integer&gt; &#123;</span><br><span class="line">    <span class="comment">// 自动实现 CRUD 方法</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><strong>说明</strong>：Spring Data 提供仓储接口，自动生成实现。</li>
</ul>
<hr />
<h4 id="总结-29">10. 总结</h4>
<ul>
<li><strong>仓储模式</strong>通过接口封装数据访问，解耦业务与存储。</li>
<li><strong>Java 实现</strong>支持内存、数据库等多种存储方式。</li>
<li><strong>UML 图</strong>展示了仓储与数据源的关系。</li>
</ul>
<p>如果需要更复杂示例（如带查询方法）或调整 UML，请告诉我！</p>
<h3 id="服务定位器service-locator"><strong>服务定位器（Service
Locator）</strong></h3>
<p>服务定位器模式（Service Locator
Pattern）是一种设计模式，用于通过一个中央服务定位器（Service
Locator）来查找和获取服务或依赖，而不是直接在客户端中硬编码或手动创建。它是一种替代依赖注入（Dependency
Injection）的服务获取方式，旨在解耦客户端与具体服务的实现。</p>
<p>以下是用 Java
实现服务定位器模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="服务定位器模式的定义">1. 服务定位器模式的定义</h4>
<ul>
<li><strong>核心思想</strong>：通过服务定位器集中管理和提供服务实例，客户端只需知道服务接口和定位器。</li>
<li><strong>目的</strong>：
<ul>
<li>解耦客户端与服务实现。</li>
<li>提供统一的服务查找方式。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>服务实例创建复杂或需要缓存。</li>
<li>客户端需动态获取服务。</li>
<li>不想使用依赖注入框架。</li>
</ul></li>
</ul>
<hr />
<h4 id="服务定位器模式的结构">2. 服务定位器模式的结构</h4>
<ul>
<li><strong>服务接口（Service
Interface）</strong>：定义服务的契约。</li>
<li><strong>具体服务（Concrete Service）</strong>：实现服务接口。</li>
<li><strong>服务定位器（Service
Locator）</strong>：管理服务实例，提供查找方法。</li>
<li><strong>客户端（Client）</strong>：通过定位器获取服务并使用。</li>
</ul>
<h5 id="mermaid-uml-图-23">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Service &#123;
        &lt;&lt;interface&gt;&gt;
        +doSomething()
    &#125;
    class ConcreteServiceA &#123;
        +doSomething()
    &#125;
    class ConcreteServiceB &#123;
        +doSomething()
    &#125;
    class ServiceLocator &#123;
        -services: Map&lt;String, Service&gt;
        +getService(name: String) Service
    &#125;
    class Client
    
    ConcreteServiceA ..|&gt; Service : implements
    ConcreteServiceB ..|&gt; Service : implements
    ServiceLocator --&gt; Service : provides
    Client --&gt; ServiceLocator : uses
    Client --&gt; Service : uses</code></pre>
<hr />
<h4 id="java-实现示例-28">3. Java 实现示例</h4>
<p>以下是一个日志服务的服务定位器示例，客户端通过定位器获取不同日志服务。</p>
<h5 id="服务接口-1">3.1 服务接口</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务接口</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(String message)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="具体服务-1">3.2 具体服务</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 具体服务：控制台日志</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConsoleLogger</span> <span class="keyword">implements</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Console: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体服务：文件日志</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileLogger</span> <span class="keyword">implements</span> <span class="title class_">Logger</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">log</span><span class="params">(String message)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;File: &quot;</span> + message);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="服务定位器">3.3 服务定位器</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 服务定位器</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ServiceLocator</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Map&lt;String, Logger&gt; services = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        services.put(<span class="string">&quot;console&quot;</span>, <span class="keyword">new</span> <span class="title class_">ConsoleLogger</span>());</span><br><span class="line">        services.put(<span class="string">&quot;file&quot;</span>, <span class="keyword">new</span> <span class="title class_">FileLogger</span>());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Logger <span class="title function_">getLogger</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        <span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> services.get(name);</span><br><span class="line">        <span class="keyword">if</span> (logger == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;No logger found for: &quot;</span> + name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> logger;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-29">3.4 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 获取控制台日志服务</span></span><br><span class="line">        <span class="type">Logger</span> <span class="variable">consoleLogger</span> <span class="operator">=</span> ServiceLocator.getLogger(<span class="string">&quot;console&quot;</span>);</span><br><span class="line">        consoleLogger.log(<span class="string">&quot;Hello from console&quot;</span>);  <span class="comment">// 输出: Console: Hello from console</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">// 获取文件日志服务</span></span><br><span class="line">        <span class="type">Logger</span> <span class="variable">fileLogger</span> <span class="operator">=</span> ServiceLocator.getLogger(<span class="string">&quot;file&quot;</span>);</span><br><span class="line">        fileLogger.log(<span class="string">&quot;Hello from file&quot;</span>);  <span class="comment">// 输出: File: Hello from file</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-29">4. 工作原理</h4>
<ol type="1">
<li><strong>服务定位器</strong>初始化时注册服务实例（静态或动态）。</li>
<li><strong>客户端</strong>通过定位器请求服务（<code>getLogger</code>），只需提供服务标识。</li>
<li>定位器返回服务实例，客户端调用服务方法。</li>
</ol>
<hr />
<h4 id="优点-29">5. 优点</h4>
<ul>
<li><strong>解耦</strong>：客户端不直接依赖服务实现。</li>
<li><strong>集中管理</strong>：服务实例在定位器中统一配置。</li>
<li><strong>简单性</strong>：无需复杂框架即可实现。</li>
</ul>
<hr />
<h4 id="缺点-29">6. 缺点</h4>
<ul>
<li><strong>隐式依赖</strong>：客户端依赖定位器，依赖关系不显式。</li>
<li><strong>全局状态</strong>：静态定位器可能导致单例问题。</li>
<li><strong>测试性差</strong>：相比依赖注入，难以 mock 服务。</li>
</ul>
<hr />
<h4 id="与依赖注入的对比">7. 与依赖注入的对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>服务定位器模式</th>
<th>依赖注入模式</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>依赖获取</strong></td>
<td>客户端主动请求</td>
<td>外部注入</td>
</tr>
<tr class="even">
<td><strong>控制权</strong></td>
<td>客户端控制</td>
<td>注入器控制</td>
</tr>
<tr class="odd">
<td><strong>耦合</strong></td>
<td>依赖定位器</td>
<td>依赖接口</td>
</tr>
<tr class="even">
<td><strong>测试性</strong></td>
<td>较差（需 mock 定位器）</td>
<td>较高（易 mock 依赖）</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-29">8. 实际应用场景</h4>
<ul>
<li><strong>JNDI</strong>：Java 的命名和目录接口。</li>
<li><strong>日志框架</strong>：如 SLF4J 的
<code>LoggerFactory</code>。</li>
<li><strong>遗留系统</strong>：集中管理服务实例。</li>
</ul>
<hr />
<h4 id="源码中的例子-26">9. 源码中的例子</h4>
<p>Java 中的 <code>javax.naming.InitialContext</code>（JNDI）：
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.naming.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Example</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NamingException &#123;</span><br><span class="line">        <span class="type">InitialContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">InitialContext</span>();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">service</span> <span class="operator">=</span> context.lookup(<span class="string">&quot;java:comp/env/myService&quot;</span>);  <span class="comment">// 服务定位</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<hr />
<h4 id="总结-30">10. 总结</h4>
<ul>
<li><strong>服务定位器模式</strong>通过集中定位器提供服务访问，解耦客户端与实现。</li>
<li><strong>Java 实现</strong>依赖静态或动态注册，简单但隐式。</li>
<li><strong>UML 图</strong>展示了定位器与服务的关系。</li>
</ul>
<p>如果需要动态注册示例或调整 UML，请告诉我！</p>
<h3 id="事件溯源event-sourcing"><strong>事件溯源（Event
Sourcing）</strong></h3>
<p>事件溯源（Event
Sourcing）是一种架构模式，主要用于数据存储和状态管理。它不同于传统的
CRUD（创建、读取、更新、删除）方式，而是通过记录系统中发生的所有事件（Event）来构建和追踪应用程序状态。事件溯源的核心思想是将状态变化作为事件序列存储，而不是直接存储当前状态。</p>
<p>以下是用 Java
实现事件溯源模式的详细讲解，包括定义、结构、代码示例及其优缺点。</p>
<hr />
<h4 id="事件溯源的定义">1. 事件溯源的定义</h4>
<ul>
<li><strong>核心思想</strong>：将应用程序的状态变化记录为一系列不可变的事件，通过回放事件重建当前状态。</li>
<li><strong>目的</strong>：
<ul>
<li>提供完整的历史记录。</li>
<li>支持状态重建和审计。</li>
<li>增强系统的可扩展性和一致性。</li>
</ul></li>
<li><strong>适用场景</strong>：
<ul>
<li>需要审计或回溯（如金融系统）。</li>
<li>事件驱动架构（EDA）。</li>
<li>分布式系统（如微服务）。</li>
</ul></li>
</ul>
<hr />
<h4 id="事件溯源的结构">2. 事件溯源的结构</h4>
<ul>
<li><strong>事件（Event）</strong>：表示状态变化的不可变记录。</li>
<li><strong>事件存储（Event
Store）</strong>：持久化事件序列的存储。</li>
<li><strong>聚合（Aggregate）</strong>：业务实体，应用事件重建状态。</li>
<li><strong>事件处理器（Event
Handler）</strong>：处理事件并更新聚合状态。</li>
<li><strong>客户端（Client）</strong>：触发事件并查询状态。</li>
</ul>
<h5 id="mermaid-uml-图-24">Mermaid UML 图</h5>
<pre><code class="highlight mermaid">classDiagram
    class Event &#123;
        -id: String
        -type: String
        -data: Object
        +getId() String
        +getType() String
        +getData() Object
    &#125;
    class EventStore &#123;
        +append(event: Event)
        +getEvents(aggregateId: String) List&lt;Event&gt;
    &#125;
    class Aggregate &#123;
        -id: String
        -state: State
        +apply(Event)
        +getState() State
    &#125;
    class EventHandler &#123;
        +handle(Event, Aggregate)
    &#125;
    class Client
    
    EventStore --&gt; Event : stores
    Aggregate --&gt; Event : applies
    EventHandler --&gt; Event : processes
    EventHandler --&gt; Aggregate : updates
    Client --&gt; EventStore : saves to
    Client --&gt; Aggregate : queries</code></pre>
<hr />
<h4 id="java-实现示例-29">3. Java 实现示例</h4>
<p>以下是一个银行账户的事件溯源示例，记录存款和取款事件。</p>
<h5 id="事件类">3.1 事件类</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 事件基类</span></span><br><span class="line"><span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">AccountEvent</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> String accountId;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">long</span> timestamp;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">AccountEvent</span><span class="params">(String accountId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.accountId = accountId;</span><br><span class="line">        <span class="built_in">this</span>.timestamp = System.currentTimeMillis();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getAccountId</span><span class="params">()</span> &#123; <span class="keyword">return</span> accountId; &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getTimestamp</span><span class="params">()</span> &#123; <span class="keyword">return</span> timestamp; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体事件：存款</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">DepositEvent</span> <span class="keyword">extends</span> <span class="title class_">AccountEvent</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">double</span> amount;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">DepositEvent</span><span class="params">(String accountId, <span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(accountId);</span><br><span class="line">        <span class="built_in">this</span>.amount = amount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getAmount</span><span class="params">()</span> &#123; <span class="keyword">return</span> amount; &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 具体事件：取款</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WithdrawalEvent</span> <span class="keyword">extends</span> <span class="title class_">AccountEvent</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">double</span> amount;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">WithdrawalEvent</span><span class="params">(String accountId, <span class="type">double</span> amount)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(accountId);</span><br><span class="line">        <span class="built_in">this</span>.amount = amount;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getAmount</span><span class="params">()</span> &#123; <span class="keyword">return</span> amount; &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="事件存储">3.2 事件存储</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 事件存储（内存实现）</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EventStore</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, List&lt;AccountEvent&gt;&gt; events = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">append</span><span class="params">(AccountEvent event)</span> &#123;</span><br><span class="line">        events.computeIfAbsent(event.getAccountId(), k -&gt; <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;()).add(event);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> List&lt;AccountEvent&gt; <span class="title function_">getEvents</span><span class="params">(String accountId)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> events.getOrDefault(accountId, <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="聚合">3.3 聚合</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 聚合：银行账户</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Account</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String id;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">double</span> balance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">Account</span><span class="params">(String id)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.id = id;</span><br><span class="line">        <span class="built_in">this</span>.balance = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">apply</span><span class="params">(AccountEvent event)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (event <span class="keyword">instanceof</span> DepositEvent) &#123;</span><br><span class="line">            balance += ((DepositEvent) event).getAmount();</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (event <span class="keyword">instanceof</span> WithdrawalEvent) &#123;</span><br><span class="line">            balance -= ((WithdrawalEvent) event).getAmount();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">getBalance</span><span class="params">()</span> &#123; <span class="keyword">return</span> balance; &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getId</span><span class="params">()</span> &#123; <span class="keyword">return</span> id; &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 重建状态</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Account <span class="title function_">rebuild</span><span class="params">(String id, List&lt;AccountEvent&gt; events)</span> &#123;</span><br><span class="line">        <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Account</span>(id);</span><br><span class="line">        <span class="keyword">for</span> (AccountEvent event : events) &#123;</span><br><span class="line">            account.apply(event);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> account;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="客户端代码-30">3.4 客户端代码</h5>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">EventStore</span> <span class="variable">store</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">EventStore</span>();</span><br><span class="line">        <span class="type">String</span> <span class="variable">accountId</span> <span class="operator">=</span> <span class="string">&quot;acc1&quot;</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 记录事件</span></span><br><span class="line">        store.append(<span class="keyword">new</span> <span class="title class_">DepositEvent</span>(accountId, <span class="number">100.0</span>));</span><br><span class="line">        store.append(<span class="keyword">new</span> <span class="title class_">DepositEvent</span>(accountId, <span class="number">50.0</span>));</span><br><span class="line">        store.append(<span class="keyword">new</span> <span class="title class_">WithdrawalEvent</span>(accountId, <span class="number">30.0</span>));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 重建账户状态</span></span><br><span class="line">        <span class="type">Account</span> <span class="variable">account</span> <span class="operator">=</span> Account.rebuild(accountId, store.getEvents(accountId));</span><br><span class="line">        System.out.println(<span class="string">&quot;Account balance: &quot;</span> + account.getBalance());  <span class="comment">// 输出: Account balance: 120.0</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr />
<h4 id="工作原理-30">4. 工作原理</h4>
<ol type="1">
<li><strong>客户端</strong>触发事件（如存款），存储到事件存储。</li>
<li>事件存储保存不可变的事件序列。</li>
<li>需要状态时，聚合通过回放事件（<code>apply</code>）重建当前状态。</li>
</ol>
<hr />
<h4 id="优点-30">5. 优点</h4>
<ul>
<li><strong>审计性</strong>：完整事件历史，便于追踪和调试。</li>
<li><strong>灵活性</strong>：可重建任意历史状态。</li>
<li><strong>一致性</strong>：事件序列保证数据完整性。</li>
</ul>
<hr />
<h4 id="缺点-30">6. 缺点</h4>
<ul>
<li><strong>存储开销</strong>：事件量大时占用空间多。</li>
<li><strong>性能</strong>：状态重建需回放所有事件，效率低。</li>
<li><strong>复杂性</strong>：实现和维护较复杂。</li>
</ul>
<hr />
<h4 id="与传统状态存储对比">7. 与传统状态存储对比</h4>
<table>
<thead>
<tr class="header">
<th>特性</th>
<th>事件溯源</th>
<th>传统状态存储</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><strong>存储内容</strong></td>
<td>事件序列</td>
<td>当前状态</td>
</tr>
<tr class="even">
<td><strong>状态获取</strong></td>
<td>回放事件重建</td>
<td>直接读取</td>
</tr>
<tr class="odd">
<td><strong>历史记录</strong></td>
<td>完整</td>
<td>需额外实现</td>
</tr>
</tbody>
</table>
<hr />
<h4 id="实际应用场景-30">8. 实际应用场景</h4>
<ul>
<li><strong>银行系统</strong>：记录交易历史。</li>
<li><strong>电商</strong>：订单状态追踪。</li>
<li><strong>CQRS</strong>：与命令查询职责分离结合。</li>
</ul>
<hr />
<h4 id="源码中的例子-27">9. 源码中的例子</h4>
<p>Java 中无直接内置实现，但类似概念见于日志框架： <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 类似事件日志的记录</span></span><br><span class="line"><span class="type">Logger</span> <span class="variable">logger</span> <span class="operator">=</span> Logger.getLogger(<span class="string">&quot;app&quot;</span>);</span><br><span class="line">logger.info(<span class="string">&quot;Deposit: 100&quot;</span>);  <span class="comment">// 事件记录</span></span><br></pre></td></tr></table></figure></p>
<hr />
<h4 id="总结-31">10. 总结</h4>
<ul>
<li><strong>事件溯源</strong>通过事件序列管理状态，支持审计和重建。</li>
<li><strong>Java 实现</strong>依赖事件类和存储，回放重建聚合。</li>
<li><strong>UML 图</strong>展示了事件与聚合的关系。</li>
</ul>
<p>如果需要更复杂示例（如快照优化）或调整 UML，请告诉我！</p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>Bruce Yao
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://cmder.github.io/%E8%BD%AF%E4%BB%B6%E8%AE%BE%E8%AE%A1/%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F.html" title="设计模式">https://cmder.github.io/软件设计/设计模式.html</a>
  </li>
  <li class="post-copyright-license">
      <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/C++/C++.html" rel="prev" title="C++">
                  <i class="fa fa-angle-left"></i> C++
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/%E7%AE%97%E6%B3%95/%E7%AE%97%E6%B3%95%E5%92%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84.html" rel="next" title="算法和数据结构">
                  算法和数据结构 <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2022 – 
    <span itemprop="copyrightYear">2025</span>
    <span class="with-love">
      <i class="fa fa-heart"></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Bruce Yao</span>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="返回顶部">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

  <a href="https://github.com/cmder" class="github-corner" title="在 GitHub 上关注我" aria-label="在 GitHub 上关注我" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>
<script src="https://cdn.jsdelivr.net/npm/darkmode-js@1.5.7/lib/darkmode-js.min.js"></script>

<script>
var options = {
  bottom: '64px',
  right: 'unset',
  left: '32px',
  time: '0.5s',
  mixColor: 'transparent',
  backgroundColor: 'transparent',
  buttonColorDark: '#100f2c',
  buttonColorLight: '#fff',
  saveInCookies: false,
  label: '🌓',
  autoMatchOsTheme: false
}
const darkmode = new Darkmode(options);
window.darkmode = darkmode;
darkmode.showWidget();
if (window.darkmode && !window.darkmode.isActivated()) {
  window.darkmode.toggle();
  var toggleButtons = document.getElementsByClassName("darkmode-toggle");
  if (toggleButtons && toggleButtons.length > 0) {
    for (i = 0; i < toggleButtons.length; i++) {
      toggleButtons[i].classList.add("darkmode-toggle--white");
    }
  }
}
</script>

</body>
</html>
